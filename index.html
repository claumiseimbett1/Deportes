<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IV Championship Master - AquaTEN&Elyanasnatacion</title>
    <meta name="description" content="IV Championship Master AquaTEN&Elyanasnatacion - Competencia de natación master con resultados en tiempo real, diplomas descargables y clasificaciones por categorías.">
    <meta name="keywords" content="natación, championship, master, AquaTEN, competencia, resultados">
    <!-- theme-color: PWA feature for mobile browsers -->
    <meta name="theme-color" content="#0b1039">
    
    <!-- Performance optimizations -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" as="script">
    <link rel="dns-prefetch" href="//docs.google.com">
    <link rel="dns-prefetch" href="//sheets.googleapis.com">
    <style>
        /* CSS Variables for consistency and easy maintenance */
        :root {
            --primary-color: #0b1039;
            --secondary-color: #00ADEF;
            --background-light: #f0f6ff;
            --background-gradient: linear-gradient(135deg, #0b1039, #00adef);
            --text-gray: #a5a5a5;
            --text-white: #ffffff;
            --border-radius: 15px;
            --border-radius-small: 8px;
            --border-radius-large: 25px;
            --box-shadow: 0 5px 25px rgba(11, 16, 57, 0.08);
            --box-shadow-hover: 0 10px 30px rgba(11, 16, 57, 0.1);
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--text-white);
            color: var(--primary-color);
            line-height: 1.6;
        }

        /* Animaciones */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .loading {
            animation: pulse 2s infinite;
        }

        /* Header */
        .header {
            background-color: var(--text-white);
            box-shadow: var(--box-shadow);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-box {
            height: 60px;
            display: flex;
            align-items: center;
        }

        .logo-box img {
            height: 100%;
            width: auto;
        }

        /* Navigation Menu */
        .nav-menu {
            display: flex;
            align-items: center;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 30px;
            margin: 0;
            padding: 0;
        }

        .nav-links li a {
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 500;
            font-size: 16px;
            padding: 8px 16px;
            border-radius: 20px;
            transition: var(--transition);
            position: relative;
        }

        .nav-links li a:hover {
            background-color: var(--secondary-color);
            color: var(--text-white);
            transform: translateY(-2px);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            flex-direction: column;
            cursor: pointer;
            padding: 5px;
            margin: 0 15px;
        }

        .mobile-menu-toggle span {
            width: 25px;
            height: 3px;
            background-color: var(--primary-color);
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }

        .mobile-menu-toggle.active span:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .mobile-menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-toggle.active span:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        /* Search Box Styles */
        .search-container {
            margin-bottom: 20px;
            text-align: center;
        }

        .search-box {
            display: inline-flex;
            align-items: center;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius-large);
            padding: 8px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: var(--transition);
            max-width: 400px;
            width: 100%;
        }

        .search-box:focus-within {
            border-color: var(--secondary-color);
            box-shadow: 0 4px 15px rgba(0, 173, 239, 0.2);
        }

        .search-input {
            border: none;
            outline: none;
            padding: 8px 12px;
            font-size: 16px;
            width: 100%;
            background: transparent;
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-icon {
            color: #666;
            margin-right: 8px;
        }

        .clear-search {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .clear-search:hover {
            background-color: #f0f0f0;
        }

        .search-results-info {
            text-align: center;
            margin: 10px 0;
            color: #666;
            font-size: 14px;
        }

        .highlight-search {
            background-color: #ffeb3b;
            font-weight: bold;
        }

        /* Status indicator */
        .status-indicator {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 9999;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: var(--transition);
        }

        .status-loading {
            background: #ffa726;
            color: white;
        }

        .status-success {
            background: #4caf50;
            color: white;
        }

        .status-error {
            background: #f44336;
            color: white;
        }

        /* Quotes Slider Animation */
        @keyframes slideQuotes {
            0% { transform: translateX(0); }
            100% { transform: translateX(-500%); }
        }

        /* Pause animation on hover */
        .quotes-slider:hover .quotes-track {
            animation-play-state: paused;
        }

        /* Responsive quotes */
        @media (max-width: 768px) {
            .quote-item p {
                font-size: 1rem !important;
                color: var(--primary-color) !important;
            }
            .quote-item span {
                font-size: 0.8rem !important;
                color: var(--secondary-color) !important;
            }
        }

        /* Video Hero Section */
        .video-hero {
            margin-top: 90px;
            position: relative;
            width: 100%;
            height: 70vh;
            min-height: 500px;
            overflow: hidden;
            background-color: var(--primary-color);
        }

        .video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: none;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(11, 16, 57, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-content {
            text-align: center;
            z-index: 1;
            padding: 0 20px;
        }

        .hero-content h1 {
            font-size: 4em;
            color: #ffffff;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .hero-content .subtitle {
            font-size: 1.5em;
            color: #f0f6ff;
            font-weight: 300;
        }

        /* Info & Contact Section */
        .info-section, .contact-section {
            padding: 100px 20px;
            background-color: #ffffff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            font-size: 2.8em;
            color: var(--primary-color);
            margin-bottom: 60px;
            font-weight: 700;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            margin-bottom: 60px;
        }
        
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
            justify-content: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .info-card, .contact-card-link {
            background: #ffffff;
            border: 1px solid #f0f6ff;
            border-radius: 20px;
            padding: 50px 30px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(11, 16, 57, 0.08);
            transition: var(--transition);
            text-decoration: none;
            color: inherit;
        }

        .info-card:hover, .contact-card-link:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(11, 16, 57, 0.15);
            border-color: var(--secondary-color);
        }

        /* Iconos SVG minimalistas */
        .sticker-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sticker-icon svg {
            width: 100%;
            height: 100%;
        }

        .info-card h3, .contact-card-link h3 {
            color: var(--primary-color);
            font-size: 1.8em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .info-card p, .contact-card-link p {
            color: var(--text-gray);
            font-size: 1.1em;
            line-height: 1.8;
        }

        /* Results Section */
        .results-section {
            padding: 100px 20px;
            background: #f0f6ff;
        }

        .results-container {
            background: #ffffff;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 10px 40px rgba(11, 16, 57, 0.1);
            border: 2px solid #f0f6ff;
        }

        /* Pestañas de Resultados */
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f6ff;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-button {
            padding: 15px 30px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--primary-color);
            font-size: 1.1em;
            transition: var(--transition);
            margin: 0 10px;
            border-radius: 10px 10px 0 0;
            font-weight: 500;
        }

        .tab-button:hover {
            color: var(--secondary-color);
            background-color: rgba(0, 173, 239, 0.05);
        }

        .tab-button.active {
            color: var(--secondary-color);
            border-bottom: 3px solid var(--secondary-color);
            background-color: #f0f6ff;
            font-weight: 600;
        }

        .tab-content {
            display: none;
            padding: 30px 0;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h3 {
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.8em;
            font-weight: 600;
        }

        /* Indicador de última actualización */
        .last-update {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-gray);
            font-size: 0.9em;
        }

        .last-update .time {
            color: var(--secondary-color);
            font-weight: 600;
        }

        /* Tabla de Resultados */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #ffffff;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 5px 25px rgba(11, 16, 57, 0.08);
        }

        .results-table th, .results-table td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #f0f6ff;
        }

        .results-table th {
            background-color: var(--primary-color);
            color: #ffffff;
            font-weight: 600;
            font-size: 1em;
        }

        .results-table tr:nth-child(even) td {
            background-color: #fafcff;
        }

        .results-table tr:hover td {
            background-color: #f0f6ff;
            transition: background-color 0.3s ease;
        }

        .results-table .rank {
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
        }

        .results-table .time {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
        }

        .results-table .points {
            font-weight: bold;
            color: var(--secondary-color);
            text-align: center;
        }

        /* === CORRECCIÓN APLICADA AQUÍ === */
        /* Se combinaron las reglas y se aplicó el fondo directamente a las celdas (td) */
        .category-header td {
            background: var(--background-gradient) !important;
            color: #ffffff !important;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            border-bottom: 2px solid #00ADEF !important;
        }

        /* Loading state para la tabla */
        .results-table.loading {
            opacity: 0.7;
        }

        .loading-row {
            text-align: center;
            color: var(--text-gray);
            font-style: italic;
        }

        /* Sponsors Section */
        .sponsors-section {
            padding: 100px 20px;
            background: #ffffff;
        }

        .sponsors-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
            margin-top: 50px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .sponsor-card {
            background: #ffffff;
            border: 2px solid #f0f6ff;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            text-decoration: none;
            display: block;
        }

        .sponsor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(11, 16, 57, 0.15);
            border-color: var(--secondary-color);
        }

        .sponsor-logo {
            height: 80px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sponsor-logo img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
            filter: grayscale(100%);
            transition: filter 0.3s ease;
        }

        .sponsor-card:hover .sponsor-logo img {
            filter: grayscale(0%);
        }

        .sponsor-name {
            font-size: 1.2em;
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Sponsor Thank You Section */
        .sponsor-thank-you-section {
            margin-top: 80px;
            padding: 60px 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 25px;
            border: 2px solid #f0f6ff;
        }

        .thank-you-message {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .thank-you-message h3 {
            color: var(--primary-color);
            font-size: 2.2em;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .thank-you-message p {
            color: #666;
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 40px;
        }

        .share-thanks-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .share-thanks-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .share-thanks-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .whatsapp-thanks {
            background: linear-gradient(135deg, #25d366, #128c7e);
        }

        .whatsapp-thanks:hover {
            background: linear-gradient(135deg, #128c7e, #25d366);
        }

        .instagram-thanks {
            background: linear-gradient(135deg, #e4405f, #833ab4);
        }

        .instagram-thanks:hover {
            background: linear-gradient(135deg, #833ab4, #e4405f);
        }

        /* CTA Section */
        .cta-section {
            padding: 100px 20px;
            background: linear-gradient(135deg, #0b1039 0%, #0b5079 100%);
            text-align: center;
            position: relative;
        }

        .cta-section h2 {
            color: #ffffff;
            font-size: 3em;
            margin-bottom: 25px;
            font-weight: 700;
        }

        .cta-section p {
            color: #f0f6ff;
            font-size: 1.3em;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-button {
            display: inline-block;
            background: #00ADEF;
            color: #ffffff;
            padding: 18px 50px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.2em;
            transition: var(--transition);
            box-shadow: 0 5px 20px rgba(0, 173, 239, 0.3);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 173, 239, 0.5);
            background: #0099d8;
        }

        /* Footer */
        .footer {
            background-color: var(--primary-color);
            color: #ffffff;
            padding: 50px 20px;
            text-align: center;
        }

        .footer p {
            margin-bottom: 10px;
            color: #f0f6ff;
        }

        /* Tabla de equipos responsive - usar formato estándar */
        @media (max-width: 768px) {
            /* Mantener la tabla visible y usar el formato responsive estándar */
            #resultsTableTeams {
                display: table;
            }
            
            /* Ocultar el contenedor móvil personalizado */
            #resultsTableTeams + .mobile-teams-container {
                display: none !important;
            }
        }
        
        /* Contenedor móvil para equipos (se creará dinámicamente) */
        .mobile-teams-container {
            display: none;
        }
        
        .mobile-team-card {
            background: white;
            border: 2px solid #e3f2fd;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .mobile-team-card .team-position {
            background: #00ADEF;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .mobile-team-card .team-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .mobile-team-card .team-points {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .mobile-team-card .team-points div {
            background: #f8f9fa;
            padding: 8px;
            border-radius: var(--border-radius-small);
            text-align: center;
        }
        
        .mobile-team-card .team-points .label {
            font-size: 12px;
            color: #666;
            margin-bottom: 2px;
        }
        
        .mobile-team-card .team-points .value {
            font-size: 16px;
            font-weight: bold;
            color: var(--secondary-color);
        }

        /* Estilos adicionales para pantallas muy pequeñas - SOLO equipos */
        @media screen and (max-width: 480px) {
            #resultsTableTeams tr {
                padding: 8px !important;
                margin: 8px 0 !important;
            }
            
            #resultsTableTeams td {
                padding: 4px 0 !important;
                font-size: 13px !important;
                min-height: 28px !important;
            }
            
            #resultsTableTeams td:before {
                font-size: 10px !important;
                font-weight: 600 !important;
            }
            
            /* Reducir espacios generales en todas las tablas móviles */
            .results-table tr {
                margin-bottom: 6px !important;
                padding: 6px !important;
            }
            
            .results-table td {
                padding-top: 12px !important;
                padding-bottom: 3px !important;
                min-height: 25px !important;
                font-size: 13px !important;
            }
            
            .results-table td:before {
                font-size: 10px !important;
                top: 2px !important;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-content h1 {
                font-size: 2.5em;
            }

            .hero-content .subtitle {
                font-size: 1.2em;
            }

            .section-title {
                font-size: 2em;
            }

            .nav-container {
                padding: 15px 20px;
                flex-wrap: wrap;
            }

            /* Mobile Navigation */
            .mobile-menu-toggle {
                display: flex;
                order: 2;
            }

            .nav-menu {
                order: 3;
                width: 100%;
                margin-top: 15px;
                display: none;
            }

            .nav-menu.active {
                display: block;
            }

            .nav-links {
                flex-direction: column;
                gap: 10px;
                background-color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(11, 16, 57, 0.1);
            }

            .nav-links li a {
                display: block;
                padding: 12px 20px;
                text-align: center;
                border: 1px solid #e0e0e0;
                margin-bottom: 5px;
            }

            .logo-box:last-child {
                order: 1;
            }

            .logo-box {
                height: 45px;
            }

            .video-hero {
                height: 60vh;
                min-height: 400px;
            }

            .info-section, .results-section, .sponsors-section, .cta-section, .contact-section {
                padding: 60px 20px;
            }

            .sponsors-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 25px;
                margin-top: 30px;
            }

            .sponsor-card {
                padding: 25px;
            }

            .sponsor-logo {
                height: 60px;
                margin-bottom: 15px;
            }

            .sponsor-name {
                font-size: 0.9em;
            }

            /* Responsive styles for sponsor thank you section */
            .sponsor-thank-you-section {
                margin-top: 50px;
                padding: 40px 0;
                border-radius: 15px;
            }

            .thank-you-message h3 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }

            .thank-you-message p {
                font-size: 1.1em;
                margin-bottom: 30px;
            }

            .share-thanks-buttons {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .share-thanks-btn {
                width: 100%;
                max-width: 280px;
                padding: 12px 20px;
                font-size: 1em;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-button {
                width: 100%;
                text-align: center;
                margin: 5px 0;
                border-radius: var(--border-radius-small);
            }

            .tab-button.active {
                border-left: 3px solid #00ADEF;
                border-bottom: 1px solid #f0f6ff;
            }

            .results-table th, .results-table td {
                padding: 10px 12px;
                font-size: 0.9em;
            }

            .results-table thead {
                display: none;
            }

            .results-table tr {
                display: block;
                margin-bottom: 10px;
                border: 1px solid #f0f6ff;
                border-radius: 6px;
                background-color: #ffffff;
            }

            .results-table td {
                display: block;
                text-align: right;
                padding-left: 45%;
                position: relative;
                padding-top: 18px !important;
                padding-bottom: 6px !important;
                min-height: 35px;
            }

            .results-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 8px;
                font-weight: bold;
                text-align: left;
                color: var(--primary-color);
            }
            
            /* Asegurar que las tablas regulares también funcionen */
            .results-table td:before {
                top: 3px !important;
                left: 8px !important;
                position: absolute !important;
                font-size: 11px !important;
                color: #666 !important;
            }

            .cards-grid {
                grid-template-columns: 1fr;
                gap: 25px;
            }

            .contact-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
                max-width: 100%;
                padding: 0 10px;
            }

            .contact-card-link {
                min-width: auto;
                padding: 12px 5px;
                font-size: 0.8em;
                text-align: center;
            }

            .contact-card-link h3 {
                font-size: 0.9em;
                margin-bottom: 4px;
            }

            .contact-card-link p {
                font-size: 0.75em;
                margin: 0;
            }

            .sticker-icon {
                width: 30px;
                height: 30px;
                margin: 0 auto 8px auto;
            }

            .status-indicator {
                position: relative;
                top: auto;
                right: auto;
                margin: 10px auto;
                display: inline-block;
            }
        }

        /* Extra small devices */
        @media (max-width: 480px) {
            .sponsors-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .contact-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                padding: 0 5px;
            }

            .contact-card-link:last-child {
                grid-column: 1 / -1;
                max-width: 200px;
                margin: 0 auto;
            }

            .contact-card-link {
                padding: 15px 8px;
                font-size: 0.85em;
            }

            .contact-card-link h3 {
                font-size: 1em;
            }

            .contact-card-link p {
                font-size: 0.8em;
            }
        }

        /* Share Button Styles */
        .share-cell {
            text-align: center !important;
            padding: 8px !important;
        }

        .share-btn {
            background: linear-gradient(135deg, #1e88e5, #00adef);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(30, 136, 229, 0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
        }

        .share-btn:hover {
            background: linear-gradient(135deg, #1976d2, #0099cc);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 136, 229, 0.4);
        }

        .share-btn:active {
            transform: translateY(0px);
        }

        /* Diploma Button Styles */
        .diploma-cell {
            text-align: center !important;
            padding: 8px !important;
        }

        .diploma-btn {
            border: none;
            padding: 8px 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
        }

        .diploma-btn.enabled {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);
        }

        .diploma-btn.enabled:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .diploma-btn.enabled:active {
            transform: translateY(0px);
        }

        .diploma-btn.disabled {
            background: #ffcdd2;
            color: #d32f2f;
            cursor: not-allowed;
            box-shadow: 0 2px 5px rgba(211, 47, 47, 0.2);
            opacity: 0.7;
        }

        .diploma-btn.disabled:hover {
            transform: none;
            background: #ffcdd2;
            opacity: 0.8;
        }
        
        /* Estilos para indicador de récord */
        .record-indicator {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            font-weight: bold;
            text-align: center;
            border-radius: 4px;
            padding: 4px 8px;
            box-shadow: 0 2px 4px rgba(255, 107, 53, 0.3);
        }
        
        .record-indicator::after {
            content: ' 🏆';
            margin-left: 4px;
        }

        /* Share Modal Styles */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .share-modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 0;
            max-width: 400px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        .share-modal-header {
            background: linear-gradient(135deg, #1e88e5, #00adef);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .share-modal-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .share-options {
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .share-option {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            font-weight: 500;
            text-decoration: none;
            color: #333;
        }

        .share-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .share-option.whatsapp {
            border-color: #25d366;
            color: #25d366;
        }

        .share-option.whatsapp:hover {
            background: #25d366;
            color: white;
        }

        .share-option.instagram {
            border-color: #e4405f;
            color: #e4405f;
        }

        .share-option.instagram:hover {
            background: #e4405f;
            color: white;
        }

        .share-icon {
            margin-right: 12px;
            font-size: 20px;
        }

        /* Clipboard Notification */
        .clipboard-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            z-index: 10001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .clipboard-notification.show {
            transform: translateX(0);
        }

        .notification-content {
            text-align: center;
            font-weight: 500;
        }

        .notification-content small {
            opacity: 0.9;
            font-size: 0.9em;
        }

        /* Responsive adjustments for share and diploma buttons */
        @media (max-width: 768px) {
            .share-btn, .diploma-btn {
                width: 30px;
                height: 30px;
                font-size: 14px;
                padding: 6px;
            }
            
            /* Mejorar visibilidad de diploma en móvil */
            .diploma-cell {
                min-width: 50px;
            }
            
            .diploma-btn.enabled {
                background: linear-gradient(135deg, #4caf50, #45a049);
                box-shadow: 0 2px 8px rgba(76, 175, 80, 0.4);
                border: 2px solid #4caf50;
            }
            
            .diploma-btn.disabled {
                background: #ffcdd2;
                border: 2px solid #d32f2f;
            }
            
            /* Añadir indicador visual para récords en móvil */
            .obs-cell {
                font-weight: bold;
                color: #1976d2;
            }
            
            /* Destacar filas con récord en móvil */
            tr:has(.diploma-btn.enabled) {
                background-color: rgba(76, 175, 80, 0.05);
                border-left: 3px solid #4caf50;
            }

            .share-modal-content {
                width: 95%;
                margin: 20px;
            }

            .share-modal-header {
                padding: 15px;
            }

            .share-modal-header h3 {
                font-size: 1.1rem;
            }

            .share-options {
                padding: 20px;
            }

            .share-option {
                padding: 12px 15px;
                font-size: 15px;
            }

            .clipboard-notification {
                right: 10px;
                top: 10px;
                max-width: 280px;
                padding: 12px 16px;
            }
        }

        /* Animation keyframes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* === CLASES NUEVAS PARA LIMPIAR ESTILOS INLINE === */
        /* Estilos de citas - SEGUROS */
        .quote-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
            font-style: italic;
            color: #0b1039;
        }
        
        .quote-author {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 5px;
            display: block;
            color: #00ADEF;
            font-weight: 500;
        }

        /* Estilos de estadísticas - SEGUROS */
        .stat-number {
            color: #0b1039;
            font-size: 3rem;
            font-weight: bold;
            margin: 0 0 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }
        
        .stat-description {
            color: #999;
            font-size: 0.9rem;
            margin-top: 8px;
        }

        /* Párrafos descriptivos - SEGUROS */
        .info-text-large {
            color: #666;
            margin: 0 0 15px 0;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        .info-text-small {
            color: #666;
            margin: 0 0 15px 0;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        /* Cards de estadísticas - SOLO estilos estáticos seguros */
        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(11, 16, 57, 0.1);
            border: 2px solid #e3f2fd;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(11, 16, 57, 0.15);
        }

        /* Layouts de botones - SEGUROS */
        .button-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .button-group-small {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Títulos de sección - SEGUROS */
        .section-subtitle {
            color: #0b1039;
            margin: 0 0 10px 0;
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .info-title {
            color: #0b1039;
            margin: 0 0 15px 0;
            font-size: 1.3rem;
        }
        
        .policy-title {
            color: #0b1039;
            margin: 0 0 8px 0;
            font-size: 1.4rem;
            font-weight: bold;
        }

        /* Estilos finales - últimos detalles */
        .quote-container {
            position: relative;
            height: 80px;
            display: flex;
            align-items: center;
        }
        
        .quotes-slider-inner {
            width: 100%;
            overflow: hidden;
        }
        
        .quotes-track-animated {
            display: flex;
            animation: slideQuotes 20s infinite linear;
        }
        
        .quote-item-styled {
            min-width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #0b1039;
            padding: 0 50px;
        }

        /* Metadatos y información adicional */
        .document-meta {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: #999;
        }
        
        .meta-text {
            color: #999;
            font-size: 0.8rem;
        }

        /* Layouts simples y centrado */
        .text-center-container {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .content-wrapper {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .flex-one {
            flex: 1;
        }

        /* Phase 5: Remaining inline style classes */
        .event-stats-section-bg {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 80px 0;
            border-bottom: 2px solid #e9ecef;
        }
        
        .event-stats-title {
            color: #0b1039;
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .event-stats-subtitle {
            color: #666;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .event-goal-card {
            background: linear-gradient(135deg, #0b1039, #00adef);
            border-radius: 15px;
            padding: 30px;
            margin-top: 50px;
            text-align: center;
            color: white;
        }
        
        .goal-card-title {
            color: white;
            margin: 0 0 15px 0;
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .goal-card-text {
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .terms-section-bg {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 80px 0;
            border-top: 3px solid #0b1039;
        }
        
        .terms-section-title {
            color: #0b1039;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .terms-main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(11, 16, 57, 0.1);
            border: 2px solid #e3f2fd;
        }
        
        .terms-header-row {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .terms-icon-box {
            background: linear-gradient(135deg, #0b1039, #00ADEF);
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }
        
        .terms-highlight-box {
            background: #f0f8ff;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #1e88e5;
        }
        
        .terms-list {
            color: #666;
            margin: 0;
            padding-left: 20px;
            line-height: 1.8;
        }
        
        .privacy-section-bg {
            background: #f8f9fa;
            padding: 60px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .privacy-content-wrapper {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .privacy-main-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(11, 16, 57, 0.08);
            border: 1px solid #e3f2fd;
        }
        
        .privacy-header-row {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .privacy-icon-box {
            background: linear-gradient(135deg, #6c757d, #495057);
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }
        
        .results-cta-card {
            background: linear-gradient(135deg, #0b1039 0%, #00ADEF 100%);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            color: white;
            box-shadow: 0 15px 40px rgba(11, 16, 57, 0.4);
        }
        
        .results-cta-title {
            color: white;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 600;
        }
        
        .results-cta-arrow {
            font-size: 2.5em;
            margin: 20px 0;
        }
        
        .results-cta-text {
            color: #dbeafe;
            font-size: 1.2em;
            margin-bottom: 0;
        }
        
        .clear-search-hidden {
            display: none;
        }
        
        .no-data-cell {
            text-align: center;
            padding: 40px;
            color: #a5a5a5;
        }
        
        .general-section-title {
            color: #0b1039;
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.8em;
            font-weight: 600;
        }
        
        .results-section-bg {
            background: #f8f9fa;
            border-top: 3px solid #0b1039;
        }
        
        .results-main-title {
            color: #0b1039;
        }
        
        .download-container-center {
            text-align: center;
            padding: 40px 20px;
        }
        
        .download-info-text {
            font-size: 1.2em;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .pdf-status-hidden {
            margin-top: 20px;
            display: none;
        }
        
        .pdf-status-text {
            color: #0b1039;
            font-weight: 500;
        }
        
        .pdf-status-icon {
            font-size: 1.2em;
        }
        
        .table-no-data {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .rank-empty-cell {
            text-align: center;
            color: #a5a5a5;
        }
        
        .athlete-empty-cell {
            color: #a5a5a5;
            font-style: italic;
        }
        
        .team-empty-cell {
            color: #a5a5a5;
        }
        
        .age-empty-cell {
            color: #a5a5a5;
        }
        
        .category-empty-cell {
            color: #a5a5a5;
        }
        
        .points-empty-cell {
            color: #a5a5a5;
        }
        
        .athlete-name-cell {
            font-weight: 600;
            color: #0b1039;
        }
        
        .total-points-cell {
            font-weight: bold;
            color: #00ADEF;
            font-size: 1.1em;
        }
        
        .points-200m-cell {
            color: #4caf50;
        }
        
        .points-50m-cell {
            color: #ff9800;
        }
        
        .points-100m-cell {
            color: #9c27b0;
        }
        
        .team-name-cell {
            font-weight: 600;
            color: #0b1039;
        }
        
        .female-points-cell {
            color: #e91e63;
        }
        
        .male-points-cell {
            color: #2196f3;
        }
        
        .female-points-value {
            color: #e91e63;
        }
        
        .male-points-value {
            color: #2196f3;
        }
        
        .error-message-cell {
            text-align: center;
            padding: 40px;
            color: #f44336;
        }
        
        .error-subtitle {
            color: #a5a5a5;
            margin-top: 10px;
            display: block;
        }
        
        .retry-button {
            margin-top: 15px;
            padding: 10px 20px;
            background: #00ADEF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .share-modal-content-center {
            text-align: center;
            max-width: 400px;
        }
        
        .instagram-title {
            color: var(--secondary-color);
        }
        
        .share-content-padding {
            padding: 20px;
        }
        
        .share-icon-large {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .share-description {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .share-steps-box {
            background: var(--background-light);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            text-align: left;
        }
        
        .share-step {
            margin: 5px 0;
        }
        
        .status-loading-text {
            color: #0b1039;
            font-weight: 500;
        }
        
        .status-loading-icon {
            font-size: 1.2em;
        }
        
        .status-error-text {
            color: red;
        }
        
        .button-loading-text {
            margin-right: 8px;
        }
        
        .button-success-text {
            margin-right: 8px;
        }
        
        .button-error-text {
            margin-right: 8px;
        }
        
        .button-not-available-text {
            margin-right: 8px;
        }
        
        .button-privacy-icon {
            margin-right: 6px;
        }
        
        .unavailable-doc-icon {
            color: #0b1039;
            margin-bottom: 15px;
            font-size: 2rem;
        }
        
        .unavailable-doc-title {
            color: #0b1039;
            margin: 0 0 10px 0;
        }
        
        .unavailable-doc-text {
            color: #666;
            margin: 0 0 20px 0;
            line-height: 1.5;
        }
        
        .privacy-unavailable-icon {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 2rem;
        }
        
        .privacy-unavailable-title {
            color: #0b1039;
            margin: 0 0 10px 0;
        }
        
        .privacy-unavailable-text {
            color: #666;
            margin: 0 0 20px 0;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        /* Final 8 validation fixes */
        .quotes-slider-background {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px 0;
            border-top: 3px solid #00ADEF;
            border-bottom: 3px solid #0b1039;
            position: relative;
            overflow: hidden;
        }
        
        .main-download-btn {
            background: linear-gradient(135deg, #0b1039, #00ADEF);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(11, 16, 57, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }
        
        .main-download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(11, 16, 57, 0.4);
        }
        
        .document-download-btn {
            background: linear-gradient(135deg, #00ADEF, #0099d8);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .document-download-btn:hover {
            background: linear-gradient(135deg, #0099d8, #0088c7);
            transform: translateY(-1px);
        }
        
        .icon-span-large {
            font-size: 1.2em;
        }
        
        .modal-close-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 15px;
        }
        
        .modal-close-btn:hover {
            background: #5a6268;
        }
        
        .modal-remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .modal-remove-btn:hover {
            background: rgba(255, 255, 255, 1);
            color: #000;
        }
        
        /* Accessibility: Hidden labels for screen readers */
        .visually-hidden {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        /* Responsive adjustments for documents section */
        @media (max-width: 768px) {
            /* Hacer que cada documento sea un bloque independiente y centrado */
            .terms-main-card {
                margin-bottom: 30px;
            }
            
            .privacy-main-card {
                margin-top: 30px;
            }
            
            .terms-header-row,
            .privacy-header-row {
                flex-direction: column;
                text-align: center;
                gap: 20px;
                align-items: center;
            }
            
            .terms-icon-box,
            .privacy-icon-box {
                align-self: center;
                margin-bottom: 10px;
            }
            
            .terms-icon-box {
                width: 60px;
                height: 60px;
            }
            
            /* Agrupar contenido de cada documento */
            .flex-one {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            /* Reestructurar botones para que cada uno tenga su texto explicativo debajo */
            .button-group {
                flex-direction: column;
                gap: 25px;
                margin: 20px 0;
            }
            
            .button-group-small {
                justify-content: center;
                margin: 15px 0;
            }
            
            /* Ocultar el document-meta original y crear nuevos elementos debajo de cada botón */
            .document-meta {
                display: none;
            }
            
            /* Crear grupos de botón + texto explicativo */
            .button-group button:nth-child(1)::after {
                content: "📄 PDF Generado • Agosto 2025";
                display: block;
                font-size: 0.85rem;
                color: #666;
                margin-top: 8px;
                font-weight: normal;
            }
            
            .button-group button:nth-child(2)::after {
                content: "📋 Documento Oficial • Versión Completa";
                display: block;
                font-size: 0.85rem;
                color: #666;
                margin-top: 8px;
                font-weight: normal;
            }
            
            .meta-text {
                justify-content: center;
                text-align: center;
                margin-top: 8px;
                font-size: 0.85rem;
                color: #666;
                display: block;
            }
            
            /* Separación visual entre las dos secciones principales */
            .privacy-policy-section {
                border-top: 3px solid #e9ecef;
                padding-top: 40px;
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <div class="logo-box">
                <img src="img/LogoChampion2025.png" alt="Logo IV Championship Master">
            </div>
            
            <!-- Navigation Menu -->
            <div class="nav-menu" id="navMenu">
                <ul class="nav-links">
                    <li><a href="#inicio" onclick="scrollToSection('video-hero')">Inicio</a></li>
                    <li><a href="#informacion" onclick="scrollToSection('info-section')">Información</a></li>
                    <li><a href="#terminos" onclick="scrollToSection('terms-section')">Términos</a></li>
                    <li><a href="#resultados" onclick="scrollToSection('results-section')">Resultados</a></li>
                    <li><a href="#patrocinadores" onclick="scrollToSection('sponsors-section')">Patrocinadores</a></li>
                    <li><a href="#contacto" onclick="scrollToSection('contact-section')">Contacto</a></li>
                </ul>
            </div>
            
            <!-- Mobile Menu Toggle -->
            <div class="mobile-menu-toggle" id="mobileToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
            
            <div class="logo-box">
                <img src="img/LogoClubes.png" alt="Logo Clubes">
            </div>
        </nav>
    </header>

    <!-- Status Indicator -->
    <div id="statusIndicator" class="status-indicator status-loading">
        🔄 Cargando resultados...
    </div>

    

    <!-- Video Hero Section -->
    <section class="video-hero" id="inicio">
        <div class="video-container">
            <!-- playsinline: Required for iOS Safari inline video playback -->
            <video autoplay muted loop playsinline="true" src="video/promocional.mp4">
                Tu navegador no soporta la etiqueta de video.
            </video>
        </div>
        <div class="video-overlay">
            <div class="hero-content">
                <h1>IV Championship Master Swimming 2025</h1>
                <p class="subtitle">Competencia de Natación</p>
            </div>
        </div>
    </section>

    <!-- Inspirational Quotes Slider Section -->
    <section class="quotes-slider-section quotes-slider-background">
        <div class="container">
            <div class="quote-container">
                <div class="quotes-slider quotes-slider-inner">
                    <div class="quotes-track quotes-track-animated">
                        <div class="quote-item quote-item-styled">
                            <div>
                                <p class="quote-text">"El agua es mi territorio, la piscina mi hogar"</p>
                                <span class="quote-author">- Espíritu Nadador</span>
                            </div>
                        </div>
                        <div class="quote-item quote-item-styled">
                            <div>
                                <p class="quote-text">"La natación es más que un deporte: es una lección de paciencia, resistencia y superación"</p>
                                <span class="quote-author">- Dara Torres - Nadadora Olimpica USA</span>
                            </div>
                        </div>
                        <div class="quote-item quote-item-styled">
                            <div>
                                <p class="quote-text">"Cada brazada es un paso más hacia la meta; no importa la velocidad, importa no detenerse"</p>
                                <span class="quote-author">- Janet Evans - Nadadora Olimpica USA</span>
                            </div>
                        </div>
                        <div class="quote-item quote-item-styled">
                            <div>
                                <p class="quote-text">"La natación te enseña que incluso en silencio puedes lograr grandes cosas"</p>
                                <span class="quote-author">- Katie Ledecky - Nadadora Olimpica USA</span>
                            </div>
                        </div>
                        <div class="quote-item quote-item-styled">
                            <div>
                                <p class="quote-text">"Nada y entrena de manera inteligente"</p>
                                <span class="quote-author">- Raúl Vicuña - #NadadorInteligente</span>
                            </div>
                        </div>
                        <!-- Duplicar las frases para efecto continuo -->
                        <div class="quote-item quote-item-styled">
                            <div>
                                <p class="quote-text">"El agua es mi territorio, la piscina mi hogar"</p>
                                <span class="quote-author">- Espiritu Nadador</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Event Statistics Section -->
    <section class="event-stats-section event-stats-section-bg">
        <div class="container">
            <div class="text-center-container">
                <h2 class="event-stats-title">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 3V21H21V19H5V3H3ZM19 17H17V10H19V17ZM15 17H13V7H15V17ZM11 17H9V13H11V17ZM7 17H5V15H7V17Z" fill="#0b1039"/>
                    </svg>
                    Estadísticas del Evento
                </h2>
                <p class="event-stats-subtitle">
                    Conoce los números que hacen del IV Championship Master Swimming un evento único
                </p>
            </div>
            
            <div class="stats-grid">
                
                <!-- Nadadores Inscritos -->
                <div class="stat-card">
                    <div class="sticker-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- Head -->
                            <circle cx="12" cy="12" r="6" fill="#0b5079"/>
                            <!-- Swimming cap -->
                            <path d="M6 12C6 8 8.5 5 12 5S18 8 18 12V15C18 16 17 17 16 17H8C7 17 6 16 6 15V12Z" fill="#00ADEF"/>
                            <!-- Goggles -->
                            <circle cx="9.5" cy="11.5" r="2" fill="#ffffff" stroke="#0b5079" stroke-width="1"/>
                            <circle cx="14.5" cy="11.5" r="2" fill="#ffffff" stroke="#0b5079" stroke-width="1"/>
                            <rect x="11.5" y="11" width="1" height="1" fill="#0b5079" rx="0.5"/>
                        </svg>
                    </div>
                    <h3 class="stat-number" id="swimmerCount">50+</h3>
                    <p class="stat-label">Nadadores Inscritos</p>
                    <p class="stat-description">Atletas de élite</p>
                </div>
                
                <!-- Clubes Participantes -->
                <div class="stat-card">
                    <div class="sticker-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- House roof -->
                            <path d="M3 12L12 3L21 12" stroke="#00ADEF" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <!-- House body -->
                            <path d="M5 12V19C5 19.5523 5.44772 20 6 20H18C18.5523 20 19 19.5523 19 19V12" stroke="#0b5079" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <!-- Door -->
                            <rect x="10" y="15" width="4" height="5" stroke="#00ADEF" stroke-width="1.8" rx="0.5"/>
                            <circle cx="12.8" cy="17.5" r="0.3" fill="#0b5079"/>
                            <!-- Windows -->
                            <rect x="7" y="13" width="2.5" height="2.5" stroke="#0b5079" stroke-width="1.5" rx="0.2"/>
                            <rect x="14.5" y="13" width="2.5" height="2.5" stroke="#0b5079" stroke-width="1.5" rx="0.2"/>
                            <!-- Chimney -->
                            <rect x="16" y="7" width="1.5" height="4" stroke="#0b5079" stroke-width="1.5"/>
                        </svg>
                    </div>
                    <h3 class="stat-number" id="clubCount">4+</h3>
                    <p class="stat-label">Clubes Participantes</p>
                    <p class="stat-description">De todo el país</p>
                </div>
                
                <!-- Patrocinadores -->
                <div class="stat-card">
                    <div class="sticker-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- 5-point star outline -->
                            <path d="M12 2L14.4 8.8L22 9.6L17 14.4L18.8 22L12 18.4L5.2 22L7 14.4L2 9.6L9.6 8.8L12 2Z" fill="none" stroke="#00ADEF" stroke-width="2.5"/>
                            <!-- Center point -->
                            <circle cx="12" cy="12" r="2" fill="#0b5079"/>
                            <!-- Center highlight -->
                            <circle cx="12" cy="12" r="1.2" fill="#ffffff" opacity="0.4"/>
                        </svg>
                    </div>
                    <h3 class="stat-number" id="sponsorCount">4+</h3>
                    <p class="stat-label">Patrocinadores</p>
                    <p class="stat-description">Empresas aliadas</p>
                </div>
            </div>
            
            <!-- Additional Info Bar -->
            <div class="event-goal-card">
                <h4 class="goal-card-title">🎯 Meta del Evento</h4>
                <p class="goal-card-text">
                   Una gran oportunidad para que los nadadores de edades de infantil B hasta Master demuestren sus habilidades, compitiendo.
                   Nuestra meta es promover la competición para superarse personalmente y fomentar la sana rivalidad,
                   disfrutando del deporte y del entorno social para mantenerse fuerte tanto física como mentalmente, 
                   promoviendo la excelencia deportiva y el compañerismo en la natación.
                </p>
            </div>
        </div>
    </section>

    <!-- Info Section -->
    <section class="info-section" id="informacion">
        <div class="container">
            <h2 class="section-title">Información del Evento</h2>
            <div class="cards-grid">
                <div class="info-card">
                    <div class="sticker-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z" stroke="#00ADEF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 6V12L16 14" stroke="#00ADEF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <h3>Categorías</h3>
                    <p>Competencias para categorías desde infantil B hasta Máster </p>
                </div>
                <div class="info-card">
                    <div class="sticker-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="#0b5079" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><line x1="16" y1="2" x2="16" y2="6" stroke="#0b5079" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><line x1="8" y1="2" x2="8" y2="6" stroke="#0b5079" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><line x1="3" y1="10" x2="21" y2="10" stroke="#0b5079" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <h3>Fecha</h3>
                    <p>23 de agosto de 2025 en Piscina de la Villaolimpica en Monteria - Córdoba</p>
                </div>
                <div class="info-card">
                    <div class="sticker-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 8V12L14.5 14.5" stroke="#00ADEF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20.9998 12C20.9998 16.9706 16.9704 21 11.9998 21C7.02926 21 2.99982 16.9706 2.99982 12C2.99982 7.02944 7.02926 3 11.9998 3C13.8837 3 15.6265 3.58628 17.0615 4.61538" stroke="#00ADEF" stroke-width="2" stroke-linecap="round"/><path d="M18 5.5L21 2.5M21 2.5L18 2.5M21 2.5V5.5" stroke="#00ADEF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <h3>Premios</h3>
                    <p>Medallas de participación, premiación por categoría y sexo por acumulación de puntos, trofeos a los tres primeros equipos</p>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Terms and Conditions Section -->
    <section class="terms-section terms-section-bg" id="terminos">
        <div class="container">
            <h2 class="section-title terms-section-title">
                <svg width="35" height="35" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20ZM8 12V14H16V12H8ZM8 16V18H13V16H8Z" fill="#0b1039"/>
                </svg>
                Documentos de la Convocatoria
            </h2>
            
            <div class="content-wrapper">
                <div class="terms-main-card">
                    
                    <!-- Terms and Conditions Card -->
                    <div class="terms-header-row">
                        <div class="terms-icon-box">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20ZM8 12V14H16V12H8ZM8 16V18H13V16H8Z" fill="white"/>
                            </svg>
                        </div>
                        <div class="flex-one">
                            <h3 class="section-subtitle">Términos y Condiciones</h3>
                            <p class="info-text-large">
                                Descarga el documento oficial con todos los términos, condiciones y reglamentos de la convocatoria del IV Championship Master Swimming.
                            </p>
                            <div class="button-group">
                                <button type="button" onclick="downloadTermsAndConditions()" class="document-download-btn">
                                    <span class="button-loading-text">📄</span>
                                    Generar PDF
                                </button>
                                <button type="button" onclick="downloadLocalDocument()" class="document-download-btn">
                                    <span class="button-loading-text">⬇️</span>
                                    Documento Oficial
                                </button>
                            </div>
                            <div class="document-meta">
                                <span>📄 PDF Generado • Agosto 2025</span>
                                <span>📋 Documento Oficial • Versión Completa</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Info -->
                    <div class="terms-highlight-box">
                        <h4 class="info-title">ℹ️ Información Importante</h4>
                        <ul class="terms-list">
                            <li>Es <strong>obligatorio</strong> leer y aceptar los términos antes de la participación</li>
                            <li>El documento incluye reglamentos técnicos, normas de seguridad y políticas del evento</li>
                            <li>Para dudas o consultas, contacta al equipo organizador a través de nuestros canales oficiales</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Privacy Policy Section -->
    <section class="privacy-policy-section privacy-section-bg">
        <div class="container">
            <div class="privacy-content-wrapper">
                <div class="privacy-main-card">
                    
                    <!-- Privacy Policy Card -->
                    <div class="privacy-header-row">
                        <div class="privacy-icon-box">
                            <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 8H17V6C17 3.24 14.76 1 12 1S7 3.24 7 6V8H6C4.9 8 4 8.9 4 10V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V10C20 8.9 19.1 8 18 8ZM9 6C9 4.34 10.34 3 12 3S15 4.34 15 6V8H9V6ZM18 20H6V10H18V20ZM12 17C13.1 17 14 16.1 14 15S13.1 13 12 13 10 13.9 10 15 10.9 17 12 17Z" fill="white"/>
                            </svg>
                        </div>
                        <div class="flex-one">
                            <h4 class="policy-title">Política de Tratamiento de Datos Personales</h4>
                            <p class="info-text-small">
                                Conoce cómo protegemos y manejamos tu información personal durante el evento.
                            </p>
                            <div class="button-group-small">
                                <button type="button" onclick="downloadPrivacyPolicy()" class="document-download-btn">
                                    <span class="button-privacy-icon">📄</span>
                                    Descargar
                                </button>
                                <span class="meta-text">
                                    PDF • Versión 2025
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Swimmers Message Section -->
    <section class="swimmers-message-section">
        <div class="container">
            <div class="results-cta-card">
                <h3 class="results-cta-title">¡Querido nadador: al finalizar la prueba encuentra los resultados aquí</h3>
                <div class="results-cta-arrow">👇</div>
                <p class="results-cta-text">Búscalos y comparte tus logros al mundo en tu red social favorita!</p>
            </div>
        </div>
    </section>

    <!-- Results Section -->
    <section class="results-section" id="resultados">
        <div class="container">
            <h2 class="section-title">Resultados por Pruebas</h2>
            
            <!-- Search Container for Pruebas -->
            <div class="search-container">
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <label for="searchPruebas" class="visually-hidden">Buscar participante por nombre en resultados por pruebas</label>
                    <input type="text" class="search-input" id="searchPruebas" placeholder="Buscar participante por nombre...">
                    <button type="button" class="clear-search clear-search-hidden" onclick="clearSearch('searchPruebas')">✕</button>
                </div>
                <div class="search-results-info" id="searchResultsPruebas"></div>
            </div>
            
            <div class="results-container">
                <div class="last-update">
                    Última actualización: <span class="time" id="lastUpdateTime">Cargando...</span>
                </div>
                
                <div class="tabs">
                    <button type="button" class="tab-button active" onclick="openTab(event, '50m-libre-femenino')">50 m Libre Femenino</button>
                    <button type="button" class="tab-button" onclick="openTab(event, '50m-libre-masculino')">50 m Libre Masculino</button>
                    <button type="button" class="tab-button" onclick="openTab(event, '100m-libre-femenino')">100 m Libre Femenino</button>
                    <button type="button" class="tab-button" onclick="openTab(event, '100m-libre-masculino')">100 m Libre Masculino</button>
                    <button type="button" class="tab-button" onclick="openTab(event, '200m-libre-femenino')">200 m Libre Femenino</button>
                    <button type="button" class="tab-button" onclick="openTab(event, '200m-libre-masculino')">200 m Libre Masculino</button>
                    <button type="button" class="tab-button" onclick="openTab(event, '4x50m-libre-mixto')">4x50 m Relevo L.Mixto</button>
                </div>
                <!-- Pestaña 50 m Libre Femenino -->
                <div id="50m-libre-femenino" class="tab-content active">
                    <h3>🏊‍♀️ 50 m Libre Femenino - Resultados Oficiales</h3>
                    <table class="results-table" id="resultsTableFem">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Nadadora</th>
                                <th>Equipo</th>
                                <th>Edad</th>
                                <th>Categoría</th>
                                <th>Tiempo Final</th>
                                <th>Puntos</th>
                                <th>Obs</th>
                                <th>Compartir</th>
                                <th>Diploma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="loading-row">
                                <td colspan="10" class="no-data-cell">
                                    🔄 Cargando datos desde Google Sheets...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pestaña 50 m Libre Masculino -->
                <div id="50m-libre-masculino" class="tab-content">
                    <h3>🏊‍♂️ 50 m Libre Masculino - Resultados Oficiales</h3>
                    <table class="results-table" id="resultsTableMas">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Nadador</th>
                                <th>Equipo</th>
                                <th>Edad</th>
                                <th>Categoría</th>
                                <th>Tiempo Final</th>
                                <th>Puntos</th>
                                <th>Obs</th>
                                <th>Compartir</th>
                                <th>Diploma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="loading-row">
                                <td colspan="10" class="no-data-cell">
                                    🔄 Cargando datos desde Google Sheets...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pestaña 100 m Libre Femenino -->
                <div id="100m-libre-femenino" class="tab-content">
                    <h3>🏊‍♀️ 100 m Libre Femenino - Resultados Oficiales</h3>
                    <table class="results-table" id="resultsTable100mFem">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Nadadora</th>
                                <th>Equipo</th>
                                <th>Edad</th>
                                <th>Categoría</th>
                                <th>Tiempo Final</th>
                                <th>Puntos</th>
                                <th>Obs</th>
                                <th>Compartir</th>
                                <th>Diploma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="loading-row">
                                <td colspan="10" class="no-data-cell">
                                    🔄 Cargando datos desde Google Sheets...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pestaña 100 m Libre Masculino -->
                <div id="100m-libre-masculino" class="tab-content">
                    <h3>🏊‍♂️ 100 m Libre Masculino - Resultados Oficiales</h3>
                    <table class="results-table" id="resultsTable100mMas">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Nadador</th>
                                <th>Equipo</th>
                                <th>Edad</th>
                                <th>Categoría</th>
                                <th>Tiempo Final</th>
                                <th>Puntos</th>
                                <th>Obs</th>
                                <th>Compartir</th>
                                <th>Diploma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="loading-row">
                                <td colspan="10" class="no-data-cell">
                                    🔄 Cargando datos desde Google Sheets...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pestaña 200 m Libre Femenino -->
                <div id="200m-libre-femenino" class="tab-content">
                    <h3>🏊‍♀️ 200 m Libre Femenino - Resultados Oficiales</h3>
                    <table class="results-table" id="resultsTable200mFem">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Nadadora</th>
                                <th>Equipo</th>
                                <th>Edad</th>
                                <th>Categoría</th>
                                <th>Tiempo Final</th>
                                <th>Puntos</th>
                                <th>Obs</th>
                                <th>Compartir</th>
                                <th>Diploma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="loading-row">
                                <td colspan="10" class="no-data-cell">
                                    🔄 Cargando datos desde Google Sheets...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pestaña 200 m Libre Masculino -->
                <div id="200m-libre-masculino" class="tab-content">
                    <h3>🏊‍♂️ 200 m Libre Masculino - Resultados Oficiales</h3>
                    <table class="results-table" id="resultsTable200mMas">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Nadador</th>
                                <th>Equipo</th>
                                <th>Edad</th>
                                <th>Categoría</th>
                                <th>Tiempo Final</th>
                                <th>Puntos</th>
                                <th>Obs</th>
                                <th>Compartir</th>
                                <th>Diploma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="loading-row">
                                <td colspan="10" class="no-data-cell">
                                    🔄 Cargando datos desde Google Sheets...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pestaña 4x50 m Relevo L.Mixto -->
                <div id="4x50m-libre-mixto" class="tab-content">
                    <h3>🏊‍♂️🏊‍♀️ 4x50 m Relevo L.Mixto - Resultados Oficiales</h3>
                    <table class="results-table" id="resultsTable4x50mMixto">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Nadador/a</th>
                                <th>Equipo</th>
                                <th>Edad</th>
                                <th>Categoría</th>
                                <th>Tiempo Final</th>
                                <th>Puntos</th>
                                <th>Compartir</th>
                                <th>Certificado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="loading-row">
                                <td colspan="9" class="no-data-cell">
                                    🔄 Cargando datos desde Google Sheets...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Gender Results Section -->
    <section class="results-section">
        <div class="container">
            <h2 class="section-title">Resultados por Género</h2>
            
            <!-- Search Container for Gender -->
            <div class="search-container">
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <label for="searchGender" class="visually-hidden">Buscar participante por nombre en clasificación general</label>
                    <input type="text" class="search-input" id="searchGender" placeholder="Buscar participante por nombre...">
                    <button class="clear-search clear-search-hidden" onclick="clearSearch('searchGender')">✕</button>
                </div>
                <div class="search-results-info" id="searchResultsGender"></div>
            </div>
            
            <div class="results-container">
                <div class="last-update">
                    Última actualización: <span class="time" id="lastUpdateTimeGender">Cargando...</span>
                </div>
                
                <div class="tabs">
                    <button class="tab-button active" onclick="openGenderTab(event, 'masculino-general')">🏊‍♂️ Masculino</button>
                    <button type="button" class="tab-button" onclick="openGenderTab(event, 'femenino-general')">🏊‍♀️ Femenino</button>
                </div>

                <!-- Pestaña Masculino General -->
                <div id="masculino-general" class="tab-content active">
                    <h3>🏊‍♂️ Clasificación General Masculina</h3>
                    <table class="results-table" id="resultsTableMasculinoGeneral">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Atleta</th>
                                <th>Equipo</th>
                                <th>Edad</th>
                                <th>Categoría</th>
                                <th>Puntos Totales</th>
                                <th>P. 200m Libre</th>
                                <th>P. 50m Libre</th>
                                <th>P. 100m Libre</th>
                                <th>Compartir</th>
                                <th>Diploma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="loading-row">
                                <td colspan="11" class="no-data-cell">
                                    🔄 Cargando clasificación masculina...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pestaña Femenino General -->
                <div id="femenino-general" class="tab-content">
                    <h3>🏊‍♀️ Clasificación General Femenina</h3>
                    <table class="results-table" id="resultsTableFemeninoGeneral">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Atleta</th>
                                <th>Equipo</th>
                                <th>Edad</th>
                                <th>Categoría</th>
                                <th>Puntos Totales</th>
                                <th>P. 200m Libre</th>
                                <th>P. 50m Libre</th>
                                <th>P. 100m Libre</th>
                                <th>Compartir</th>
                                <th>Diploma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="loading-row">
                                <td colspan="11" class="no-data-cell">
                                    🔄 Cargando clasificación femenina...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Team Results Section -->
    <section class="results-section">
        <div class="container">
            <h2 class="section-title">Resultados por Equipos</h2>
            <div class="results-container">
                <div class="last-update">
                    Última actualización: <span class="time" id="lastUpdateTimeTeams">Cargando...</span>
                </div>
                
                <h3 class="general-section-title">
                    🏆 Clasificación General por Equipos
                </h3>
                
                <table class="results-table" id="resultsTableTeams">
                    <thead>
                        <tr>
                            <th>Lugar</th>
                            <th>Equipo</th>
                            <th>Puntos Totales</th>
                            <th>Puntos Femeninos</th>
                            <th>Puntos Masculinos</th>
                            <th>Compartir</th>
                            <th>Diploma</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="loading-row">
                            <td colspan="7" class="no-data-cell">
                                🔄 Cargando clasificación de equipos...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Download Results Section -->
    <section class="results-section results-section-bg">
        <div class="container">
            <h2 class="section-title results-main-title">📄 Descargar Resultados</h2>
            <div class="download-container download-container-center">
                <div class="download-info">
                    <p class="download-info-text">
                        Descarga un reporte completo en PDF con todos los resultados del evento, 
                        incluyendo clasificaciones por pruebas, género y equipos.
                    </p>
                </div>
                <button id="downloadPdfBtn" class="download-btn main-download-btn">
                    <span class="icon-span-large">📋</span>
                    Descargar Resultados PDF
                </button>

                
                <div id="pdfStatus" class="pdf-status-hidden">
                    <p class="pdf-status-text">
                        <span class="pdf-status-icon">⏳</span> Generando PDF...
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Sponsors Section -->
    <section class="sponsors-section" id="patrocinadores">
        <div class="container">
            <h2 class="section-title">Nuestros Patrocinadores</h2>
            <div class="sponsors-grid">
                <a href="https://www.instagram.com/techfucol/" target="_blank" class="sponsor-card">
                    <div class="sponsor-logo"><img src="/img/techfucol.png" alt="Patrocinador 1"></div>
                    <div class="sponsor-name">TechFuCol</div>
                </a>
                <a href="https://www.instagram.com/konkretescol" target="_blank" class="sponsor-card">
                    <div class="sponsor-logo"><img src="/img/konkretes.png" alt="Patrocinador 2"></div>
                    <div class="sponsor-name">Konkretes</div>
                </a>
                <a href="https://www.instagram.com/hypersatelliteapp/" target="_blank" class="sponsor-card">
                    <div class="sponsor-logo"><img src="/img/dr-innova.png" alt="Patrocinador 3"></div>
                    <div class="sponsor-name">DR-Innova</div>
                </a>
                    <a href="#" target="_blank" class="sponsor-card">
                    <div class="sponsor-logo"><img src="/img/michanchito.png" alt="Patrocinador 4"></div>
                    <div class="sponsor-name">Mi Chanchito</div>
                </a>
                <a href="https://www.instagram.com/quiropediaemma/" target="_blank" class="sponsor-card">
                    <div class="sponsor-logo"><img src="/img/emma-quiropedia.png" alt="Patrocinador 5"></div>
                    <div class="sponsor-name">Emma Quiropedia</div>
                </a>
                <a href="https://www.instagram.com/bambinotiendadelujo__89/" target="_blank" class="sponsor-card">
                    <div class="sponsor-logo"><img src="/img/bambino.png" alt="Patrocinador 6"></div>
                    <div class="sponsor-name">Bambino - Tienda de Lujo</div>
                </a>
            </div>
            
            <!-- Thank You Message Section -->
            <div class="sponsor-thank-you-section">
                <div class="thank-you-message">
                    <h3>¡Gracias por hacer posible este gran evento!</h3>
                    <p>El IV Championship Master Swimming no sería posible sin el apoyo incondicional de nuestros patrocinadores. Su compromiso con el deporte y la comunidad de natación hace que cada brazada cuente y cada sueño se haga realidad. ¡Comparte tu agradecimiento!</p>
                    
                    <div class="share-thanks-buttons">
                        <button class="share-thanks-btn whatsapp-thanks" onclick="shareThankYouMessage('whatsapp')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16.75 13.96C16.41 13.79 15.31 13.24 15.08 13.15C14.86 13.06 14.7 13.02 14.54 13.28C14.38 13.55 13.91 14.11 13.75 14.28C13.59 14.45 13.43 14.47 13.16 14.3C12.89 14.13 12.06 13.85 11.07 12.99C10.29 12.3 9.73 11.48 9.59 11.21C9.45 10.94 9.56 10.81 9.7 10.67C9.83 10.53 9.99 10.33 10.13 10.18C10.27 10.03 10.32 9.9 10.42 9.73C10.52 9.56 10.47 9.4 10.39 9.27C10.31 9.14 9.85 7.97 9.66 7.52C9.47 7.07 9.28 7.13 9.14 7.12H8.62C8.42 7.12 8.13 7.19 7.89 7.43C7.65 7.67 6.96 8.31 6.96 9.56C6.96 10.81 7.92 12.01 8.06 12.18C8.2 12.35 9.85 14.8 12.29 15.76C14.73 16.72 14.73 16.34 15.13 16.3C15.53 16.26 16.54 15.68 16.75 15.13C16.96 14.58 16.96 14.12 16.88 13.96H16.75Z"/>
                                <path d="M12.04 21.82C17.56 21.82 22 17.38 22 11.86C22 6.34 17.56 1.9 12.04 1.9C6.52 1.9 2.08 6.34 2.08 11.86C2.08 14.13 2.84 16.24 4.12 17.9L2.56 21.34L6.17 19.95C7.73 21.13 9.79 21.82 12.04 21.82Z"/>
                            </svg>
                            Compartir por WhatsApp
                        </button>
                        
                        <button class="share-thanks-btn instagram-thanks" onclick="shareThankYouMessage('instagram')">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
                                <path d="M16 11.37C16 13.38 14.21 15 12 15C9.79 15 8 13.38 8 11.37C8 9.36 9.79 7.75 12 7.75C14.21 7.75 16 9.36 16 11.37Z"/>
                                <path d="M17.5 6.5H17.51"/>
                            </svg>
                            Compartir en Instagram
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="container">
            <h2>¿Listo para competir?</h2>
            <p>Únete a los mejores nadadores en esta emocionante competencia, en esta IV versión del Championship Master Swimming organizada por los Clubes Deportivos AQUATEN y ELYANASNATACION</p>
            <a href="#" class="cta-button">Más Información</a>
        </div>
    </section>
    
    <!-- Contact Section -->
    <section class="contact-section" id="contacto">
        <div class="container">
            <h2 class="section-title">Contacto</h2>
            <div class="contact-grid">
                <!-- WhatsApp Card -->
                <a href="https://wa.me/573196583574" target="_blank" rel="noopener" class="contact-card-link">
                    <div class="sticker-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.75 13.96C16.41 13.79 15.31 13.24 15.08 13.15C14.86 13.06 14.7 13.02 14.54 13.28C14.38 13.55 13.91 14.11 13.75 14.28C13.59 14.45 13.43 14.47 13.16 14.3C12.89 14.13 12.06 13.85 11.07 12.99C10.29 12.3 9.73 11.48 9.59 11.21C9.45 10.94 9.56 10.81 9.7 10.67C9.83 10.53 9.99 10.33 10.13 10.18C10.27 10.03 10.32 9.9 10.42 9.73C10.52 9.56 10.47 9.4 10.39 9.27C10.31 9.14 9.85 7.97 9.66 7.52C9.47 7.07 9.28 7.13 9.14 7.12H8.62C8.42 7.12 8.13 7.19 7.89 7.43C7.65 7.67 6.96 8.31 6.96 9.56C6.96 10.81 7.92 12.01 8.06 12.18C8.2 12.35 9.85 14.8 12.29 15.76C14.73 16.72 14.73 16.34 15.13 16.3C15.53 16.26 16.54 15.68 16.75 15.13C16.96 14.58 16.96 14.12 16.88 13.96H16.75Z" stroke="#0b5079" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.04 21.82C17.56 21.82 22 17.38 22 11.86C22 6.34 17.56 1.9 12.04 1.9C6.52 1.9 2.08 6.34 2.08 11.86C2.08 14.13 2.84 16.24 4.12 17.9L2.56 21.34L6.17 19.95C7.73 21.13 9.79 21.82 12.04 21.82Z" stroke="#00ADEF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <h3>WhatsApp</h3>
                    <p>+57 319 658 3574</p>
                </a>
                <!-- Instagram Card -->
                <a href="https://www.instagram.com/aquaten.cd" target="_blank" rel="noopener" class="contact-card-link">
                    <div class="sticker-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="20" height="20" rx="5" ry="5" stroke="#00ADEF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 11.37C16 13.38 14.21 15 12 15C9.79 15 8 13.38 8 11.37C8 9.36 9.79 7.75 12 7.75C14.21 7.75 16 9.36 16 11.37Z" stroke="#0b5079" stroke-width="2"/><path d="M17.5 6.5H17.51" stroke="#0b5079" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <h3>Instagram</h3>
                    <p>@AquaTEN</p>
                </a>
                <a href="https://www.instagram.com/elyanasnatacion/" target="_blank" rel="noopener" class="contact-card-link">
                    <div class="sticker-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="20" height="20" rx="5" ry="5" stroke="#00ADEF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 11.37C16 13.38 14.21 15 12 15C9.79 15 8 13.38 8 11.37C8 9.36 9.79 7.75 12 7.75C14.21 7.75 16 9.36 16 11.37Z" stroke="#0b5079" stroke-width="2"/><path d="M17.5 6.5H17.51" stroke="#0b5079" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <h3>Instagram</h3>
                    <p>@Elyanasnatacion</p>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 AquaTEN - Club Deportivo</p>
            <p>IV Championship Master Swimming - Todos los derechos reservados</p>
        </div>
    </footer>

    <script>
        // Variables globales
        let lastUpdateTime = null;
        let loadAttempts = 0;
        const MAX_ATTEMPTS = 3;

        // Configuración
        const CONFIG = {
            API_KEY: 'AIzaSyDcUEGyS6grOV_p8Z6d9WofiFNMYQBblIk',
            SHEET_ID: '1EfjpkKEEi8rLxF9BwXCyyPHEcbBZJK71BijpUP1uEPI',
            SHEET_NAME: 'RESULTADOS',
            USE_API_KEY: true,
            // Mapeo automático de pestañas - detecta GIDs automáticamente
            COMPETITION_SHEETS: {
                // Primera sesión: Resultados por prueba
                'resultados-por-prueba-femenino': ['FEMENINO', 'FEM'],
                '50m-libre-femenino': ['50M-FEMENINO', '50M FEMENINO', '50M-FEM', '50M FEM', '50 FEM'],
                '50m-libre-masculino': ['50M-MASCULINO', '50M MASCULINO', '50M-MAS', '50M MAS', '50 MAS'],
                '100m-libre-femenino': ['100M-FEMENINO', '100M FEMENINO', '100M-FEM', '100M FEM', '100 FEM', 'FEMENINO 100M'],
                '100m-libre-masculino': ['100M-MASCULINO', '100M MASCULINO', '100M-MAS', '100M MAS', '100 MAS', 'MASCULINO 100M'],
                '200m-libre-femenino': ['200M-FEMENINO', '200M FEMENINO', '200M-FEM', '200M FEM', '200 FEM', 'FEMENINO 200M'],
                '200m-libre-masculino': ['200M-MASCULINO', '200M MASCULINO', '200M-MAS', '200M MAS', '200 MAS', 'MASCULINO 200M'],
                '4x50m-libre-mixto': ['4X50M-MIXTO', '4X50M MIXTO', '4X50M-MIX', '4X50M MIX', '4X50 MIX', 'MIXTO 4X50M'],
                // Segunda sesión: Resultado por género
                'resultados-femenino': ['CLASIFICACIÓN GENERAL FEMENINA', 'RESULTADOS-FEMENINO', 'RESULTADOS FEMENINO', 'RESULTADOS FEM'],
                'resultados-masculino': ['RESULTADOS-MASCULINO', 'RESULTADOS MASCULINO', 'RESULTADOS MAS'],
                // Tercera sesión: Resultado por equipo
                'resultados-equipo': ['EQUIPO', 'EQUIPOS', 'TEAM', 'TEAMS', 'CLASIFICACION EQUIPOS', 'RESULTADOS EQUIPOS']
            }
        };

        // Elementos DOM
        const statusIndicator = document.getElementById('statusIndicator');
        const lastUpdateElement = document.getElementById('lastUpdateTime');
        const lastUpdateElementTeams = document.getElementById('lastUpdateTimeTeams');
        const lastUpdateElementGender = document.getElementById('lastUpdateTimeGender');
        const resultsTableTeams = document.getElementById('resultsTableTeams');
        const resultsTableMasculinoGeneral = document.getElementById('resultsTableMasculinoGeneral');
        const resultsTableFemeninoGeneral = document.getElementById('resultsTableFemeninoGeneral');
        
        // Mapeo de elementos DOM por competencia
        const COMPETITION_TABLES = {
            // Primera sesión: Resultados por prueba
            'resultados-por-prueba-femenino': document.getElementById('resultsTableFem'),
            '50m-libre-femenino': document.getElementById('resultsTableFem'),
            '50m-libre-masculino': document.getElementById('resultsTableMas'),
            '100m-libre-femenino': document.getElementById('resultsTable100mFem'),
            '100m-libre-masculino': document.getElementById('resultsTable100mMas'),
            '200m-libre-femenino': document.getElementById('resultsTable200mFem'),
            '200m-libre-masculino': document.getElementById('resultsTable200mMas'),
            '4x50m-libre-mixto': document.getElementById('resultsTable4x50mMixto'),
            // Segunda sesión: Resultado por género
            'resultados-femenino': resultsTableFemeninoGeneral,
            'resultados-masculino': resultsTableMasculinoGeneral,
            // Tercera sesión: Resultado por equipo
            'resultados-equipo': resultsTableTeams,
            // Compatibilidad con nombres antiguos
            'equipos': resultsTableTeams,
            'masculino-general': resultsTableMasculinoGeneral,
            'femenino-general': resultsTableFemeninoGeneral
        };

        // Función para actualizar el indicador de estado
        function updateStatus(type, message) {
            statusIndicator.className = `status-indicator status-${type}`;
            statusIndicator.textContent = message;
            console.log(`📱 Status: ${type} - ${message}`);
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusIndicator.style.opacity = '0';
                    setTimeout(() => {
                        statusIndicator.style.display = 'none';
                    }, 300);
                }, 5000); // Aumentado de 3000 a 5000 para ver mejor los mensajes
            }
        }

        // Función para actualizar tiempo de última actualización
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-CO', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'America/Bogota'
            });
            lastUpdateElement.textContent = timeString;
            lastUpdateTime = now;
        }

        // Parser CSV mejorado
        function parseCSV(csvText) {
            const rows = [];
            const lines = csvText.split('\n');
            
            for (let line of lines) {
                if (!line.trim()) continue;
                
                const cols = [];
                let currentCol = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    const nextChar = line[i + 1];
                    
                    if (char === '"') {
                        if (inQuotes && nextChar === '"') {
                            currentCol += '"';
                            i++;
                        } else {
                            inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        cols.push(currentCol.trim());
                        currentCol = '';
                    } else {
                        currentCol += char;
                    }
                }
                
                cols.push(currentCol.trim());
                
                if (cols.some(cell => cell && cell.trim() !== '')) {
                    rows.push(cols);
                }
            }
            
            return rows;
        }

        // Función para obtener información de todas las pestañas del Google Sheet automáticamente
        async function getSheetInfo() {
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}?key=${CONFIG.API_KEY}`;
                const response = await fetch(url);
                if (response.ok) {
                    const data = await response.json();
                    return data.sheets.map(sheet => ({
                        title: sheet.properties.title,
                        gid: sheet.properties.sheetId
                    }));
                }
            } catch (error) {
                console.log('⚠️ No se pudo obtener info automática de pestañas:', error.message);
            }
            return null;
        }

        // Función para encontrar el GID de una competencia específica
        function findSheetGid(sheetInfo, competitionKey) {
            if (!sheetInfo) return detectedGids[competitionKey] || null;
            
            // Si ya tenemos el GID en cache, usarlo
            if (detectedGids[competitionKey]) {
                return detectedGids[competitionKey];
            }
            
            console.log(`🔍 Buscando pestaña para: ${competitionKey}`);
            console.log(`📋 Pestañas disponibles en Google Sheet:`, sheetInfo.map(s => s.title));
            
            const possibleNames = CONFIG.COMPETITION_SHEETS[competitionKey] || [];
            console.log(`🎯 Nombres posibles para ${competitionKey}:`, possibleNames);
            
            // Búsqueda más inteligente
            for (const possibleName of possibleNames) {
                const sheet = sheetInfo.find(s => {
                    const sheetTitle = s.title.toUpperCase().trim();
                    const searchName = possibleName.toUpperCase().trim();
                    
                    // Coincidencia exacta
                    if (sheetTitle === searchName) return true;
                    
                    // Contiene el nombre
                    if (sheetTitle.includes(searchName) || searchName.includes(sheetTitle)) return true;
                    
                    // Búsqueda por palabras clave
                    if (competitionKey.includes('masculino') || competitionKey.includes('mas')) {
                        if (sheetTitle.includes('MASCULINO') || sheetTitle.includes('MAS') || 
                            sheetTitle.includes('MASC') || sheetTitle.includes('HOMBRES')) {
                            
                            // Verificar también la distancia
                            if (competitionKey.includes('50m') && (sheetTitle.includes('50') || !sheetTitle.match(/\d/))) return true;
                            if (competitionKey.includes('100m') && sheetTitle.includes('100')) return true;
                            if (competitionKey.includes('200m') && sheetTitle.includes('200')) return true;
                            if (competitionKey.includes('4x50m') && (sheetTitle.includes('4X50') || sheetTitle.includes('4 X 50'))) return true;
                        }
                    }
                    
                    return false;
                });
                
                if (sheet) {
                    console.log(`✅ Encontrada pestaña para ${competitionKey}: "${sheet.title}" (GID: ${sheet.gid})`);
                    // Guardar en cache para futuros usos
                    detectedGids[competitionKey] = sheet.gid;
                    return sheet.gid;
                }
            }
            
            console.log(`⚠️ No se encontró pestaña para ${competitionKey}`);
            console.log(`💡 Intenta renombrar alguna pestaña para que contenga: ${possibleNames.slice(0, 3).join(', ')}`);
            return null;
        }

        // Función para mostrar los GIDs detectados (para debugging)
        function logDetectedGids() {
            console.log('📋 GIDs detectados automáticamente:');
            Object.entries(detectedGids).forEach(([key, gid]) => {
                console.log(`  ${key}: ${gid}`);
            });
        }

        // Método principal para cargar datos desde Google Sheets (usando lógica exitosa del test)
        async function loadSheetData() {
            loadAttempts++;
            updateStatus('loading', '🔄 Cargando resultados...');
            
            try {
                console.log('🔍 Obteniendo lista de pestañas...');
                const sheetInfo = await getSheetInfo();
                
                if (!sheetInfo) {
                    console.log('❌ No se pudo obtener información de las pestañas');
                    throw new Error('No se pudo acceder a las pestañas del Google Sheet');
                }
                
                console.log('📋 Pestañas encontradas:');
                sheetInfo.forEach(sheet => {
                    console.log(`  - "${sheet.title}" (GID: ${sheet.gid})`);
                });
                
                let hasData = false;
                
                // Definir competencias a buscar con palabras clave más flexibles
                const competitions = {
                    // Resultados por prueba FEMENINO - mapea a la primera tabla que aparece
                    'resultados-por-prueba-femenino': {
                        keywords: ['FEMENINO'],
                        alternativeNames: ['FEMENINO', 'FEM'],
                        tableId: 'resultsTableFem',
                        genderColumn: 'Nadadora'
                    },
                    // 50M Femenino y Masculino
                    '50m-libre-femenino': {
                        keywords: ['50M', 'FEMENINO'],
                        alternativeNames: ['50M-FEMENINO', '50M FEMENINO', '50M-FEM', '50M FEM'],
                        tableId: 'resultsTable50mFem',
                        genderColumn: 'Nadadora'
                    },
                    '50m-libre-masculino': {
                        keywords: ['50M', 'MASCULINO'],
                        alternativeNames: ['50M-MASCULINO', '50M MASCULINO', '50M-MAS', '50M MAS'],
                        tableId: 'resultsTableMas',
                        genderColumn: 'Nadador'
                    },
                    // 100M Femenino y Masculino
                    '100m-libre-femenino': {
                        keywords: ['100M', 'FEMENINO'],
                        alternativeNames: ['100M-FEMENINO', '100M FEMENINO', '100M-FEM', '100M FEM'],
                        tableId: 'resultsTable100mFem',
                        genderColumn: 'Nadadora'
                    },
                    '100m-libre-masculino': {
                        keywords: ['100M', 'MASCULINO'],
                        alternativeNames: ['100M-MASCULINO', '100M MASCULINO', '100M-MAS', '100M MAS'],
                        tableId: 'resultsTable100mMas',
                        genderColumn: 'Nadador'
                    },
                    // 200M Femenino y Masculino
                    '200m-libre-femenino': {
                        keywords: ['200M', 'FEMENINO'],
                        alternativeNames: ['200M-FEMENINO', '200M FEMENINO', '200M-FEM', '200M FEM'],
                        tableId: 'resultsTable200mFem',
                        genderColumn: 'Nadadora'
                    },
                    '200m-libre-masculino': {
                        keywords: ['200M', 'MASCULINO'],
                        alternativeNames: ['200M-MASCULINO', '200M MASCULINO', '200M-MAS', '200M MAS'],
                        tableId: 'resultsTable200mMas',
                        genderColumn: 'Nadador'
                    },
                    // 4X50M Mixto
                    '4x50m-libre-mixto': {
                        keywords: ['4X50M', 'MIXTO'],
                        alternativeNames: ['4X50M-MIXTO', '4X50M MIXTO', '4X50M-MIX', '4X50M MIX'],
                        tableId: 'resultsTable4x50mMixto',
                        genderColumn: 'Nadador/a'
                    },
                    // Resultados por género
                    'resultados-femenino': {
                        keywords: ['RESULTADOS', 'FEMENINO'],
                        alternativeNames: ['CLASIFICACIÓN GENERAL FEMENINA', 'RESULTADOS-FEMENINO', 'RESULTADOS FEMENINO'],
                        tableId: 'resultsTableFemeninoGeneral',
                        genderColumn: 'Nadadora'
                    },
                    'resultados-masculino': {
                        keywords: ['RESULTADOS', 'MASCULINO'],
                        alternativeNames: ['RESULTADOS-MASCULINO', 'RESULTADOS MASCULINO'],
                        tableId: 'resultsTableMasculinoGeneral',
                        genderColumn: 'Nadador'
                    },
                    // Resultados por equipo
                    'resultados-equipo': {
                        keywords: ['EQUIPO'],
                        alternativeNames: ['EQUIPO', 'EQUIPOS'],
                        tableId: 'resultsTableTeams',
                        genderColumn: 'Equipo'
                    }
                };
                
                // Buscar y cargar cada competencia con lógica de búsqueda inteligente
                for (const [competitionKey, config] of Object.entries(competitions)) {
                    console.log(`🔍 Buscando coincidencias para ${competitionKey}...`);
                    console.log(`🎯 Palabras clave: ${config.keywords.join(', ')}`);
                    console.log(`🔍 Nombres alternativos: ${config.alternativeNames.join(', ')}`);
                    
                    let foundSheet = null;
                    
                    // 1. Primera búsqueda: coincidencia exacta con nombres alternativos
                    foundSheet = sheetInfo.find(sheet => {
                        const title = sheet.title.toUpperCase().trim();
                        const exactMatch = config.alternativeNames.some(altName => 
                            title === altName.toUpperCase().trim()
                        );
                        if (exactMatch) {
                            console.log(`✅ Coincidencia exacta encontrada: "${sheet.title}"`);
                        }
                        return exactMatch;
                    });
                    
                    // 2. Segunda búsqueda: pestaña que contenga todas las palabras clave
                    if (!foundSheet) {
                        foundSheet = sheetInfo.find(sheet => {
                            const title = sheet.title.toUpperCase();
                            const hasAllKeywords = config.keywords.every(keyword => 
                                title.includes(keyword.toUpperCase())
                            );
                            if (hasAllKeywords) {
                                console.log(`✅ Coincidencia por palabras clave: "${sheet.title}" contiene todas las palabras clave`);
                            }
                            return hasAllKeywords;
                        });
                    }
                    
                    // 3. Tercera búsqueda: coincidencia parcial con nombres alternativos
                    if (!foundSheet) {
                        foundSheet = sheetInfo.find(sheet => {
                            const title = sheet.title.toUpperCase();
                            const partialMatch = config.alternativeNames.some(altName => 
                                title.includes(altName.toUpperCase()) || altName.toUpperCase().includes(title)
                            );
                            if (partialMatch) {
                                console.log(`✅ Coincidencia parcial encontrada: "${sheet.title}"`);
                            }
                            return partialMatch;
                        });
                    }
                    
                    // 4. Cuarta búsqueda: al menos una palabra clave para casos especiales
                    if (!foundSheet && config.keywords.length === 1) {
                        foundSheet = sheetInfo.find(sheet => {
                            const title = sheet.title.toUpperCase();
                            const hasKeyword = config.keywords.some(keyword => 
                                title.includes(keyword.toUpperCase())
                            );
                            if (hasKeyword) {
                                console.log(`✅ Coincidencia simple encontrada: "${sheet.title}" contiene palabra clave`);
                            }
                            return hasKeyword;
                        });
                    }
                    
                    if (foundSheet) {
                        console.log(`📄 Cargando datos de "${foundSheet.title}" (GID: ${foundSheet.gid})...`);
                        const data = await loadSheetByGid(foundSheet.gid, foundSheet.title);
                        
                        if (data && data.length > 0) {
                            console.log(`✅ Datos cargados: ${data.length} filas`);
                            
                            const table = document.getElementById(config.tableId);
                            if (table) {
                                console.log(`🔄 Actualizando tabla ${competitionKey}...`);
                                
                                // Usar función específica para cada tipo de tabla
                                if (competitionKey === 'resultados-equipo' || config.tableId === 'resultsTableTeams') {
                                    updateTeamTableContent(table, data);
                                } else if (competitionKey === 'resultados-masculino' || competitionKey === 'resultados-femenino') {
                                    updateGenderTableContent(table, data, config.genderColumn);
                                } else {
                                    updateTableContent(table, data, config.genderColumn);
                                }
                                
                                table.classList.remove('loading');
                                hasData = true;
                                console.log(`✅ Tabla ${competitionKey} actualizada`);
                            }
                        } else {
                            console.log(`❌ No se pudieron cargar datos de "${foundSheet.title}"`);
                        }
                    } else {
                        console.log(`⚠️ No se encontró pestaña para ${competitionKey}`);
                        console.log(`💡 Palabras clave buscadas:`, config.keywords);
                        console.log(`📋 Pestañas disponibles:`, sheetInfo.map(s => s.title));
                        
                        // Mostrar mensaje específico en la tabla
                        const table = document.getElementById(config.tableId);
                        if (table) {
                            table.innerHTML = `<tr><td colspan="10" class="table-no-data">
                                No se encontró pestaña para ${competitionKey}<br>
                                <small>Palabras clave: ${config.keywords.join(', ')}</small>
                            </td></tr>`;
                            table.classList.remove('loading');
                        }
                    }
                }
                
                // Actualizar estado final (siempre completar, aunque solo se carguen algunas pestañas)
                if (hasData) {
                    updateStatus('success', '✅ Resultados actualizados');
                    updateLastUpdateTime();
                    
                    // Actualizar también tiempo de género si se cargaron tablas de género
                    if (lastUpdateElementGender) {
                        const now = new Date();
                        const timeString = now.toLocaleTimeString('es-CO', {
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            timeZone: 'America/Bogota'
                        });
                        lastUpdateElementGender.textContent = timeString;
                    }
                    
                    loadAttempts = 0;
                    console.log('🎉 ¡Carga automática completada exitosamente!');
                } else {
                    updateStatus('warning', '⚠️ No se encontraron pestañas coincidentes');
                    updateLastUpdateTime();
                    loadAttempts = 0;
                    console.log('⚠️ No se pudieron cargar datos - verificar nombres de pestañas');
                    // No hacer throw para evitar que se quede cargando infinitamente
                }
                
            } catch (error) {
                console.error('❌ Error cargando datos:', error);
                
                if (loadAttempts < MAX_ATTEMPTS) {
                    updateStatus('loading', `🔄 Reintentando... (${loadAttempts}/${MAX_ATTEMPTS})`);
                    setTimeout(() => loadSheetData(), 5000);
                } else {
                    updateStatus('error', '❌ Error cargando datos');
                    showErrorFallback();
                }
            }
        }

        // Función fallback con GIDs conocidos y auto-detectados
        function getFallbackGid(competitionKey) {
            const fallbackGids = {
                '50m-libre-femenino': '0',      // Pestaña FEMENINO
                '50m-libre-masculino': '2016301649', // Pestaña MASCULINO (o 50M-MASCULINO)
                // Los siguientes se detectarán automáticamente cuando cargue la página
                '100m-libre-femenino': null,   // Se buscará automáticamente en 100M-FEMENINO
                '100m-libre-masculino': null,  // Se buscará automáticamente en 100M-MASCULINO
                '200m-libre-femenino': null,   // Se buscará automáticamente en 200M-FEMENINO
                '200m-libre-masculino': null,  // Se buscará automáticamente en 200M-MASCULINO
                '4x50m-libre-mixto': null  // Se buscará automáticamente en 4X50M-MIXTO
            };
            return fallbackGids[competitionKey] || null;
        }

        // Cache de GIDs detectados automáticamente
        let detectedGids = {};

        // Función para cargar una hoja específica por GID
        // Optimized unified sheet loader
        async function loadSheet({gid, name, range = 'A:J', useApiKey = CONFIG.USE_API_KEY}) {
            let data = null;
            const identifier = gid || name;
            console.log(`📄 Cargando datos: ${identifier}`);
            
            try {
                if (gid) {
                    // Load by GID (CSV method)
                    const url = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/export?format=csv&gid=${gid}&range=${range}`;
                    data = await fetchCSVData(url, gid);
                } else if (name && useApiKey) {
                    // Load by sheet name (API method)
                    data = await fetchAPIData(name, range);
                }
                
                if (data && data.length > 0) {
                    console.log(`✅ Datos cargados para ${identifier}: ${data.length} filas`);
                    logDataSample(data);
                }
                
                return data;
            } catch (error) {
                console.error(`❌ Error cargando ${identifier}:`, error.message);
                return null;
            }
        }

        // Helper function for CSV data fetching
        async function fetchCSVData(url, identifier) {
            console.log(`📄 URL CSV: ${url}`);
            const response = await fetch(url);
            console.log(`📡 Respuesta HTTP: ${response.status} ${response.statusText}`);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const text = await response.text();
            console.log(`📝 Tamaño del texto: ${text.length} caracteres`);
            
            if (text && !text.includes('<!DOCTYPE')) {
                return parseCSV(text);
            } else {
                console.warn(`⚠️ Respuesta HTML en lugar de CSV para ${identifier}`);
                return null;
            }
        }

        // Helper function for API data fetching
        async function fetchAPIData(sheetName, range) {
            const ranges = [
                `${sheetName}!${range}`,
                `${sheetName}!A1:Z1000`,
                `'${sheetName}'!${range}`,
                `'${sheetName}'!A1:Z1000`
            ];
            
            for (const apiRange of ranges) {
                try {
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${apiRange}?key=${CONFIG.API_KEY}`;
                    console.log(`🔍 Probando rango: ${apiRange}`);
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Cache-Control': 'no-cache'
                        }
                    });
                    
                    if (response.ok) {
                        const responseData = await response.json();
                        if (responseData.values && responseData.values.length > 0) {
                            console.log(`✅ Datos encontrados: ${responseData.values.length} filas`);
                            return responseData.values;
                        }
                    }
                } catch (error) {
                    console.log(`❌ Error en rango ${apiRange}:`, error.message);
                }
            }
            return null;
        }

        // Helper function to log data samples
        function logDataSample(data) {
            if (data.length > 0) {
                console.log(`🔍 Primera fila (encabezados):`, data[0]);
                if (data.length > 1) console.log(`🔍 Segunda fila:`, data[1]);
                console.log(`🔍 Última fila:`, data[data.length - 1]);
            }
        }

        // Legacy function wrappers for backwards compatibility
        async function loadSheetByGid(gid, sheetName = null) {
            return await loadDirectSheetData(gid, sheetName);
        }
        
        async function loadSheetByName(sheetName) {
            // Use the optimized unified loader with fallback GID logic
            let gid = null;
            
            // Map sheet names to specific GIDs for CSV fallback
            if (sheetName === 'MASCULINO') {
                gid = '2016301649';
            } else if (sheetName === 'FEMENINO') {
                gid = '0';
            }
            
            // Try API method first, then fallback to CSV with GID
            let data = await loadSheet({name: sheetName});
            if (!data && gid) {
                console.log(`📄 Fallback: Intentando CSV para ${sheetName} con GID ${gid}`);
                data = await loadSheet({gid});
            }
            
            return data;
        }
        
        // Función para mostrar mensaje de no datos
        function showNoDataMessage(table, message) {
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="10" class="no-data-cell">
                        ${message}
                    </td>
                </tr>`;
        }

        // Función para actualizar la tabla de resultados (ya no se usa)
        function updateResultsTable(data) {
            // Esta función ya no se necesita porque cargamos las hojas por separado
            console.log('⚠️ updateResultsTable llamada pero no debería usarse');
        }
        
        // Base class for table renderers - Optimized approach
        class TableRenderer {
            constructor(table, config = {}) {
                this.table = table;
                this.tbody = table.querySelector('tbody');
                this.config = {
                    colspan: '10',
                    hasGenderColumn: false,
                    hasDiplomaColumn: false,
                    ...config
                };
            }
            
            render(data) {
                if (!this.tbody || !data || data.length === 0) return;
                
                let htmlContent = '';
                let currentCategory = '';
                
                for (let i = 1; i < data.length; i++) {
                    const row = data[i];
                    if (!row || row.length === 0) continue;
                    
                    if (this.isCategoryRow(row)) {
                        currentCategory = row[0].toString().trim();
                        htmlContent += this.renderCategoryRow(currentCategory);
                    } else if (this.isDataRow(row)) {
                        htmlContent += this.renderDataRow(row, i);
                    }
                }
                
                this.tbody.innerHTML = htmlContent || this.getNoDataMessage();
            }
            
            isCategoryRow(row) {
                return (row.length === 1 || (row[0] && !row[1])) && 
                       row[0].toString().trim().match(/^(INFANTIL|JUVENIL|MAYORES|MASTER)/i);
            }
            
            isDataRow(row) {
                return row.length >= 6;
            }
            
            renderCategoryRow(category) {
                return `<tr class="category-header">
                    <td colspan="${this.config.colspan}">${category}</td>
                </tr>`;
            }
            
            renderDataRow(row, index) {
                // To be overridden by specific table types
                return '';
            }
            
            getNoDataMessage() {
                return `<tr><td colspan="${this.config.colspan}" class="no-data-cell">No hay datos disponibles</td></tr>`;
            }
        }
        
        // Specific renderer for general tables
        class GeneralTableRenderer extends TableRenderer {
            renderDataRow(row, index) {
                // Detectar si es la tabla de 4x50m Mixto
                const is4x50mMixto = this.table && this.table.id === 'resultsTable4x50mMixto';
                
                // Detectar el tipo de tabla por el número de columnas o el contenido
                if (row.length >= 9) {
                    // Tabla de clasificación general (10 columnas)
                    const [pos, nombre, equipo, edad, categoria, puntos, p200, p50, p100] = row;
                    
                    return `<tr>
                        <td class="rank">${pos || index}</td>
                        <td><strong>${nombre || ''}</strong></td>
                        <td>${equipo || ''}</td>
                        <td>${edad || ''}</td>
                        <td><span class="category-badge">${categoria || ''}</span></td>
                        <td><strong class="total-points-cell">${puntos || ''}</strong></td>
                        <td>${p200 || ''}</td>
                        <td>${p50 || ''}</td>
                        <td>${p100 || ''}</td>
                        <td><button onclick="shareResult('${nombre}', '${pos || index}', 'N/A', '${categoria}')" class="share-btn">📱</button></td>
                        <td class="diploma-cell">
                            <button class="diploma-btn disabled" disabled title="Diploma no disponible para clasificación general">
                                🏆
                            </button>
                        </td>
                    </tr>`;
                } else {
                    // Tabla de prueba individual
                    if (is4x50mMixto) {
                        // Para 4x50m Mixto: usar columna Diploma (SI/NO) pero sin mostrar las columnas Diploma y Obs
                        const [pos, nombre, equipo, edad, categoria, tiempo, puntos, diploma, obs] = row;
                        
                        // Determinar si el diploma debe estar habilitado (columna Diploma con valor 'SI')
                        const isDiplomaEnabled = diploma && diploma.toString().toUpperCase().trim() === 'SI';
                        
                        // Debug: mostrar información de la columna Diploma
                        if (diploma && diploma.toString().trim() !== '') {
                            console.log(`🏆 Diploma para ${nombre}: "${diploma}" - Habilitado: ${isDiplomaEnabled}`);
                        }
                        const diplomaButtonClass = isDiplomaEnabled ? 'diploma-btn enabled' : 'diploma-btn disabled';
                        const diplomaButtonClick = isDiplomaEnabled ? `generateDiploma('${(nombre || '').replace(/'/g, '\\\'')}', '${(equipo || '').replace(/'/g, '\\\'')}', '${(categoria || '').replace(/'/g, '\\\'')}', '${tiempo || ''}', getCurrentEventName())` : '';
                        
                        return `<tr>
                            <td data-label="Pos." class="rank">${pos || index}</td>
                            <td data-label="Nadador/a"><strong>${nombre || ''}</strong></td>
                            <td data-label="Equipo">${equipo || ''}</td>
                            <td data-label="Edad">${edad || ''}</td>
                            <td data-label="Categoría"><span class="category-badge">${categoria || ''}</span></td>
                            <td data-label="Tiempo Final" class="time">${tiempo || ''}</td>
                            <td data-label="Puntos"><strong class="total-points-cell">${puntos || ''}</strong></td>
                            <td data-label="Compartir"><button onclick="shareResult('${nombre}', '${pos || index}', '${tiempo}', '${categoria}')" class="share-btn">📱</button></td>
                            <td data-label="Certificado" class="diploma-cell">
                                <button class="${diplomaButtonClass}" ${isDiplomaEnabled ? `onclick="${diplomaButtonClick}"` : ''} ${!isDiplomaEnabled ? 'disabled' : ''} title="${isDiplomaEnabled ? 'Descargar certificado' : 'Certificado no habilitado'}" data-status="${diploma || 'NO'}">
                                    🏆
                                </button>
                            </td>
                        </tr>`;
                    } else {
                        // Para otras pruebas: usar lógica de récords (R en Obs)
                        const [pos, nombre, equipo, edad, categoria, tiempo, puntos, obs] = row;
                        console.log('DEBUG ROW:', row, 'OBS VALUE:', obs, 'OBS INDEX:', row.indexOf(obs));
                        // Determinar si el diploma debe estar habilitado (solo para récords marcados con 'R' en la columna Obs)
                        const isRecord = obs && obs.toString().toUpperCase().includes('R');

                        // Debug: mostrar información de la columna Obs
                        if (obs && obs.toString().trim() !== '') {
                            console.log(`📄 Obs detectada para ${nombre}: "${obs}" - Es récord: ${isRecord}`);
                        }
                        const diplomaButtonClass = isRecord ? 'diploma-btn enabled' : 'diploma-btn disabled';
                        const diplomaButtonClick = isRecord ? `generateDiploma('${(nombre || '').replace(/'/g, '\\\'')}', '${(equipo || '').replace(/'/g, '\\\'')}', '${(categoria || '').replace(/'/g, '\\\'')}', '${tiempo || ''}', getCurrentEventName())` : '';
                        
                        return `<tr>
                            <td data-label="Pos." class="rank">${pos || index}</td>
                            <td data-label="Nadador/a"><strong>${nombre || ''}</strong></td>
                            <td data-label="Equipo">${equipo || ''}</td>
                            <td data-label="Edad">${edad || ''}</td>
                            <td data-label="Categoría"><span class="category-badge">${categoria || ''}</span></td>
                            <td data-label="Tiempo Final" class="time">${tiempo || ''}</td>
                            <td data-label="Puntos"><strong class="total-points-cell">${puntos || ''}</strong></td>
                            <td data-label="Obs" class="obs-cell ${isRecord ? 'record-indicator' : ''}">${obs || ''}</td>
                            <td data-label="Compartir"><button onclick="shareResult('${nombre}', '${pos || index}', '${tiempo}', '${categoria}')" class="share-btn">📱</button></td>
                            <td data-label="Diploma" class="diploma-cell">
                                <button class="${diplomaButtonClass}" ${isRecord ? `onclick="${diplomaButtonClick}"` : ''} ${!isRecord ? 'disabled' : ''} title="${isRecord ? 'Descargar diploma de récord' : 'Solo disponible para récords (marcar con R en Obs)'}" data-status="${obs || 'N/A'}">
                                    🏆
                                </button>
                            </td>
                        </tr>`;
                    }
                }
            }
        }
        
        // Optimized legacy function wrapper
        function updateTableContent(table, data, swimmerLabel) {
            // Detectar el tipo de tabla para ajustar el colspan
            const headers = table.querySelectorAll('thead th');
            const colspan = headers.length.toString();
            
            const renderer = new GeneralTableRenderer(table, {
                colspan: colspan
            });
            renderer.render(data);
        }

        // Función auxiliar para actualizar contenido de tabla de equipos
        function updateTeamTableContent(table, data) {
            const tbody = table.querySelector('tbody');
            if (!tbody) return;
            
            let htmlContent = '';
            let mobileContent = '';
            
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length === 0) continue;
                
                // Esperar al menos 3 columnas: LUGAR, EQUIPO, PUNTOS TOTALES
                if (row.length >= 3) {
                    const [lugar, equipo, puntosTotales, puntosFemeninos, puntosMasculinos, certificado] = row;
                    
                    // Skip si no hay equipo válido
                    if (!equipo || equipo === '-' || equipo.toLowerCase().includes('sin equipos')) {
                        continue;
                    }
                    
                    // Debug: mostrar información de la columna Certificado
                    if (equipo && equipo.trim() !== '') {
                        console.log(`🏆 Certificado para equipo ${equipo}: "${certificado}" - Habilitado: ${certificado && certificado.toString().toUpperCase().trim() === 'SI'}`);
                    }
                    
                    // Generar medallas para las posiciones
                    let displayPos = lugar;
                    if (lugar === '1' || lugar === 1) displayPos = '🥇 1°';
                    else if (lugar === '2' || lugar === 2) displayPos = '🥈 2°';
                    else if (lugar === '3' || lugar === 3) displayPos = '🥉 3°';
                    else if (lugar && lugar !== '-' && lugar !== '') displayPos = `${lugar}°`;
                    
                    // Contenido para tabla desktop
                    htmlContent += `
                        <tr>
                            <td data-label="Posición" class="rank">${displayPos || '-'}</td>
                            <td data-label="Equipo" class="team-name-cell">${equipo || '-'}</td>
                            <td data-label="Puntos Totales" class="points total-points-cell">${puntosTotales || '0'}</td>
                            <td data-label="Puntos Femeninos" class="points female-points-cell">${puntosFemeninos || '0'}</td>
                            <td data-label="Puntos Masculinos" class="points male-points-cell">${puntosMasculinos || '0'}</td>
                            <td data-label="Compartir" class="share-cell">
                                <button class="share-btn" onclick="shareResult('${equipo || ''}', '${lugar || ''}', 'N/A', 'Clasificación por Equipos')">📱</button>
                            </td>
                            <td data-label="Diploma" class="diploma-cell">
                                ${(() => {
                                    const isCertificateEnabled = certificado && certificado.toString().toUpperCase().trim() === 'SI';
                                    const diplomaClass = isCertificateEnabled ? 'diploma-btn enabled' : 'diploma-btn disabled';
                                    const diplomaClick = isCertificateEnabled ? `onclick="generateTeamDiploma('${(equipo || '').replace(/'/g, '\\\'')}', '${lugar || ''}', '${puntosTotales || '0'}')"` : '';
                                    const diplomaTitle = isCertificateEnabled ? 'Descargar diploma de equipo' : 'Diploma no disponible (requiere certificado SI)';
                                    const diplomaDisabled = isCertificateEnabled ? '' : 'disabled';
                                    
                                    return `<button class="${diplomaClass}" ${diplomaClick} ${diplomaDisabled} title="${diplomaTitle}" data-status="${certificado || 'N/A'}">
                                        🎓
                                    </button>`;
                                })()
                                }
                            </td>
                        </tr>`;
                    
                    // Contenido para versión móvil
                    const isCertificateEnabled = certificado && certificado.toString().toUpperCase().trim() === 'SI';
                    const diplomaClass = isCertificateEnabled ? 'diploma-btn enabled' : 'diploma-btn disabled';
                    const diplomaClick = isCertificateEnabled ? `onclick="generateTeamDiploma('${(equipo || '').replace(/'/g, '\\\'')}', '${lugar || ''}', '${puntosTotales || '0'}')"` : '';
                    const diplomaTitle = isCertificateEnabled ? 'Descargar diploma de equipo' : 'Diploma no disponible (requiere certificado SI)';
                    const diplomaDisabled = isCertificateEnabled ? '' : 'disabled';
                    
                    mobileContent += `
                        <div class="mobile-team-card">
                            <div class="team-position">${displayPos || '-'}</div>
                            <div class="team-name">${equipo || '-'}</div>
                            <div class="team-points">
                                <div>
                                    <div class="label">Total</div>
                                    <div class="value">${puntosTotales || '0'}</div>
                                </div>
                                <div>
                                    <div class="label">Femeninos</div>
                                    <div class="value female-points-value">${puntosFemeninos || '0'}</div>
                                </div>
                                <div>
                                    <div class="label">Masculinos</div>
                                    <div class="value male-points-value">${puntosMasculinos || '0'}</div>
                                </div>
                            </div>
                            <div class="team-actions" style="display: flex; justify-content: center; gap: 15px; margin-top: 15px;">
                                <button class="share-btn" onclick="shareResult('${equipo || ''}', '${lugar || ''}', 'N/A', 'Clasificación por Equipos')" title="Compartir resultado">📱</button>
                                <button class="${diplomaClass}" ${diplomaClick} ${diplomaDisabled} title="${diplomaTitle}" data-status="${certificado || 'N/A'}">🎓</button>
                            </div>
                        </div>`;
                }
            }
            
            tbody.innerHTML = htmlContent || '<tr><td colspan="7" class="no-data-cell">No hay datos de equipos disponibles</td></tr>';
            
            // Crear o actualizar contenedor móvil
            let mobileContainer = table.parentElement.querySelector('.mobile-teams-container');
            if (!mobileContainer) {
                mobileContainer = document.createElement('div');
                mobileContainer.className = 'mobile-teams-container';
                table.parentElement.appendChild(mobileContainer);
            }
            mobileContainer.innerHTML = mobileContent || '<div class="no-data-cell">No hay datos de equipos disponibles</div>';
            
            // Actualizar el tiempo de última actualización de equipos
            if (lastUpdateElementTeams) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('es-CO', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZone: 'America/Bogota'
                });
                lastUpdateElementTeams.textContent = timeString;
            }
        }

        // Función auxiliar para actualizar contenido de tabla de género
        function updateGenderTableContent(table, data, genderLabel) {
            const tbody = table.querySelector('tbody');
            if (!tbody) return;
            
            // DEBUG: Verificar qué datos se están pasando a la tabla femenina
            if (table.id === 'resultsTableFemeninoGeneral') {
                console.log('🔍 DEBUG: updateGenderTableContent para tabla femenina');
                console.log('📊 Datos recibidos:', data ? data.length + ' filas' : 'null/undefined');
                console.log('📊 Primera fila (headers):', data ? data[0] : 'n/a');
                console.log('📊 Segunda fila (primer dato):', data && data[1] ? data[1] : 'n/a');
                console.log('📊 genderLabel:', genderLabel);
            }
            
            let htmlContent = '';
            let currentCategory = '';
            
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length === 0) continue;
                
                // Si es una fila con solo categoría (similar a updateTableContent)
                if (row.length === 1 || (row[0] && !row[1])) {
                    const categoryText = row[0].toString().trim();
                    // Verificar que sea una categoría válida
                    if (categoryText.match(/^(INFANTIL|JUVENIL|MAYORES|MASTER)/i)) {
                        currentCategory = categoryText;
                        htmlContent += `
                            <tr class="category-header">
                                <td colspan="11">${currentCategory}</td>
                            </tr>`;
                    }
                } else if (row.length >= 6) {
                    // Es un resultado - Esperar al menos 6 columnas: LUGAR, ATLETA, EQUIPO, EDAD, CATEGORIA, PUNTOS TOTALES
                    const [lugar, atleta, equipo, edad, categoria, puntosTotales, puntos200m, puntos50m, puntos100m, diplomaStatus] = row;
                    
                    // Debug: verificar datos de diploma (reducido)
                    if (atleta && atleta !== 'Sin atletas') {
                        console.log(`🎓 ${atleta}: Columna J="${row[9] || 'VACÍA'}" (${row[9] === 'SI' ? 'HABILITADO' : 'DESHABILITADO'})`);
                    }
                    
                    // Skip si no hay atleta válido
                    if (!atleta || atleta === '-' || atleta.toLowerCase().includes('sin atletas')) {
                        if (atleta && atleta.toLowerCase().includes('sin atletas')) {
                            htmlContent += `
                                <tr>
                                    <td data-label="Pos." class="rank rank-empty-cell">-</td>
                                    <td data-label="Atleta" class="athlete-empty-cell">Sin atletas</td>
                                    <td data-label="Equipo" class="team-empty-cell">-</td>
                                    <td data-label="Edad" class="age-empty-cell">-</td>
                                    <td data-label="Categoría" class="category-empty-cell">${currentCategory || categoria}</td>
                                    <td data-label="Puntos Totales" class="points-empty-cell">-</td>
                                    <td data-label="P. 200m Libre" class="points-empty-cell">-</td>
                                    <td data-label="P. 50m Libre" class="points-empty-cell">-</td>
                                    <td data-label="P. 100m Libre" class="points-empty-cell">-</td>
                                    <td data-label="Compartir" class="points-empty-cell">-</td>
                                    <td data-label="Diploma" class="points-empty-cell">-</td>
                                </tr>`;
                        }
                        continue;
                    }
                    
                    // Generar medallas para las posiciones
                    let displayPos = lugar;
                    if (lugar === '1' || lugar === 1) displayPos = '🥇 1°';
                    else if (lugar === '2' || lugar === 2) displayPos = '🥈 2°';
                    else if (lugar === '3' || lugar === 3) displayPos = '🥉 3°';
                    else if (lugar && lugar !== '-' && lugar !== '') displayPos = `${lugar}°`;
                    
                    // Determine if diploma download should be enabled - Column J is at index 9
                    const finalDiplomaStatus = row[9] || diplomaStatus || '';
                    
                    const isDiplomaEnabled = finalDiplomaStatus && finalDiplomaStatus.toString().toUpperCase().trim() === 'SI';
                    const diplomaButtonClass = isDiplomaEnabled ? 'diploma-btn enabled' : 'diploma-btn disabled';
                    const diplomaButtonClick = isDiplomaEnabled ? `downloadDiploma('${(atleta || '').replace(/'/g, '\\\'')
                    }', '${lugar || ''}', '${(equipo || '').replace(/'/g, '\\\'')
                    }', '${(categoria || currentCategory || '').replace(/'/g, '\\\'')
                    }')` : '';

                    htmlContent += `
                        <tr>
                            <td data-label="Pos." class="rank">${displayPos || '-'}</td>
                            <td data-label="Atleta" class="athlete-name-cell">${atleta || '-'}</td>
                            <td data-label="Equipo">${equipo || '-'}</td>
                            <td data-label="Edad">${edad || '-'}</td>
                            <td data-label="Categoría">${categoria || currentCategory}</td>
                            <td data-label="Puntos Totales" class="points total-points-cell">${puntosTotales || '0'}</td>
                            <td data-label="P. 200m Libre" class="points points-200m-cell">${puntos200m || '0'}</td>
                            <td data-label="P. 50m Libre" class="points points-50m-cell">${puntos50m || '0'}</td>
                            <td data-label="P. 100m Libre" class="points points-100m-cell">${puntos100m || '0'}</td>
                            <td data-label="Compartir" class="share-cell">
                                <button class="share-btn" onclick="shareResult('${atleta || ''}', '${lugar || ''}', 'N/A', '${categoria || currentCategory || ''}')">📱</button>
                            </td>
                            <td data-label="Diploma" class="diploma-cell">
                                <button class="${diplomaButtonClass}" ${isDiplomaEnabled ? `onclick="${diplomaButtonClick}"` : ''} ${!isDiplomaEnabled ? 'disabled' : ''} title="${isDiplomaEnabled ? 'Descargar diploma' : 'Diploma no disponible'}" data-status="${finalDiplomaStatus || 'N/A'}">
                                    🎓
                                </button>
                            </td>
                        </tr>`;
                }
            }
            
            tbody.innerHTML = htmlContent || '<tr><td colspan="11" class="no-data-cell">No hay datos de clasificación disponibles</td></tr>';
            
            // Actualizar el tiempo de última actualización de género
            if (lastUpdateElementGender) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('es-CO', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZone: 'America/Bogota'
                });
                lastUpdateElementGender.textContent = timeString;
            }
        }

        // Función para mostrar error con fallback
        function showErrorFallback() {
            const errorHTML = `
                <tr>
                    <td colspan="7" class="error-message-cell">
                        ❌ No se pudieron cargar los datos desde Google Sheets<br>
                        <small class="error-subtitle">
                            Verifica que el Google Sheet sea público o intenta recargar la página
                        </small>
                        <button onclick="retryLoad()" class="retry-button">
                            🔄 Reintentar
                        </button>
                    </td>
                </tr>`;
            
            // Aplicar error a todas las tablas
            Object.values(COMPETITION_TABLES).forEach(table => {
                if (table) {
                    const tbody = table.querySelector('tbody');
                    if (tbody) {
                        // Ajustar el colspan según el tipo de tabla
                        const isTeamTable = table.id === 'resultsTableTeams';
                        const colspan = isTeamTable ? '7' : '10';
                        const adjustedErrorHTML = errorHTML.replace('colspan="7"', `colspan="${colspan}"`);
                        tbody.innerHTML = adjustedErrorHTML;
                    }
                }
            });
        }

        // Función para reintentar carga
        function retryLoad() {
            loadAttempts = 0;
            loadSheetData();
        }

        // Función de test específica para 100M-FEMENINO
        async function testSpecificSheet() {
            console.log('🧪 ===== TEST ESPECÍFICO 100M-FEMENINO =====');
            
            try {
                // 1. Obtener información de todas las pestañas
                console.log('📋 Obteniendo lista de pestañas...');
                const sheetInfo = await getSheetInfo();
                
                if (sheetInfo) {
                    console.log('📋 Pestañas encontradas:');
                    sheetInfo.forEach(sheet => {
                        console.log(`  - "${sheet.title}" (GID: ${sheet.gid})`);
                    });
                    
                    // 2. Buscar coincidencias para 100m-femenino
                    console.log('🔍 Buscando coincidencias para 100M-FEMENINO...');
                    const possibleNames = ['100M-FEMENINO', '100M FEMENINO', '100m-femenino', '100MFEMENINO', '100M-FEM'];
                    
                    let foundSheet = null;
                    for (const name of possibleNames) {
                        foundSheet = sheetInfo.find(s => s.title.toUpperCase().includes(name.toUpperCase()));
                        if (foundSheet) {
                            console.log(`✅ Encontrada: "${foundSheet.title}" con GID: ${foundSheet.gid}`);
                            break;
                        }
                    }
                    
                    if (!foundSheet) {
                        console.log('❌ No se encontró ninguna pestaña que coincida con 100M-FEMENINO');
                        console.log('💡 Pestañas disponibles:', sheetInfo.map(s => s.title));
                        return;
                    }
                    
                    // 3. Cargar datos específicos de esa pestaña
                    console.log(`📄 Cargando datos de "${foundSheet.title}" (GID: ${foundSheet.gid})...`);
                    const data = await loadSheetByGid(foundSheet.gid, foundSheet.title);
                    
                    if (data && data.length > 0) {
                        console.log(`✅ Datos cargados: ${data.length} filas`);
                        console.log('📊 TODOS LOS DATOS:');
                        data.forEach((row, index) => {
                            if (index === 0) {
                                console.log(`  🏷️ ENCABEZADOS (Fila ${index + 1}):`, row);
                                console.log(`  🎯 Columna J (índice 9): "${row[9] || 'NO ENCONTRADA'}"`);
                            } else {
                                console.log(`  Fila ${index + 1}:`, row);
                            }
                        });
                        
                        // 4. Actualizar específicamente la tabla 100m femenino
                        const table100mFem = document.getElementById('resultsTable100mFem');
                        if (table100mFem) {
                            console.log('🔄 Actualizando tabla 100m femenino...');
                            updateTableContent(table100mFem, data, 'Nadadora');
                            console.log('✅ Tabla actualizada');
                        }
                    } else {
                        console.log('❌ No se pudieron cargar datos de la pestaña');
                    }
                } else {
                    console.log('❌ No se pudo obtener información de las pestañas');
                }
                
            } catch (error) {
                console.error('❌ Error en test específico:', error);
            }
        }

        // Funciones para tabs
        function openTab(evt, tabName) {
            var i, tabcontent, tabbuttons;
            
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            tabbuttons = document.getElementsByClassName("tab-button");
            for (i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].classList.remove("active");
            }
            
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        // Función específica para tabs de género (independiente de las pruebas)
        function openGenderTab(evt, tabName) {
            var i, genderTabContent, genderTabButtons;
            
            // Solo afectar las tabs de la sección de género
            const genderSection = evt.currentTarget.closest('.results-section');
            genderTabContent = genderSection.getElementsByClassName("tab-content");
            genderTabButtons = genderSection.getElementsByClassName("tab-button");
            
            for (i = 0; i < genderTabContent.length; i++) {
                genderTabContent[i].classList.remove("active");
            }
            
            for (i = 0; i < genderTabButtons.length; i++) {
                genderTabButtons[i].classList.remove("active");
            }
            
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        // Función para recargar datos automáticamente
        function startAutoReload() {
            console.log('🚀 Iniciando sistema de recarga automática...');
            
            // Cargar datos inicialmente
            loadSheetData();
            
            // Recargar cada 3 minutos (optimizado para no saturar la API)
            setInterval(() => {
                console.log('🔄 Recarga automática cada 3 minutos...');
                loadAttempts = 0; // Reset attempts counter
                loadSheetData();
            }, 180000);
            
            console.log('✅ Sistema de recarga automática configurado (cada 3 minutos)');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Página cargada, iniciando sistema de actualización automática...');
            console.log('📋 Google Sheet ID:', CONFIG.SHEET_ID);
            console.log('🔑 API Key configurada:', CONFIG.API_KEY ? 'Sí' : 'No');
            console.log('🌐 URL del Sheet:', `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/edit`);
            console.log('⚡ Verificando acceso al Google Sheet...');
            
            // Precargar logo para PDFs
            preloadLogo();
            
            // Precargar plantilla de diploma
            preloadDiplomaTemplate();
            
            // Precargar plantilla de diploma de récord
            preloadRecordDiplomaTemplate();
            
            // Precargar plantilla de diploma de equipo
            preloadTeamDiplomaTemplate();
            
            // Verificar acceso inmediato
            fetch(`https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/export?format=csv&gid=0&range=A:J`)
                .then(response => {
                    console.log('📡 Respuesta del servidor:', response.status, response.statusText);
                    if (response.ok) {
                        console.log('✅ Google Sheet es accesible');
                        console.log('🎯 Iniciando sistema de recarga automática...');
                        startAutoReload();
                    } else {
                        console.error('❌ Google Sheet no es accesible. Verifica que sea público.');
                        console.log('⚠️ Intentando iniciar sistema de recarga de todas formas...');
                        startAutoReload();
                    }
                })
                .catch(error => {
                    console.error('❌ Error de conectividad:', error);
                    console.log('⚠️ Intentando iniciar sistema de recarga de todas formas...');
                    startAutoReload();
                });
        });

        // Recargar cuando la ventana vuelva al foco
        window.addEventListener('focus', function() {
            if (lastUpdateTime && (Date.now() - lastUpdateTime.getTime()) > 60000) {
                console.log('👁️ Ventana enfocada, recargando datos...');
                loadSheetData();
            }
        });

        // Recargar cuando se restaure la conexión a internet
        window.addEventListener('online', function() {
            console.log('🌐 Conexión restaurada, recargando datos...');
            loadAttempts = 0;
            loadSheetData();
        });

        // Mostrar estado offline
        window.addEventListener('offline', function() {
            updateStatus('error', '📡 Sin conexión a internet');
        });

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const mobileToggle = document.getElementById('mobileToggle');
            const navMenu = document.getElementById('navMenu');
            
            mobileToggle.classList.toggle('active');
            navMenu.classList.toggle('active');
        }

        // Smooth Scroll Function
        function scrollToSection(sectionClass) {
            const element = document.querySelector('.' + sectionClass);
            if (element) {
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
            
            // Close mobile menu if open
            const mobileToggle = document.getElementById('mobileToggle');
            const navMenu = document.getElementById('navMenu');
            if (navMenu.classList.contains('active')) {
                mobileToggle.classList.remove('active');
                navMenu.classList.remove('active');
            }
        }

        // Add click event to mobile toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileToggle = document.getElementById('mobileToggle');
            if (mobileToggle) {
                mobileToggle.addEventListener('click', toggleMobileMenu);
            }
            
            // Initialize search functionality
            initializeSearch();
        });

        // Search Functionality
        function initializeSearch() {
            // Search for Pruebas section
            const searchPruebas = document.getElementById('searchPruebas');
            if (searchPruebas) {
                searchPruebas.addEventListener('input', function() {
                    performSearch(this.value, 'pruebas');
                    toggleClearButton('searchPruebas');
                });
            }

            // Search for Gender section
            const searchGender = document.getElementById('searchGender');
            if (searchGender) {
                searchGender.addEventListener('input', function() {
                    performSearch(this.value, 'gender');
                    toggleClearButton('searchGender');
                });
            }
        }

        function toggleClearButton(inputId) {
            const input = document.getElementById(inputId);
            const clearBtn = input.nextElementSibling;
            if (input.value.length > 0) {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
            }
        }

        function clearSearch(inputId) {
            const input = document.getElementById(inputId);
            input.value = '';
            toggleClearButton(inputId);
            
            // Clear search based on section
            if (inputId === 'searchPruebas') {
                performSearch('', 'pruebas');
            } else if (inputId === 'searchGender') {
                performSearch('', 'gender');
            }
        }

        function performSearch(searchTerm, section) {
            const normalizedTerm = searchTerm.toLowerCase().trim();
            let foundResults = 0;
            let totalResults = 0;
            
            if (section === 'pruebas') {
                // Search in all pruebas tables
                const tables = ['resultsTableFem', 'resultsTableMas', 'resultsTable100mFem', 'resultsTable100mMas', 
                               'resultsTable200mFem', 'resultsTable200mMas', 'resultsTable4x50mFem', 'resultsTable4x50mMas'];
                
                tables.forEach(tableId => {
                    const table = document.getElementById(tableId);
                    if (table) {
                        const result = searchInTable(table, normalizedTerm);
                        foundResults += result.found;
                        totalResults += result.total;
                    }
                });
                
                updateSearchInfo('searchResultsPruebas', foundResults, totalResults, searchTerm);
                
            } else if (section === 'gender') {
                // Search in gender tables
                const tables = ['resultsTableMasculinoGeneral', 'resultsTableFemeninoGeneral'];
                
                tables.forEach(tableId => {
                    const table = document.getElementById(tableId);
                    if (table) {
                        const result = searchInTable(table, normalizedTerm);
                        foundResults += result.found;
                        totalResults += result.total;
                    }
                });
                
                updateSearchInfo('searchResultsGender', foundResults, totalResults, searchTerm);
            }
        }

        function searchInTable(table, searchTerm) {
            const rows = table.getElementsByTagName('tr');
            let foundResults = 0;
            let totalResults = 0;
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                
                // Skip header rows
                if (row.classList.contains('category-header') || i === 0) {
                    continue;
                }
                
                const cells = row.getElementsByTagName('td');
                if (cells.length === 0) continue;
                
                totalResults++;
                let rowContainsSearch = false;
                
                // Search in name column (usually first or second column)
                for (let j = 0; j < Math.min(cells.length, 3); j++) {
                    const cellText = cells[j].textContent.toLowerCase();
                    
                    // Remove previous highlights
                    cells[j].innerHTML = cells[j].textContent;
                    
                    if (searchTerm && cellText.includes(searchTerm)) {
                        rowContainsSearch = true;
                        // Highlight the search term
                        const originalText = cells[j].textContent;
                        const regex = new RegExp(`(${searchTerm})`, 'gi');
                        cells[j].innerHTML = originalText.replace(regex, '<span class="highlight-search">$1</span>');
                    }
                }
                
                // Show/hide row based on search
                if (searchTerm === '' || rowContainsSearch) {
                    row.style.display = '';
                    if (rowContainsSearch) foundResults++;
                } else {
                    row.style.display = 'none';
                }
            }
            
            return { found: foundResults, total: totalResults };
        }

        function updateSearchInfo(infoElementId, found, total, searchTerm) {
            const infoElement = document.getElementById(infoElementId);
            if (infoElement) {
                if (searchTerm === '') {
                    infoElement.textContent = '';
                } else if (found === 0) {
                    infoElement.textContent = `No se encontraron resultados para "${searchTerm}"`;
                } else {
                    infoElement.textContent = `Se encontraron ${found} resultado${found !== 1 ? 's' : ''} de ${total} total${total !== 1 ? 'es' : ''}`;
                }
            }
        }

        // Función simplificada para compartir resultados
        function shareResult(swimmer, position, time, category) {
            showShareOptions(swimmer, position, time, category);
        }

        // Compartir funcionalidad
        function showShareOptions(swimmer, position, time, category) {
            // Limpiar y sanitizar datos de entrada
            swimmer = (swimmer || '').toString().replace(/['"\\]/g, '').trim();
            position = (position || '').toString().trim();
            time = (time || '').toString().replace(/['"\\]/g, '').trim();
            category = (category || '').toString().replace(/['"\\]/g, '').trim();
            
            // Determinar la prueba actual basado en el tab activo o la sección actual
            const activeTab = document.querySelector('.tab-button.active');
            const activeTabContent = document.querySelector('.tab-content.active');
            let prueba = 'Natación';
            
            // Primero intentar detectar por tab activo
            if (activeTab) {
                const tabText = activeTab.textContent.toLowerCase();
                console.log('Tab activo detectado:', tabText);
                
                if (tabText.includes('4x50') && tabText.includes('libre')) {
                    prueba = '4x50m Relevo L.Mixto';
                } else if (tabText.includes('200') && tabText.includes('libre')) {
                    prueba = tabText.includes('femenino') ? '200m Libre Femenino' : '200m Libre Masculino';
                } else if (tabText.includes('100') && tabText.includes('libre')) {
                    prueba = tabText.includes('femenino') ? '100m Libre Femenino' : '100m Libre Masculino';
                } else if (tabText.includes('50') && tabText.includes('libre')) {
                    prueba = tabText.includes('femenino') ? '50m Libre Femenino' : '50m Libre Masculino';
                } else if (tabText.includes('masculino general')) {
                    prueba = 'Clasificación General Masculina';
                } else if (tabText.includes('femenino general')) {
                    prueba = 'Clasificación General Femenina';
                } else if (tabText.includes('equipos')) {
                    prueba = 'Clasificación por Equipos';
                }
            }
            
            // Si no se detectó por tab, intentar por contenido activo (ID)
            if (prueba === 'Natación' && activeTabContent) {
                const contentId = activeTabContent.id;
                console.log('Contenido activo detectado:', contentId);
                
                if (contentId.includes('50m-libre-femenino')) prueba = '50m Libre Femenino';
                else if (contentId.includes('50m-libre-masculino')) prueba = '50m Libre Masculino';
                else if (contentId.includes('100m-libre-femenino')) prueba = '100m Libre Femenino';
                else if (contentId.includes('100m-libre-masculino')) prueba = '100m Libre Masculino';
                else if (contentId.includes('200m-libre-femenino')) prueba = '200m Libre Femenino';
                else if (contentId.includes('200m-libre-masculino')) prueba = '200m Libre Masculino';
                else if (contentId.includes('4x50m-libre-mixto')) prueba = '4x50m Relevo L.Mixto';
                else if (contentId.includes('masculino-general')) prueba = 'Clasificación General Masculina';
                else if (contentId.includes('femenino-general')) prueba = 'Clasificación General Femenina';
                else if (contentId.includes('equipos')) prueba = 'Clasificación por Equipos';
            }
            
            console.log('Prueba detectada:', prueba);
            
            const shareModal = document.createElement('div');
            shareModal.className = 'share-modal';
            shareModal.innerHTML = `
                <div class="share-modal-content">
                    <div class="share-modal-header">
                        <h3>🏊‍♂️ Compartir Resultado</h3>
                        <button class="close-modal" onclick="closeShareModal()">&times;</button>
                    </div>
                    <div class="share-options">
                        <button class="share-option whatsapp" onclick="shareToWhatsApp('${swimmer}', '${position}', '${time}', '${category}')">
                            <span class="share-icon">💬</span>
                            WhatsApp
                        </button>
                        <button class="share-option instagram" onclick="shareToInstagram('${swimmer}', '${position}', '${time}', '${category}')">
                            <span class="share-icon">📷</span>
                            Instagram Stories
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(shareModal);
            
            // Cerrar modal al hacer clic fuera de él
            shareModal.addEventListener('click', function(e) {
                if (e.target === shareModal) {
                    closeShareModal();
                }
            });
        }

        function closeShareModal() {
            const modal = document.querySelector('.share-modal');
            if (modal) {
                modal.remove();
            }
        }

        function shareToWhatsApp(swimmer, position, time, category) {
            // Determinar el tipo de mensaje basado en el contexto
            let message;
            
            if (time && time !== 'N/A' && time !== '-') {
                // Para nadadores individuales con tiempo (pruebas específicas)
                // Convertir nombres de prueba a abreviaciones
                const activeTab = document.querySelector('.tab-button.active');
                let pruebaAbrev = '';
                if (activeTab) {
                    const tabText = activeTab.textContent;
                    pruebaAbrev = tabText.replace('50 m Libre', '50L')
                                        .replace('100 m Libre', '100L')
                                        .replace('200 m Libre', '200L')
                                        .replace('4x50 m Libre', '4x50L')
                                        .replace(' Femenino', '')
                                        .replace(' Masculino', '');
                }
                
                message = `🏊‍♂️ ${swimmer}: ¡Felicitaciones por haber obtenido la posición No. ${position} con un tiempo de ${time} en ${pruebaAbrev} en el IV Championship Master Swimming - 2025! 🏆 

Ver más resultados: https://ivchampionship.netlify.app`;
            } else if (category === 'Clasificación por Equipos') {
                // Para equipos - solo posición
                message = `¡🏊‍♂️ Felicitaciones al equipo ${swimmer} por haber obtenido la posición No. ${position} en el IV Championship Master Swimming - 2025! 🏆 

Ver más resultados: https://ivchampionship.netlify.app`;
            } else {
                // Para clasificación por género - usar categoría
                message = `🏊‍♂️ ${swimmer}: ¡Felicitaciones por haber obtenido la posición No. ${position} en la categoría ${category} en el IV Championship Master Swimming - 2025! 🏆 

Ver más resultados: https://ivchampionship.netlify.app`;
            }
            
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            closeShareModal();
        }

        function shareToInstagram(swimmer, position, time, category) {
            // Determinar el tipo de mensaje basado en el contexto
            let message;
            
            if (time && time !== 'N/A' && time !== '-') {
                // Para nadadores individuales con tiempo (pruebas específicas)
                const activeTab = document.querySelector('.tab-button.active');
                let pruebaAbrev = '';
                if (activeTab) {
                    const tabText = activeTab.textContent;
                    pruebaAbrev = tabText.replace('50 m Libre', '50L')
                                        .replace('100 m Libre', '100L')
                                        .replace('200 m Libre', '200L')
                                        .replace('4x50 m Libre', '4x50L')
                                        .replace(' Femenino', '')
                                        .replace(' Masculino', '');
                }
                
                message = `🏊‍♂️ ${swimmer}: ¡Felicitaciones por haber obtenido la posición No. ${position} con un tiempo de ${time} en ${pruebaAbrev} en el IV Championship Master Swimming -2025! 🏆 

#Natación #AquaTEN #Elyanasnatacion #Championship2025 #Swimming #MasterSwimming

Ver resultados completos: https://ivchampionship.netlify.app`;
            } else if (category === 'Clasificación por Equipos') {
                // Para equipos - solo posición
                message = `🏊‍♂️ Felicitaciones al equipo ${swimmer} por haber obtenido la posición No. ${position} en el IV Championship Master Swimming - 2025! 🏆 

#Natación #AquaTEN #Elyanasnatacion #Championship2025 #TeamWork #MasterSwimming

Ver resultados completos: https://ivchampionship.netlify.app`;
            } else {
                // Para clasificación por género - usar categoría
                message = `🏊‍♂️ ${swimmer}: ¡Felicitaciones por haber obtenido la posición No. ${position} en la categoría ${category} en el IV Championship Master Swimming - 2025! 🏆 

#Natación #AquaTEN #Elyanasnatacion #Championship2025 #Swimming #MasterSwimming

Ver resultados completos: https://ivchampionship.netlify.app`;
            }
            
            // Copiar al portapapeles y mostrar instrucciones
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(message).then(() => {
                    showInstagramInstructions();
                }).catch(() => {
                    fallbackCopyToClipboard(message);
                    showInstagramInstructions();
                });
            } else {
                fallbackCopyToClipboard(message);
                showInstagramInstructions();
            }
            
            closeShareModal();
        }

        // Función auxiliar para copiar al portapapeles (fallback)
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
            } catch (err) {
                console.error('Error copying text: ', err);
            }
            
            document.body.removeChild(textArea);
        }

        // Mostrar instrucciones para Instagram
        function showInstagramInstructions() {
            const instructionModal = document.createElement('div');
            instructionModal.className = 'share-modal';
            instructionModal.innerHTML = `
                <div class="share-modal-content share-modal-content-center">
                    <div class="share-modal-header">
                        <h3 class="instagram-title">📱 Instagram Stories</h3>
                        <button class="close-modal" onclick="closeInstagramInstructions()">&times;</button>
                    </div>
                    <div class="share-content-padding">
                        <div class="share-icon-large">📋✅</div>
                        <p class="share-description">
                            <strong>¡Texto copiado al portapapeles!</strong>
                        </p>
                        <div class="share-steps-box">
                            <p class="share-step"><strong>📱 Paso 1:</strong> Abre Instagram en tu móvil</p>
                            <p class="share-step"><strong>📷 Paso 2:</strong> Ve a Stories</p>
                            <p class="share-step"><strong>✍️ Paso 3:</strong> Pega el texto copiado</p>
                            <p class="share-step"><strong>🚀 Paso 4:</strong> ¡Comparte tu resultado!</p>
                        </div>
                        <button onclick="closeInstagramInstructions()" class="modal-close-btn">
                            Entendido 👍
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(instructionModal);
            
            // Cerrar modal al hacer clic fuera
            instructionModal.addEventListener('click', function(e) {
                if (e.target === instructionModal) {
                    closeInstagramInstructions();
                }
            });
        }

        function closeInstagramInstructions() {
            const modal = document.querySelector('.share-modal');
            if (modal) {
                modal.remove();
            }
        }


        // Diploma download functionality basado en plantilla PNG
        async function downloadDiploma(swimmer, position, team, category) {
            try {
                console.log('🎓 Iniciando descarga de diploma para:', swimmer, position, team, category);
                
                // Clean the data to avoid format issues
                swimmer = swimmer.replace(/['"]/g, '');
                position = position.replace(/['"]/g, '');
                team = team.replace(/['"]/g, '');
                category = category.replace(/['"]/g, '');

                // Obtener tiempos específicos del participante
                console.log('⏱️ Obteniendo tiempos del participante...');
                const participantTimes = getParticipantTimes(swimmer, team);

                // Load jsPDF
                console.log('📄 Cargando jsPDF...');
                const jsPDF = await loadjsPDF();
                
                if (!jsPDF) {
                    throw new Error('No se pudo cargar jsPDF');
                }
                
                const pdf = new jsPDF('landscape', 'mm', 'a4'); // Landscape para diplomas

                // Verificar si tenemos la plantilla cargada
                console.log('🖼️ Estado de plantilla:', diplomaTemplateData ? 'Cargada' : 'No disponible');
                
                if (!diplomaTemplateData) {
                    console.error('❌ Plantilla de diploma PNG no disponible');
                    throw new Error('La plantilla del diploma PNG no está cargada. Asegúrate de que diploma-template.png esté en la carpeta img/');
                }

                // Dimensiones de la página
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                
                // Calcular dimensiones para ajustar la plantilla a la página
                const templateAspectRatio = diplomaTemplateWidth / diplomaTemplateHeight;
                let imgWidth, imgHeight, imgX, imgY;
                
                if (templateAspectRatio > pageWidth / pageHeight) {
                    // La plantilla es más ancha proporcionalmente
                    imgWidth = pageWidth;
                    imgHeight = pageWidth / templateAspectRatio;
                    imgX = 0;
                    imgY = (pageHeight - imgHeight) / 2;
                } else {
                    // La plantilla es más alta proporcionalmente
                    imgHeight = pageHeight;
                    imgWidth = pageHeight * templateAspectRatio;
                    imgX = (pageWidth - imgWidth) / 2;
                    imgY = 0;
                }

                // Agregar la plantilla como fondo
                pdf.addImage(diplomaTemplateData, 'PNG', imgX, imgY, imgWidth, imgHeight);

                // CONFIGURAR POSICIONES PARA EL TEXTO (ajustar según tu diseño)
                // Estas coordenadas necesitarás ajustarlas según donde quieras que aparezca cada texto
                const textPositions = {
                    name: { x: pageWidth * 0.48, y: pageHeight * 0.45 },      // Centro para el nombre
                    position: { x: pageWidth * 0.20, y: pageHeight * 0.7 },   // Posición lograda
                    team: { x: pageWidth * 0.3, y: pageHeight * 0.7 },       // Equipo
                    category: { x: pageWidth * 0.43, y: pageHeight * 0.7 },   // Categoría
                    time50m: { x: pageWidth * 0.55, y: pageHeight * 0.7 },   // Tiempo 50m
                    time100m: { x: pageWidth * 0.67, y: pageHeight * 0.7 },   // Tiempo 100m
                    time200m: { x: pageWidth * 0.79, y: pageHeight * 0.7 }   // Tiempo 200m
                };

                // Configurar estilo del texto
                pdf.setFont("helvetica", "bold");
                
                // Nombre del participante (destacado)
                pdf.setFontSize(28);
                pdf.setTextColor(11, 16, 57); // Azul corporativo
                pdf.text(swimmer.toUpperCase(), textPositions.name.x, textPositions.name.y, { align: "center" });

                // Posición
                pdf.setFontSize(12);
                pdf.setTextColor(0, 173, 239); // Celeste corporativo
                pdf.text(`${position}° LUGAR`, textPositions.position.x, textPositions.position.y, { align: "center" });

                // Equipo
                pdf.setFontSize(12);
                pdf.setTextColor(11, 16, 57);
                pdf.text(team, textPositions.team.x, textPositions.team.y, { align: "center" });

                // Categoría
                pdf.setFontSize(12);
                pdf.setTextColor(80, 80, 80);
                pdf.text(category, textPositions.category.x, textPositions.category.y, { align: "center" });

                // Tiempos (más pequeños)
                pdf.setFontSize(12);
                pdf.setTextColor(60, 60, 60);
                
                pdf.text(`${participantTimes['50m']}`, textPositions.time50m.x, textPositions.time50m.y, { align: "center" });
                pdf.text(`${participantTimes['100m']}`, textPositions.time100m.x, textPositions.time100m.y, { align: "center" });
                pdf.text(`${participantTimes['200m']}`, textPositions.time200m.x, textPositions.time200m.y, { align: "center" });

                // Generate filename and download
                const sanitizedName = swimmer.replace(/[^a-zA-Z0-9]/g, '_');
                const filename = `Diploma_${sanitizedName}_${position}lugar.pdf`;
                
                pdf.save(filename);

            } catch (error) {
                console.error('❌ Error generando diploma:', error);
                console.error('Stack trace:', error.stack);
                alert(`Error generando el diploma: ${error.message}. Asegúrate de que la plantilla diploma-template.png esté disponible en la carpeta img/`);
            }
        }



        // Función para cargar jsPDF dinámicamente
        function loadjsPDF() {
            return new Promise((resolve, reject) => {
                if (window.jsPDF) {
                    resolve(window.jsPDF);
                    return;
                } else if (window.jspdf && window.jspdf.jsPDF) {
                    resolve(window.jspdf.jsPDF);
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                script.onload = () => {
                    // Esperar un poco para que jsPDF se inicialice completamente
                    setTimeout(() => {
                        if (window.jsPDF) {
                            resolve(window.jsPDF);
                        } else if (window.jspdf && window.jspdf.jsPDF) {
                            // Para la versión UMD moderna, asignar jsPDF al window global
                            window.jsPDF = window.jspdf.jsPDF;
                            resolve(window.jsPDF);
                        } else {
                            reject(new Error('jsPDF no se pudo cargar correctamente'));
                        }
                    }, 100);
                };
                script.onerror = () => reject(new Error('Error cargando jsPDF desde CDN'));
                document.head.appendChild(script);
            });
        }

        // Función para descargar PDF con todos los resultados
        async function downloadResultsPDF() {
            const statusDiv = document.getElementById('pdfStatus');
            const downloadBtn = document.getElementById('downloadPdfBtn');
            
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<p class="status-loading-text"><span class="status-loading-icon">⏳</span> Cargando librería PDF...</p>';
            downloadBtn.disabled = true;
            downloadBtn.style.opacity = '0.6';
            
            try {
                // Cargar jsPDF si no está disponible
                await loadjsPDF();
                
                statusDiv.innerHTML = '<p class="status-loading-text"><span class="status-loading-icon">⏳</span> Obteniendo datos frescos...</p>';
                
                // Verificar que jsPDF se cargó correctamente
                if (!window.jsPDF) {
                    throw new Error('jsPDF no está disponible');
                }
                
                // Obtener datos frescos directamente del Google Sheet
                const allSheetData = await getAllSheetData();
                console.log('📊 Datos obtenidos para PDF:', Object.keys(allSheetData));
                console.log('📊 DEBUG PDF - Conteo de datos:', {
                    eventos: allSheetData.eventos?.length || 0,
                    masculino: allSheetData.masculino?.length || 0,
                    femenino: allSheetData.femenino?.length || 0,
                    equipos: allSheetData.equipos?.length || 0
                });
                
                // VALIDACIÓN CRÍTICA: Detectar intercambio de datos femenino/equipos
                console.log('🔍 ANÁLISIS PREVIO AL PDF:', {
                    tieneDataFemenino: !!(allSheetData.femenino && allSheetData.femenino.length > 0),
                    tieneDataEquipos: !!(allSheetData.equipos && allSheetData.equipos.length > 0),
                    columnasFemenino: allSheetData.femenino && allSheetData.femenino[0] ? allSheetData.femenino[0].length : 'N/A',
                    columnasEquipos: allSheetData.equipos && allSheetData.equipos[0] ? allSheetData.equipos[0].length : 'N/A'
                });
                
                if (allSheetData.femenino && allSheetData.femenino.length > 0 && 
                    allSheetData.equipos && allSheetData.equipos.length > 0) {
                    
                    const femeninoParecenEquipos = allSheetData.femenino[0].length <= 5;
                    const equiposParecenAtletas = allSheetData.equipos[0].length > 7;
                    
                    console.log('🔍 ANÁLISIS DE INTERCAMBIO:', {
                        femeninoParecenEquipos: femeninoParecenEquipos,
                        equiposParecenAtletas: equiposParecenAtletas,
                        primeraFilaFemenino: allSheetData.femenino[0],
                        primeraFilaEquipos: allSheetData.equipos[0]
                    });
                    
                    if (femeninoParecenEquipos && equiposParecenAtletas) {
                        console.warn('⚠️ POSIBLE INTERCAMBIO DETECTADO: Datos femeninos y equipos pueden estar intercambiados');
                        console.log('ℹ️ INTERCAMBIO DESHABILITADO: Manteniendo datos originales');
                        
                        // DESHABILITADO: No hacer intercambio automático
                        // const temp = allSheetData.femenino;
                        // allSheetData.femenino = allSheetData.equipos;
                        // allSheetData.equipos = temp;
                        
                        console.log('✅ Corrección aplicada:', {
                            femeninoCorregido: allSheetData.femenino.length + ' filas, ' + (allSheetData.femenino[0] ? allSheetData.femenino[0].length : 0) + ' columnas',
                            equiposCorregido: allSheetData.equipos.length + ' filas, ' + (allSheetData.equipos[0] ? allSheetData.equipos[0].length : 0) + ' columnas'
                        });
                        
                        // Marcar que ya se hizo la corrección global
                        allSheetData._intercambioCorregido = true;
                    } else {
                        console.log('ℹ️ No se detectó intercambio en validación global');
                    }
                } else {
                    console.warn('⚠️ Faltan datos para validar intercambio global');
                }
                
                // Validación adicional: Si falta alguna sección crítica, mostrar advertencia
                if (!allSheetData.femenino || allSheetData.femenino.length === 0) {
                    console.warn('⚠️ ADVERTENCIA PDF: No hay datos de clasificación femenina');
                }
                if (!allSheetData.equipos || allSheetData.equipos.length === 0) {
                    console.warn('⚠️ ADVERTENCIA PDF: No hay datos de clasificación de equipos');
                }
                
                // Asegurar que las estructuras existan aunque estén vacías
                allSheetData.eventos = allSheetData.eventos || [];
                allSheetData.masculino = allSheetData.masculino || [];
                allSheetData.femenino = allSheetData.femenino || [];
                allSheetData.equipos = allSheetData.equipos || [];
                
                statusDiv.innerHTML = '<p class="status-loading-text"><span class="status-loading-icon">⏳</span> Generando PDF...</p>';
                
                const pdf = new window.jsPDF();
                let yPosition = 20;
                
                // Configurar fuentes y colores
                pdf.setFont("helvetica", "bold");
                pdf.setFontSize(18);
                pdf.setTextColor(11, 16, 57); // Color azul del sitio
                
                // Título principal
                pdf.text("IV CHAMPIONSHIP MASTER AQUATEN - RESULTADOS OFICIALES", 105, yPosition, { align: "center" });
                yPosition += 15;
                
                pdf.setFontSize(12);
                pdf.setTextColor(102, 102, 102);
                pdf.text("Reporte generado el " + new Date().toLocaleDateString('es-ES') + " a las " + new Date().toLocaleTimeString('es-ES'), 105, yPosition, { align: "center" });
                yPosition += 20;
                
                // RESULTADOS POR PRUEBAS
                yPosition = await addEventResultsBoxesToPDF(pdf, yPosition, allSheetData);
                
                // CLASIFICACIÓN GENERAL MASCULINA (nueva página)
                pdf.addPage();
                addCompetitionLogo(pdf);
                yPosition = 30;
                yPosition = await addMasculinoResultsToPDF(pdf, yPosition, allSheetData);
                
                // CLASIFICACIÓN GENERAL FEMENINA (nueva página)
                pdf.addPage();
                addCompetitionLogo(pdf);
                yPosition = 30;
                yPosition = await addFemeninoResultsToPDF(pdf, yPosition, allSheetData);
                
                // CLASIFICACIÓN POR EQUIPOS (nueva página)
                pdf.addPage();
                addCompetitionLogo(pdf);
                yPosition = 30;
                await addEquiposResultsToPDF(pdf, yPosition, allSheetData);
                
                // Guardar el PDF
                const fileName = `Resultados_IV_Championship_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(fileName);
                
                // Ocultar status
                statusDiv.style.display = 'none';
                
            } catch (error) {
                console.error('Error generando PDF:', error);
                let errorMessage = 'Error desconocido';
                if (error.message.includes('jsPDF')) {
                    errorMessage = 'Error cargando la librería PDF. Verifica tu conexión a internet.';
                } else if (error.message.includes('network')) {
                    errorMessage = 'Error de conexión. Verifica tu internet.';
                } else {
                    errorMessage = error.message || 'Error procesando los datos para el PDF';
                }
                
                statusDiv.innerHTML = `<p class="status-error-text">❌ ${errorMessage}<br><small>Revisa la consola para más detalles.</small></p>`;
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            } finally {
                downloadBtn.disabled = false;
                downloadBtn.style.opacity = '1';
            }
        }

        // Función para determinar el rango de columnas según el tipo de hoja
        function getColumnRange(sheetName) {
            if (!sheetName) return 'A:H'; // Por defecto
            
            const upperName = sheetName.toUpperCase();
            
            // Clasificación general - necesitan hasta columna J (ACTIVADOR)
            if (upperName.includes('RESULTADOS')) {
                return 'A:J';
            }
            
            // Equipos - solo hasta columna F
            if (upperName.includes('EQUIPOS') || upperName.includes('EQUIPO')) {
                return 'A:F';
            }
            
            // Pruebas individuales - hasta columna H (Obs)
            return 'A:H';
        }

        // Función para cargar datos directamente del Google Sheet
        async function loadDirectSheetData(gid, sheetName) {
            try {
                const range = getColumnRange(sheetName);
                const url = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/export?format=csv&gid=${gid}&range=${range}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const csvText = await response.text();
                const rows = csvText.split('\n').map(row => {
                    // Parse CSV properly handling commas in quotes
                    const result = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            result.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    result.push(current.trim());
                    return result;
                }).filter(row => row.length > 1 && row[0]); // Filter empty rows
                
                return rows.slice(1); // Skip header row
            } catch (error) {
                console.error(`Error cargando ${sheetName}:`, error);
                return [];
            }
        }

        // Función para mapear títulos de hojas a nombres de display amigables
        function mapSheetTitleToDisplayName(sheetTitle) {
            const title = sheetTitle.toUpperCase().trim();
            
            // Mapeo de títulos comunes a nombres de display
            const titleMapping = {
                // 50m libre
                'FEMENINO': '50m Libre Femenino',
                '50M-FEM': '50m Libre Femenino',
                '50M FEM': '50m Libre Femenino',
                '50M-FEMENINO': '50m Libre Femenino',
                '50M FEMENINO': '50m Libre Femenino',
                
                'MASCULINO': '50m Libre Masculino',
                '50M-MAS': '50m Libre Masculino',
                '50M MAS': '50m Libre Masculino',
                '50M-MASCULINO': '50m Libre Masculino',
                '50M MASCULINO': '50m Libre Masculino',
                
                // 100m libre
                '100M-FEM': '100m Libre Femenino',
                '100M FEM': '100m Libre Femenino',
                '100M-FEMENINO': '100m Libre Femenino',
                '100M FEMENINO': '100m Libre Femenino',
                'FEMENINO 100M': '100m Libre Femenino',
                
                '100M-MAS': '100m Libre Masculino',
                '100M MAS': '100m Libre Masculino',
                '100M-MASCULINO': '100m Libre Masculino',
                '100M MASCULINO': '100m Libre Masculino',
                'MASCULINO 100M': '100m Libre Masculino',
                
                // 200m libre
                '200M-FEM': '200m Libre Femenino',
                '200M FEM': '200m Libre Femenino',
                '200M-FEMENINO': '200m Libre Femenino',
                '200M FEMENINO': '200m Libre Femenino',
                'FEMENINO 200M': '200m Libre Femenino',
                
                '200M-MAS': '200m Libre Masculino',
                '200M MAS': '200m Libre Masculino',
                '200M-MASCULINO': '200m Libre Masculino',
                '200M MASCULINO': '200m Libre Masculino',
                'MASCULINO 200M': '200m Libre Masculino',
                
                // 4x50m libre
                '4X50M-MIXTO': '4x50m Relevo L.Mixto',
                '4X50M MIXTO': '4x50m Relevo L.Mixto',
                '4X50M-MIX': '4x50m Relevo L.Mixto',
                '4X50M MIX': '4x50m Relevo L.Mixto',
                'MIXTO 4X50M': '4x50m Relevo L.Mixto'
            };
            
            // Buscar coincidencia exacta
            if (titleMapping[title]) {
                return titleMapping[title];
            }
            
            // Buscar coincidencias parciales para casos donde el título tenga formato diferente
            if (title.includes('50') && title.includes('FEM')) return '50m Libre Femenino';
            if (title.includes('50') && title.includes('MAS')) return '50m Libre Masculino';
            if (title.includes('100') && title.includes('FEM')) return '100m Libre Femenino';
            if (title.includes('100') && title.includes('MAS')) return '100m Libre Masculino';
            if (title.includes('200') && title.includes('FEM')) return '200m Libre Femenino';
            if (title.includes('200') && title.includes('MAS')) return '200m Libre Masculino';
            if (title.includes('4X50') && title.includes('MIX')) return '4x50m Relevo L.Mixto';
            
            // Si no hay coincidencia, devolver el título original
            return sheetTitle;
        }

        // Función auxiliar para intentar cargar datos por nombre de hoja como fallback
        async function tryLoadByName(sheetInfo, allData, dataKey, possibleNames) {
            for (const sheet of sheetInfo) {
                const titleUpper = sheet.title.toUpperCase();
                const matchFound = possibleNames.some(name => titleUpper.includes(name.toUpperCase()));
                
                if (matchFound) {
                    console.log(`🔄 Fallback: Intentando cargar "${dataKey}" desde hoja "${sheet.title}"`);
                    try {
                        const data = await loadSheetByGid(sheet.gid);
                        if (data && data.length > 1) {
                            const dataRows = data.slice(1).filter(row => 
                                row && row.length > 0 && row.some(cell => cell && cell.trim() !== '')
                            );
                            if (dataRows.length > 0) {
                                allData[dataKey] = dataRows;
                                console.log(`✅ Fallback exitoso: ${dataKey} cargado con ${dataRows.length} filas desde "${sheet.title}"`);
                                return true;
                            }
                        }
                    } catch (error) {
                        console.warn(`⚠️ Error en fallback para ${dataKey} desde "${sheet.title}":`, error);
                    }
                }
            }
            console.warn(`❌ Fallback fallido: No se pudo cargar ${dataKey} por nombre`);
            return false;
        }

        // Función para cargar todas las hojas por posición
        async function getAllSheetData() {
            try {
                console.log('🔍 Cargando hojas del Google Sheet por posición...');
                
                // Primero obtener información de todas las hojas disponibles
                const sheetInfo = await getSheetInfo();
                
                // Validar que se obtuvieron los datos del sheet
                if (!sheetInfo || !Array.isArray(sheetInfo)) {
                    console.error('❌ No se pudo obtener información de las hojas');
                    console.error('📄 SheetInfo recibido:', sheetInfo);
                    throw new Error('No se pudo acceder a la información de las hojas del Google Sheet');
                }
                
                console.log('📋 Total de hojas disponibles:', sheetInfo.length);
                console.log('📋 Hojas:', sheetInfo.map((s, i) => `${i}: ${s.title} (GID: ${s.gid})`));
                
                const allData = {
                    eventos: [],
                    masculino: [],
                    femenino: [],
                    equipos: []
                };
                
                // Cargar primeras 8 hojas (eventos)
                console.log('🏊‍♀️ Cargando hojas de eventos (0-7)...');
                for (let i = 0; i < Math.min(8, sheetInfo.length); i++) {
                    const sheet = sheetInfo[i];
                    console.log(`📄 Cargando evento ${i + 1}: ${sheet.title}`);
                    
                    try {
                        const data = await loadSheetByGid(sheet.gid);
                        if (data && data.length > 1) { // Asegurarse de que hay más que solo headers
                            // Saltear la primera fila (headers) y tomar todo lo demás
                            const dataRows = data.slice(1).filter(row => 
                                row && row.length > 0 && row.some(cell => cell && cell.trim() !== '')
                            );
                            console.log(`✅ ${sheet.title}: ${dataRows.length} filas de datos (salteando headers)`);
                            allData.eventos.push({
                                name: mapSheetTitleToDisplayName(sheet.title),
                                data: dataRows
                            });
                        }
                    } catch (error) {
                        console.warn(`⚠️ Error cargando ${sheet.title}:`, error);
                    }
                }
                
                // Cargar siguiente 2 hojas (género) - posiciones 8 y 9
                console.log('👥 Cargando hojas de género (8-9)...');
                if (sheetInfo.length > 8) {
                    const maleSheet = sheetInfo[8];
                    console.log(`📄 Cargando masculino: ${maleSheet.title}`);
                    try {
                        const maleData = await loadSheetByGid(maleSheet.gid);
                        if (maleData && maleData.length > 1) {
                            // Saltear headers y filtrar filas vacías
                            const dataRows = maleData.slice(1).filter(row => 
                                row && row.length > 0 && row.some(cell => cell && cell.trim() !== '')
                            );
                            console.log(`✅ Masculino: ${dataRows.length} filas de datos`);
                            allData.masculino = dataRows; // Fixed: masculino data should go to masculino
                        }
                    } catch (error) {
                        console.warn(`⚠️ Error cargando masculino:`, error);
                    }
                }
                
                // Cargar hoja femenina (índice 9 si hay suficientes hojas)
                if (sheetInfo.length > 9) {
                    const femaleSheet = sheetInfo[9];
                    console.log(`📄 Cargando femenino desde índice 9: ${femaleSheet.title}`);
                    try {
                        const femaleData = await loadSheetByGid(femaleSheet.gid);
                        if (femaleData && femaleData.length > 1) {
                            // Saltear headers y filtrar filas vacías
                            const dataRows = femaleData.slice(1).filter(row => 
                                row && row.length > 0 && row.some(cell => cell && cell.trim() !== '')
                            );
                            console.log(`✅ Femenino: ${dataRows.length} filas de datos`);
                            allData.femenino = dataRows; // Fixed: femenino data should go to femenino
                        }
                    } catch (error) {
                        console.warn(`⚠️ Error cargando femenino:`, error);
                    }
                } else {
                    console.warn(`⚠️ No hay suficientes hojas para clasificación femenina. Total hojas: ${sheetInfo.length}`);
                }
                
                // Cargar hoja de equipos (índice 10 o la última disponible)
                console.log('🏆 Cargando hoja de equipos...');
                let teamSheetIndex = -1;
                
                // Determinar índice correcto para equipos
                if (sheetInfo.length >= 11) {
                    // Si hay 11 o más hojas, equipos está en índice 10
                    teamSheetIndex = 10;
                    console.log(`📊 Configuración estándar: equipos en índice 10`);
                } else if (sheetInfo.length === 10) {
                    // Si hay exactamente 10 hojas, necesitamos determinar cuál es cuál
                    console.warn(`⚠️ Configuración de 10 hojas detectada - determinando distribución`);
                    
                    // Verificar si ya cargamos datos femeninos
                    if (allData.femenino.length > 0) {
                        // Si ya tenemos datos femeninos, no usar el índice 9 para equipos
                        console.log(`📊 Femenino ya cargado, equipos no disponible como hoja separada`);
                        teamSheetIndex = -1;
                    } else {
                        // Si no hay datos femeninos, usar la hoja 9 para equipos
                        teamSheetIndex = 9;
                        console.log(`📊 Configuración especial: usando hoja 9 para equipos (sin datos femeninos)`);
                    }
                } else {
                    // Menos de 10 hojas - equipos podría estar en la última disponible
                    teamSheetIndex = sheetInfo.length - 1;
                    console.log(`📊 Configuración reducida: equipos en última hoja disponible (índice ${teamSheetIndex})`);
                }
                
                if (teamSheetIndex >= 0 && teamSheetIndex < sheetInfo.length) {
                    const teamSheet = sheetInfo[teamSheetIndex];
                    console.log(`📄 Intentando cargar equipos desde índice ${teamSheetIndex}: ${teamSheet.title}`);
                    try {
                        const teamData = await loadSheetByGid(teamSheet.gid);
                        if (teamData && teamData.length > 1) {
                            // Saltear headers y filtrar filas vacías
                            const dataRows = teamData.slice(1).filter(row => 
                                row && row.length > 0 && row.some(cell => cell && cell.trim() !== '')
                            );
                            console.log(`✅ Equipos: ${dataRows.length} filas de datos desde "${teamSheet.title}"`);
                            allData.equipos = dataRows;
                        }
                    } catch (error) {
                        console.warn(`⚠️ Error cargando equipos desde índice ${teamSheetIndex}:`, error);
                    }
                } else {
                    console.warn(`⚠️ No se pudo determinar la hoja de equipos. Total hojas disponibles: ${sheetInfo.length}`);
                }
                
                console.log('📊 Resumen final de carga de datos:', {
                    eventos: allData.eventos.length,
                    masculino: allData.masculino.length,
                    femenino: allData.femenino.length,
                    equipos: allData.equipos.length
                });
                
                // Debugging adicional para las últimas hojas
                if (allData.femenino.length === 0) {
                    console.warn('⚠️ PROBLEMA: No se cargaron datos femeninos - intentando fallback por nombre');
                    await tryLoadByName(sheetInfo, allData, 'femenino', ['CLASIFICACIÓN GENERAL FEMENINA', 'FEMENINO', 'RESULTADOS-FEMENINO', 'RESULTADOS FEMENINO']);
                }
                if (allData.equipos.length === 0) {
                    console.warn('⚠️ PROBLEMA: No se cargaron datos de equipos - intentando fallback por nombre');
                    await tryLoadByName(sheetInfo, allData, 'equipos', ['EQUIPOS', 'EQUIPO', 'CLASIFICACION EQUIPOS', 'TEAM']);
                }
                
                // Log de información de todas las hojas para debugging
                console.log('📋 Información completa de hojas disponibles:');
                sheetInfo.forEach((sheet, index) => {
                    console.log(`  ${index}: "${sheet.title}" (GID: ${sheet.gid})`);
                });
                
                return allData;
                
            } catch (error) {
                console.error('❌ Error cargando datos del Google Sheet:', error);
                
                // Como fallback, intentar cargar datos desde las tablas HTML existentes
                console.log('🔄 Intentando fallback desde tablas HTML...');
                try {
                    const htmlData = getDataFromHTMLTables();
                    if (htmlData && Object.keys(htmlData).length > 0) {
                        console.log('✅ Fallback exitoso desde HTML');
                        
                        // Mapear correctamente los datos HTML a la estructura esperada
                        const estructuradoHTML = {
                            eventos: [],
                            masculino: htmlData['RESULTADOS-MASCULINO'] || htmlData['RESULTADOS MASCULINO'] || htmlData['MASCULINO'] || [],
                            femenino: htmlData['CLASIFICACIÓN GENERAL FEMENINA'] || htmlData['RESULTADOS-FEMENINO'] || htmlData['RESULTADOS FEMENINO'] || htmlData['FEMENINO'] || [],
                            equipos: htmlData['EQUIPOS'] || htmlData['EQUIPO'] || htmlData['TEAMS'] || []
                        };
                        
                        console.log('📊 Fallback HTML - Datos estructurados:', {
                            masculino: estructuradoHTML.masculino.length,
                            femenino: estructuradoHTML.femenino.length,
                            equipos: estructuradoHTML.equipos.length
                        });
                        
                        return estructuradoHTML;
                    }
                } catch (htmlError) {
                    console.warn('⚠️ Fallback HTML falló:', htmlError);
                }
                
                // Si el HTML fallback falla, intentar la primera hoja como último recurso
                console.log('🔄 Último intento: cargando primera hoja...');
                try {
                    const fallbackData = await loadSheetByGid(0);
                    if (fallbackData && fallbackData.length > 0) {
                        console.log('✅ Fallback exitoso:', fallbackData.length, 'filas');
                        return {
                            eventos: [{ name: 'Resultados Generales', data: fallbackData }],
                            masculino: [],
                            femenino: [],
                            equipos: []
                        };
                    }
                } catch (fallbackError) {
                    console.error('❌ Fallback también falló:', fallbackError);
                }
                
                // Si todo falla, devolver estructura vacía
                return {
                    eventos: [],
                    masculino: [],
                    femenino: [],
                    equipos: []
                };
            }
        }

        // Función de respaldo para leer desde las tablas HTML
        function getDataFromHTMLTables() {
            const allData = {};
            
            // Mapear todas las posibles variantes de nombres de hojas
            const eventTables = [
                { id: 'resultsTableFem', names: ['50M-FEMENINO', 'FEMENINO', '50M FEM'] },
                { id: 'resultsTableMas', names: ['50M-MASCULINO', 'MASCULINO', '50M MAS'] },
                { id: 'resultsTable100mFem', names: ['100M-FEMENINO', '100M FEM'] },
                { id: 'resultsTable100mMas', names: ['100M-MASCULINO', '100M MAS'] },
                { id: 'resultsTable200mFem', names: ['200M-FEMENINO', '200M FEM'] },
                { id: 'resultsTable200mMas', names: ['200M-MASCULINO', '200M MAS'] },
                { id: 'resultsTable4x50mMixto', names: ['4X50M-MIXTO', '4X50M MIX'] }
            ];
            
            eventTables.forEach(({ id, names }) => {
                const table = document.getElementById(id);
                if (table) {
                    const data = [];
                    const rows = table.querySelectorAll('tbody tr:not(.loading-row)');
                    rows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        if (cells.length >= 4) {
                            data.push({
                                position: cells[0].textContent.trim(),
                                athlete: cells[1].textContent.trim(),
                                team: cells[2].textContent.trim(),
                                time: cells[3].textContent.trim(),
                                points: cells[4] ? cells[4].textContent.trim() : ''
                            });
                        }
                    });
                    if (data.length > 0) {
                        // Usar todos los nombres posibles para esta tabla
                        names.forEach(name => {
                            allData[name] = data;
                        });
                    }
                }
            });
            
            // Agregar datos por género con múltiples nombres
            const genderTables = [
                { id: 'resultsTableMasculinoGeneral', names: ['RESULTADOS-MASCULINO', 'RESULTADOS MASCULINO', 'MASCULINO'] },
                { id: 'resultsTableFemeninoGeneral', names: ['CLASIFICACIÓN GENERAL FEMENINA', 'RESULTADOS-FEMENINO', 'RESULTADOS FEMENINO', 'FEMENINO'] }
            ];
            
            genderTables.forEach(({ id, names }) => {
                const table = document.getElementById(id);
                if (table) {
                    const data = [];
                    const rows = table.querySelectorAll('tbody tr:not(.loading-row)');
                    rows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        if (cells.length >= 4) {
                            data.push({
                                position: cells[0].textContent.trim(),
                                athlete: cells[1].textContent.trim(),
                                team: cells[2].textContent.trim(),
                                points: cells[3].textContent.trim()
                            });
                        }
                    });
                    if (data.length > 0) {
                        // Usar todos los nombres posibles
                        names.forEach(name => {
                            allData[name] = data;
                        });
                    }
                }
            });
            
            // Agregar datos por equipo con múltiples nombres
            const teamsTable = document.getElementById('resultsTableTeams');
            if (teamsTable) {
                const data = [];
                const rows = teamsTable.querySelectorAll('tbody tr:not(.loading-row)');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 3) {
                        data.push({
                            position: cells[0].textContent.trim(),
                            team: cells[1].textContent.trim(),
                            points: cells[2].textContent.trim()
                        });
                    }
                });
                if (data.length > 0) {
                    // Usar todos los nombres posibles para equipos
                    const teamNames = ['EQUIPOS', 'EQUIPO', 'TEAMS', 'CLASIFICACION EQUIPOS'];
                    teamNames.forEach(name => {
                        allData[name] = data;
                    });
                }
            }
            
            return allData;
        }

        // Función para formatear tiempo correctamente
        function formatTime(timeStr) {
            if (!timeStr || timeStr === '') return '';
            
            // Si ya está en formato mm:ss,cc, devolverlo tal como está
            if (/^\d{1,2}:\d{2},\d{2}$/.test(timeStr)) {
                return timeStr;
            }
            
            // Si está en formato mm:ss.cc, convertir a mm:ss,cc
            if (/^\d{1,2}:\d{2}\.\d{2}$/.test(timeStr)) {
                return timeStr.replace('.', ',');
            }
            
            // Si está en formato de segundos decimales (ej: 30.45), convertir a mm:ss,cc
            if (/^\d+\.\d{2}$/.test(timeStr)) {
                const totalSeconds = parseFloat(timeStr);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = Math.floor(totalSeconds % 60);
                const centiseconds = Math.round((totalSeconds % 1) * 100);
                return `${minutes}:${seconds.toString().padStart(2, '0')},${centiseconds.toString().padStart(2, '0')}`;
            }
            
            return timeStr; // Devolver sin cambios si no coincide con ningún formato
        }

        // Variable global para almacenar el logo cargado
        let logoImageData = null;
        let logoOriginalWidth = 0;
        let logoOriginalHeight = 0;
        let logoLoadAttempted = false;

        // Variables globales para el diploma
        let diplomaTemplateData = null;
        let diplomaTemplateWidth = 0;
        let diplomaTemplateHeight = 0;
        let diplomaLoadAttempted = false;
        
        // Variables globales para el diploma de récord
        let recordDiplomaTemplateData = null;
        let recordDiplomaTemplateWidth = 0;
        let recordDiplomaTemplateHeight = 0;
        let recordDiplomaLoadAttempted = false;
        
        // Variables globales para el diploma de equipo
        let teamDiplomaTemplateData = null;
        let teamDiplomaTemplateWidth = 0;
        let teamDiplomaTemplateHeight = 0;
        let teamDiplomaLoadAttempted = false;

        // Función para obtener tiempos específicos de un participante en las diferentes pruebas
        function getParticipantTimes(participantName, participantTeam) {
            const times = {
                '50m': 'N/A',
                '100m': 'N/A',
                '200m': 'N/A'
            };
            
            try {
                // Mapeo de las tablas de eventos con sus identificadores
                const eventTables = [
                    { distance: '50m', tables: ['resultsTableFem', 'resultsTableMas'] },
                    { distance: '100m', tables: ['resultsTable100mFem', 'resultsTable100mMas'] },
                    { distance: '200m', tables: ['resultsTable200mFem', 'resultsTable200mMas'] }
                ];
                
                eventTables.forEach(({ distance, tables }) => {
                    tables.forEach(tableId => {
                        const table = document.getElementById(tableId);
                        if (table && times[distance] === 'N/A') {
                            const rows = table.querySelectorAll('tbody tr:not(.loading-row)');
                            
                            rows.forEach(row => {
                                const cells = row.querySelectorAll('td');
                                if (cells.length >= 6) {
                                    const athleteName = cells[1]?.textContent?.trim() || '';
                                    const teamName = cells[2]?.textContent?.trim() || '';
                                    const finalTime = cells[5]?.textContent?.trim() || '';
                                    
                                    // Comparación flexible de nombres (ignorar mayúsculas y espacios extra)
                                    const nameMatch = athleteName.toLowerCase().includes(participantName.toLowerCase()) ||
                                                    participantName.toLowerCase().includes(athleteName.toLowerCase());
                                    const teamMatch = teamName.toLowerCase().includes(participantTeam.toLowerCase()) ||
                                                    participantTeam.toLowerCase().includes(teamName.toLowerCase());
                                    
                                    if (nameMatch && teamMatch && finalTime && finalTime !== 'N/A' && finalTime !== '-') {
                                        times[distance] = finalTime;
                                    }
                                }
                            });
                        }
                    });
                });
                
                console.log(`⏱️ Tiempos encontrados para ${participantName}:`, times);
                return times;
                
            } catch (error) {
                console.warn('Error obteniendo tiempos del participante:', error);
                return times;
            }
        }

        // Función para precargar la plantilla del diploma (se ejecuta una sola vez)
        function preloadDiplomaTemplate() {
            if (diplomaLoadAttempted) return;
            diplomaLoadAttempted = true;
            
            try {
                const diplomaImg = new Image();
                diplomaImg.crossOrigin = 'anonymous';
                
                diplomaImg.onload = function() {
                    try {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = diplomaImg.width;
                        canvas.height = diplomaImg.height;
                        ctx.drawImage(diplomaImg, 0, 0);
                        diplomaTemplateData = canvas.toDataURL('image/png');
                        
                        // Guardar dimensiones originales
                        diplomaTemplateWidth = diplomaImg.width;
                        diplomaTemplateHeight = diplomaImg.height;
                        
                        console.log('✅ Plantilla de diploma cargada correctamente');
                        console.log(`📐 Dimensiones plantilla: ${diplomaTemplateWidth}x${diplomaTemplateHeight}px`);
                    } catch (error) {
                        console.warn('Error procesando plantilla de diploma:', error);
                    }
                };
                
                diplomaImg.onerror = function() {
                    console.warn('Error cargando plantilla de diploma desde:', diplomaImg.src);
                };
                
                // Cambia este nombre por el archivo que subas a la carpeta img/
                diplomaImg.src = './img/diploma-template.png';
            } catch (error) {
                console.warn('Error iniciando carga de plantilla de diploma:', error);
            }
        }

        // Función para precargar la plantilla del diploma de récord
        function preloadRecordDiplomaTemplate() {
            if (recordDiplomaLoadAttempted) return;
            recordDiplomaLoadAttempted = true;
            
            try {
                const recordDiplomaImg = new Image();
                recordDiplomaImg.crossOrigin = 'anonymous';
                
                recordDiplomaImg.onload = function() {
                    try {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = recordDiplomaImg.width;
                        canvas.height = recordDiplomaImg.height;
                        ctx.drawImage(recordDiplomaImg, 0, 0);
                        recordDiplomaTemplateData = canvas.toDataURL('image/png');
                        
                        recordDiplomaTemplateWidth = recordDiplomaImg.width;
                        recordDiplomaTemplateHeight = recordDiplomaImg.height;
                        
                        console.log('✅ Plantilla de diploma de récord cargada correctamente');
                        console.log(`📐 Dimensiones: ${recordDiplomaTemplateWidth}x${recordDiplomaTemplateHeight}px`);
                    } catch (error) {
                        console.warn('Error procesando plantilla de diploma de récord:', error);
                    }
                };
                
                recordDiplomaImg.onerror = function() {
                    console.warn('Error cargando plantilla de diploma de récord desde:', recordDiplomaImg.src);
                };
                
                recordDiplomaImg.src = './img/diploma-record-template.png';
            } catch (error) {
                console.warn('Error iniciando carga de plantilla de diploma de récord:', error);
            }
        }

        // Función para obtener el nombre del evento actual
        function getCurrentEventName() {
            const activeTab = document.querySelector('.tab-button.active');
            if (activeTab) {
                const tabText = activeTab.textContent.trim();
                return tabText;
            }
            
            // Fallback: buscar por contenido activo
            const activeContent = document.querySelector('.tab-content.active');
            if (activeContent) {
                const contentId = activeContent.id;
                if (contentId.includes('50m-libre-femenino')) return '50m Libre Femenino';
                else if (contentId.includes('50m-libre-masculino')) return '50m Libre Masculino';
                else if (contentId.includes('100m-libre-femenino')) return '100m Libre Femenino';
                else if (contentId.includes('100m-libre-masculino')) return '100m Libre Masculino';
                else if (contentId.includes('200m-libre-femenino')) return '200m Libre Femenino';
                else if (contentId.includes('200m-libre-masculino')) return '200m Libre Masculino';
                else if (contentId.includes('4x50m-libre-mixto')) return '4x50m Relevo L.Mixto';
            }
            
            return 'Evento de Natación';
        }
        
        // Función para generar diploma de récord
        async function generateDiploma(nombre, equipo, categoria, tiempo, prueba) {
            try {
                console.log('🎓 Generando diploma de récord para:', { nombre, equipo, categoria, tiempo, prueba });
                
                // Cargar jsPDF dinámicamente
                await loadjsPDF();
                
                if (!window.jsPDF) {
                    throw new Error('No se pudo cargar jsPDF');
                }
                
                const pdf = new jsPDF('landscape', 'mm', 'a4');

                // Verificar si tenemos la plantilla de récord cargada
                if (!recordDiplomaTemplateData) {
                    console.error('❌ Plantilla de diploma de récord PNG no disponible');
                    throw new Error('La plantilla del diploma de récord PNG no está cargada. Asegúrate de que diploma-record-template.png esté en la carpeta img/');
                }

                // Dimensiones de la página
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                
                // Calcular dimensiones para ajustar la plantilla a la página
                const templateAspectRatio = recordDiplomaTemplateWidth / recordDiplomaTemplateHeight;
                let imgWidth, imgHeight, imgX, imgY;
                
                if (templateAspectRatio > pageWidth / pageHeight) {
                    // La plantilla es más ancha proporcionalmente
                    imgWidth = pageWidth;
                    imgHeight = pageWidth / templateAspectRatio;
                    imgX = 0;
                    imgY = (pageHeight - imgHeight) / 2;
                } else {
                    // La plantilla es más alta proporcionalmente
                    imgHeight = pageHeight;
                    imgWidth = pageHeight * templateAspectRatio;
                    imgY = 0;
                    imgX = (pageWidth - imgWidth) / 2;
                }
                
                // Agregar la plantilla de fondo
                pdf.addImage(recordDiplomaTemplateData, 'PNG', imgX, imgY, imgWidth, imgHeight);
                
                // Configurar fuente y agregar texto personalizado
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(0, 0, 0);
                
                // Nombre del atleta (centro superior)
                pdf.setFontSize(24);
                const nameY = imgY + (imgHeight * 0.48); // Ajustar posición según el diseño
                pdf.text(nombre || 'ATLETA', pageWidth / 2, nameY, { align: 'center' });
                
                // Prueba
                pdf.setFontSize(12);
                const eventY = nameY + 45;
                pdf.text(`${prueba || 'Evento de Natación'}`, (pageWidth / 2) + 27 , eventY, { align: 'center' });
                
                // Equipo
                pdf.setFontSize(12);
                const teamY = nameY + 45;
                pdf.text(`${equipo || 'N/A'}`, (pageWidth / 2) - 81, teamY, { align: 'center' });
                
                // Categoría
                const categoryY = nameY + 45;
                pdf.text(`${categoria || 'N/A'}`, (pageWidth / 2) - 29, categoryY, { align: 'center' });
                
                // Tiempo récord
                pdf.setFontSize(12);
                const timeY = nameY + 45;
                pdf.text(`${tiempo || 'N/A'}`, (pageWidth / 2) + 80, timeY, { align: 'center' });
                
                // Generar nombre de archivo y descargar
                const sanitizedName = (nombre || 'Atleta').replace(/[^a-zA-Z0-9]/g, '_');
                const filename = `Diploma_Record_${sanitizedName}.pdf`;
                
                pdf.save(filename);
                
                console.log('✅ Diploma de récord generado exitosamente');

            } catch (error) {
                console.error('❌ Error generando diploma de récord:', error);
                alert(`Error generando el diploma de récord: ${error.message}. Asegúrate de que la plantilla diploma-record-template.png esté disponible en la carpeta img/`);
            }
        }

        // Función para precargar la plantilla del diploma de equipo
        function preloadTeamDiplomaTemplate() {
            if (teamDiplomaLoadAttempted) return;
            teamDiplomaLoadAttempted = true;
            
            try {
                const teamDiplomaImg = new Image();
                teamDiplomaImg.crossOrigin = 'anonymous';
                
                teamDiplomaImg.onload = function() {
                    try {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = teamDiplomaImg.width;
                        canvas.height = teamDiplomaImg.height;
                        ctx.drawImage(teamDiplomaImg, 0, 0);
                        teamDiplomaTemplateData = canvas.toDataURL('image/png');
                        
                        teamDiplomaTemplateWidth = teamDiplomaImg.width;
                        teamDiplomaTemplateHeight = teamDiplomaImg.height;
                        
                        console.log('✅ Plantilla de diploma de equipo cargada correctamente');
                        console.log(`📐 Dimensiones: ${teamDiplomaTemplateWidth}x${teamDiplomaTemplateHeight}px`);
                    } catch (error) {
                        console.warn('Error procesando plantilla de diploma de equipo:', error);
                    }
                };
                
                teamDiplomaImg.onerror = function() {
                    console.warn('Error cargando plantilla de diploma de equipo desde:', teamDiplomaImg.src);
                };
                
                teamDiplomaImg.src = './img/diploma-equipo-template.png';
            } catch (error) {
                console.warn('Error iniciando carga de plantilla de diploma de equipo:', error);
            }
        }

        // Función para generar diploma de equipo
        async function generateTeamDiploma(nombreEquipo, posicion, puntosTotales) {
            try {
                console.log('🏆 Generando diploma de equipo para:', { nombreEquipo, posicion, puntosTotales });
                
                // Cargar jsPDF dinámicamente
                await loadjsPDF();
                
                if (!window.jsPDF) {
                    throw new Error('No se pudo cargar jsPDF');
                }
                
                const pdf = new jsPDF('landscape', 'mm', 'a4');

                // Verificar si tenemos la plantilla de equipo cargada
                if (!teamDiplomaTemplateData) {
                    console.error('❌ Plantilla de diploma de equipo PNG no disponible');
                    throw new Error('La plantilla del diploma de equipo PNG no está cargada. Asegúrate de que diploma-equipo-template.png esté en la carpeta img/');
                }

                // Dimensiones de la página
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                
                // Calcular dimensiones para ajustar la plantilla a la página
                const templateAspectRatio = teamDiplomaTemplateWidth / teamDiplomaTemplateHeight;
                let imgWidth, imgHeight, imgX, imgY;
                
                if (templateAspectRatio > pageWidth / pageHeight) {
                    // La plantilla es más ancha proporcionalmente
                    imgWidth = pageWidth;
                    imgHeight = pageWidth / templateAspectRatio;
                    imgX = 0;
                    imgY = (pageHeight - imgHeight) / 2;
                } else {
                    // La plantilla es más alta proporcionalmente
                    imgHeight = pageHeight;
                    imgWidth = pageHeight * templateAspectRatio;
                    imgY = 0;
                    imgX = (pageWidth - imgWidth) / 2;
                }
                
                // Agregar la plantilla de fondo
                pdf.addImage(teamDiplomaTemplateData, 'PNG', imgX, imgY, imgWidth, imgHeight);
                
                // Configurar fuente y agregar texto personalizado
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(0, 0, 0);
                
                // Nombre del equipo (centro superior)
                pdf.setFontSize(28);
                const teamNameY = imgY + (imgHeight * 0.48);
                pdf.text(nombreEquipo || 'EQUIPO', pageWidth / 2, teamNameY, { align: 'center' });
                
                // Posición
                pdf.setFontSize(14);
                const positionY = teamNameY + 45;
                let positionText = 'Participación';
                if (posicion === '1' || posicion === 1) positionText = 'PRIMER LUGAR ';
                else if (posicion === '2' || posicion === 2) positionText = 'SEGUNDO LUGAR ';
                else if (posicion === '3' || posicion === 3) positionText = 'TERCER LUGAR ';
                else if (posicion && posicion !== '-') positionText = `${posicion}° LUGAR`;
                
                pdf.text(positionText, (pageWidth / 2) - 48, positionY, { align: 'center' });
                
                // Puntos totales
                pdf.setFontSize(14);
                const pointsY = teamNameY + 50;
                pdf.text(`${puntosTotales || '0'}`, (pageWidth / 2) + 51, pointsY, { align: 'center' });
                
                
                // Generar nombre de archivo y descargar
                const sanitizedTeamName = (nombreEquipo || 'Equipo').replace(/[^a-zA-Z0-9]/g, '_');
                const filename = `Diploma_Equipo_${sanitizedTeamName}.pdf`;
                
                pdf.save(filename);
                
                console.log('✅ Diploma de equipo generado exitosamente');

            } catch (error) {
                console.error('❌ Error generando diploma de equipo:', error);
                alert(`Error generando el diploma de equipo: ${error.message}. Asegúrate de que la plantilla diploma-equipo-template.png esté disponible en la carpeta img/`);
            }
        }

        // Función para precargar el logo (se ejecuta una sola vez)
        function preloadLogo() {
            if (logoLoadAttempted) return;
            logoLoadAttempted = true;
            
            try {
                const logoImg = new Image();
                logoImg.crossOrigin = 'anonymous';
                
                logoImg.onload = function() {
                    try {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = logoImg.width;
                        canvas.height = logoImg.height;
                        ctx.drawImage(logoImg, 0, 0);
                        logoImageData = canvas.toDataURL('image/png');
                        
                        // Guardar dimensiones originales (convertidas a unidades PDF)
                        // Conversión aproximada: píxeles a mm para PDF (300 DPI ≈ 0.264583 mm/píxel)
                        logoOriginalWidth = logoImg.width * 0.264583;
                        logoOriginalHeight = logoImg.height * 0.264583;
                        
                        console.log('✅ Logo cargado correctamente para PDFs');
                        console.log(`📐 Dimensiones originales: ${logoImg.width}x${logoImg.height}px (${logoOriginalWidth.toFixed(1)}x${logoOriginalHeight.toFixed(1)}mm)`);
                    } catch (error) {
                        console.warn('Error procesando logo:', error);
                    }
                };
                
                logoImg.onerror = function() {
                    console.warn('Error cargando logo desde:', logoImg.src);
                };
                
                logoImg.src = './img/LogoPDFChampion.png';
            } catch (error) {
                console.warn('Error iniciando carga de logo:', error);
            }
        }

        // Función para agregar logo de la competencia en cada página (síncrona)
        function addCompetitionLogo(pdf) {
            const logoX = 150;
            const logoY = 10;
            
            try {
                // Si tenemos el logo cargado, calcularlo con reducción proporcional
                if (logoImageData && logoOriginalWidth > 0 && logoOriginalHeight > 0) {
                    // Obtener dimensiones de la página PDF
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();
                    
                    // Calcular espacio máximo disponible (con margen de seguridad)
                    const maxWidth = pageWidth - logoX - 10; // 10mm de margen derecho
                    const maxHeight = 40; // Máximo 40mm de altura para no interferir con el contenido
                    
                    // Calcular factor de escala para mantener proporciones
                    let scale = 1;
                    if (logoOriginalWidth > maxWidth || logoOriginalHeight > maxHeight) {
                        const scaleWidth = maxWidth / logoOriginalWidth;
                        const scaleHeight = maxHeight / logoOriginalHeight;
                        scale = Math.min(scaleWidth, scaleHeight); // Usar el factor más restrictivo
                    }
                    
                    // Aplicar escala
                    const finalWidth = logoOriginalWidth * scale;
                    const finalHeight = logoOriginalHeight * scale;
                    
                    console.log(`📐 Logo en PDF: ${finalWidth.toFixed(1)}x${finalHeight.toFixed(1)}mm (escala: ${(scale * 100).toFixed(1)}%)`);
                    
                    pdf.addImage(logoImageData, 'PNG', logoX, logoY, finalWidth, finalHeight);
                    return;
                }
            } catch (error) {
                console.warn('Error agregando logo al PDF:', error);
            }
            
            // Fallback: usar texto estilizado
            addTextLogo(pdf, logoX, logoY);
        }
        
        // Función auxiliar para logo de texto como respaldo
        function addTextLogo(pdf, logoX, logoY) {
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(10);
            pdf.setTextColor(11, 16, 57);
            
            // Caja para el logo
            pdf.setDrawColor(11, 16, 57);
            pdf.setLineWidth(1);
            pdf.rect(logoX, logoY - 8, 30, 16);
            
            // Texto del logo
            pdf.text("IV CHAMP", logoX + 2, logoY - 2);
            pdf.setFontSize(8);
            pdf.text("AQUATEN", logoX + 2, logoY + 4);
            
            // Línea decorativa
            pdf.setDrawColor(25, 118, 210);
            pdf.setLineWidth(2);
            pdf.line(logoX, logoY + 8, logoX + 30, logoY + 8);
        }

        // Función para separar datos por tipo desde RESULTADOS
        function parseResultadosData(allRows) {
            const sections = {
                eventos: [],
                masculino: [],
                femenino: [],
                equipos: []
            };
            
            let currentSection = null;
            
            for (let i = 0; i < allRows.length; i++) {
                const row = allRows[i];
                const firstCell = (row[0] || '').toString().toLowerCase().trim();
                
                // Detectar secciones por palabras clave
                if (firstCell.includes('50m') || firstCell.includes('100m') || firstCell.includes('200m') || firstCell.includes('4x50m')) {
                    currentSection = 'eventos';
                    continue;
                } else if (firstCell.includes('masculino') && firstCell.includes('general')) {
                    currentSection = 'masculino';
                    continue;
                } else if (firstCell.includes('femenino') && firstCell.includes('general')) {
                    currentSection = 'femenino';
                    continue;
                } else if (firstCell.includes('equipo') || firstCell.includes('clasificacion')) {
                    currentSection = 'equipos';
                    continue;
                }
                
                // Agregar datos a la sección actual
                if (currentSection && row.length >= 3 && 
                    !firstCell.includes('lugar') && !firstCell.includes('pos') &&
                    row[0] && row[1]) {
                    sections[currentSection].push(row);
                }
            }
            
            console.log('📊 Secciones parseadas:', {
                eventos: sections.eventos.length,
                masculino: sections.masculino.length,
                femenino: sections.femenino.length,
                equipos: sections.equipos.length
            });
            
            return sections;
        }

        // Nueva función para agregar resultados por prueba con formato profesional
        async function addEventResultsBoxesToPDF(pdf, startY, allSheetData) {
            let yPosition = startY;
            
            // Título de sección
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(16);
            pdf.setTextColor(11, 16, 57);
            pdf.text("RESULTADOS POR PRUEBAS", 20, yPosition);
            yPosition += 20;
            
            const eventos = allSheetData.eventos || [];
            
            if (eventos.length > 0) {
                for (const evento of eventos) {
                    // Verificar espacio en la página
                    if (yPosition > 200) {
                        pdf.addPage();
                        addCompetitionLogo(pdf);
                        yPosition = 40;
                    }
                    
                    // Título del evento
                    pdf.setFont("helvetica", "bold");
                    pdf.setFontSize(12);
                    pdf.setTextColor(11, 16, 57);
                    pdf.text(evento.name, 20, yPosition);
                    yPosition += 12;
                    
                    // Crear tabla profesional - Columnas A-G para eventos
                    const tableData = evento.data.map((row, index) => {
                        // Mapear columnas A-G: A=Pos, B=Atleta, C=Equipo, D=Edad, E=Categoría, F=Tiempo, G=Puntos
                        const [pos, athlete, team, age, category, time, points] = row;
                        return {
                            position: pos || (index + 1).toString(),
                            athlete: athlete || '',
                            team: team || '',
                            age: age || '',
                            category: category || '',
                            time: formatTime(time) || '',
                            points: points || ''
                        };
                    });
                    
                    yPosition = drawProfessionalTable(pdf, tableData, yPosition, 'event');
                    yPosition += 10;
                }
            } else {
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(10);
                pdf.setTextColor(128, 128, 128);
                pdf.text("No se encontraron datos de eventos", 20, yPosition);
                yPosition += 20;
            }
            
            return yPosition;
        }

        // Función mejorada para dibujar tabla profesional con paginación automática
        function drawProfessionalTable(pdf, data, startY, type) {
            let yPosition = startY;
            const boxX = 20;
            const boxWidth = 170;
            const headerHeight = 10;
            const rowHeight = 8;
            const maxRowsPerPage = 25; // Máximo de filas por página
            const headerColor = [11, 16, 57]; // Azul corporativo
            
            let processedRows = 0;
            let currentPageRows = 0;
            let currentY = yPosition;
            
            // Función para dibujar encabezados
            function drawHeaders(y) {
                // Marco y fondo del header
                pdf.setDrawColor(180, 180, 180);
                pdf.setLineWidth(0.5);
                pdf.setFillColor(248, 249, 250);
                pdf.rect(boxX, y, boxWidth, headerHeight, 'F');
                pdf.rect(boxX, y, boxWidth, headerHeight);
                
                // Línea debajo del header
                pdf.setDrawColor(200, 200, 200);
                pdf.setLineWidth(0.3);
                pdf.line(boxX, y + headerHeight, boxX + boxWidth, y + headerHeight);
                
                // Configurar texto del header
                pdf.setFont("helvetica", "bold");
                pdf.setFontSize(8);
                pdf.setTextColor(...headerColor);
                
                if (type === 'event') {
                    pdf.text("POS", boxX + 2, y + 7);
                    pdf.text("ATLETA", boxX + 15, y + 7);
                    pdf.text("EQUIPO", boxX + 55, y + 7);
                    pdf.text("EDAD", boxX + 85, y + 7);
                    pdf.text("CAT", boxX + 105, y + 7);
                    pdf.text("TIEMPO", boxX + 125, y + 7);
                    pdf.text("PTS", boxX + 155, y + 7);
                } else if (type === 'gender') {
                    pdf.text("POS", boxX + 2, y + 7);
                    pdf.text("ATLETA", boxX + 15, y + 7);
                    pdf.text("EQUIPO", boxX + 50, y + 7);
                    pdf.text("EDAD", boxX + 75, y + 7);
                    pdf.text("CAT", boxX + 90, y + 7);
                    pdf.text("TOT", boxX + 105, y + 7);
                    pdf.text("200", boxX + 120, y + 7);
                    pdf.text("50", boxX + 135, y + 7);
                    pdf.text("100", boxX + 150, y + 7);
                } else if (type === 'team') {
                    pdf.text("POS", boxX + 3, y + 7);
                    pdf.text("EQUIPO", boxX + 20, y + 7);
                    pdf.text("TOTAL", boxX + 90, y + 7);
                    pdf.text("FEM", boxX + 120, y + 7);
                    pdf.text("MAS", boxX + 145, y + 7);
                }
                return y + headerHeight;
            }
            
            // Dibujar encabezados iniciales
            currentY = drawHeaders(currentY);
            
            // Procesar datos con paginación automática
            for (let i = 0; i < data.length; i++) {
                const row = data[i];
                
                // Verificar si necesitamos nueva página
                if (currentPageRows >= maxRowsPerPage && i < data.length - 1) {
                    // Nueva página
                    pdf.addPage();
                    addCompetitionLogo(pdf);
                    currentY = 30;
                    
                    // Repetir título de sección si es necesario
                    if (type === 'event') {
                        pdf.setFont("helvetica", "bold");
                        pdf.setFontSize(12);
                        pdf.setTextColor(11, 16, 57);
                        pdf.text("RESULTADOS POR PRUEBAS (continuación)", 20, currentY);
                        currentY += 15;
                    } else if (type === 'gender') {
                        pdf.setFont("helvetica", "bold");
                        pdf.setFontSize(12);
                        pdf.setTextColor(11, 16, 57);
                        // Determinar título basándose en los datos disponibles
                        let genderTitle = 'GENERAL';
                        if (data[0] && data[0].genderType) {
                            genderTitle = data[0].genderType === 'masculino' ? 'MASCULINA' : 'FEMENINA';
                        } else {
                            // Fallback: analizar el contenido para determinar el género
                            const sampleData = data.slice(0, 3);
                            const hasMaleNames = sampleData.some(row => 
                                row.athlete && (row.athlete.toLowerCase().includes('carlos') || 
                                               row.athlete.toLowerCase().includes('juan') ||
                                               row.athlete.toLowerCase().includes('miguel'))
                            );
                            genderTitle = hasMaleNames ? 'MASCULINA' : 'FEMENINA';
                        }
                        pdf.text(`CLASIFICACIÓN GENERAL ${genderTitle} (continuación)`, 20, currentY);
                        currentY += 15;
                    } else if (type === 'team') {
                        pdf.setFont("helvetica", "bold");
                        pdf.setFontSize(12);
                        pdf.setTextColor(11, 16, 57);
                        pdf.text("EQUIPOS (continuación)", 20, currentY);
                        currentY += 15;
                    }
                    
                    // Redibujar encabezados
                    currentY = drawHeaders(currentY);
                    currentPageRows = 0;
                }
                
                const rowY = currentY + (currentPageRows * rowHeight);
                
                // Fondo alternado
                if (currentPageRows % 2 === 0) {
                    pdf.setFillColor(240, 248, 255);
                    pdf.rect(boxX, rowY, boxWidth, rowHeight, 'F');
                }
                
                // Destacar podio (solo para los primeros 3 registros globales)
                if (processedRows < 3) {
                    const podiumShades = [
                        [240, 248, 255], // 1er lugar
                        [248, 250, 252], // 2do lugar  
                        [250, 250, 250]  // 3er lugar
                    ];
                    pdf.setFillColor(...podiumShades[processedRows]);
                    pdf.rect(boxX, rowY, boxWidth, rowHeight, 'F');
                    
                    pdf.setDrawColor(...headerColor);
                    pdf.setLineWidth(0.5);
                    pdf.rect(boxX, rowY, boxWidth, rowHeight);
                }
                
                // Configurar texto de datos
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(8);
                pdf.setTextColor(0, 0, 0);
                
                // Escribir datos según el tipo
                if (type === 'event') {
                    pdf.text(row.position || '', boxX + 2, rowY + 5.5);
                    pdf.text((row.athlete || '').substring(0, 18), boxX + 14, rowY + 5.5);
                    pdf.text((row.team || '').substring(0, 12), boxX + 54, rowY + 5.5);
                    pdf.text(row.age || '', boxX + 84, rowY + 5.5);
                    pdf.text((row.category || '').substring(0, 8), boxX + 104, rowY + 5.5);
                    pdf.text(row.time || '', boxX + 124, rowY + 5.5);
                    pdf.text(row.points || '', boxX + 154, rowY + 5.5);
                } else if (type === 'gender') {
                    pdf.text(row.position || '', boxX + 2, rowY + 5.5);
                    pdf.text((row.athlete || '').substring(0, 15), boxX + 14, rowY + 5.5);
                    pdf.text((row.team || '').substring(0, 10), boxX + 49, rowY + 5.5);
                    pdf.text(row.age || '', boxX + 74, rowY + 5.5);
                    pdf.text((row.category || '').substring(0, 6), boxX + 89, rowY + 5.5);
                    pdf.text(row.totalPoints || '', boxX + 104, rowY + 5.5);
                    pdf.text(row.points200m || '', boxX + 119, rowY + 5.5);
                    pdf.text(row.points50m || '', boxX + 134, rowY + 5.5);
                    pdf.text(row.points100m || '', boxX + 149, rowY + 5.5);
                } else if (type === 'team') {
                    pdf.text(row.position || '', boxX + 3, rowY + 5.5);
                    pdf.text((row.team || '').substring(0, 25), boxX + 19, rowY + 5.5);
                    pdf.text(row.totalPoints || '', boxX + 89, rowY + 5.5);
                    pdf.text(row.femalePoints || '', boxX + 119, rowY + 5.5);
                    pdf.text(row.malePoints || '', boxX + 144, rowY + 5.5);
                }
                
                // Línea horizontal sutil entre filas
                if (i < data.length - 1) {
                    pdf.setDrawColor(240, 240, 240);
                    pdf.setLineWidth(0.1);
                    pdf.line(boxX, rowY + rowHeight, boxX + boxWidth, rowY + rowHeight);
                }
                
                currentPageRows++;
                processedRows++;
            }
            
            // Retornar la posición Y final
            return currentY + (currentPageRows * rowHeight) + 10;
        }

        // FUNCIÓN ANTIGUA - DEPRECADA - Usar addMasculinoResultsToPDF y addFemeninoResultsToPDF por separado
        /*
        async function addGenderResultsBoxesToPDF(pdf, startY, allSheetData) {
            let yPosition = startY;
            
            // Título de sección
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(16);
            pdf.setTextColor(11, 16, 57);
            pdf.text("RESULTADOS POR GÉNERO", 20, yPosition);
            yPosition += 20;
            
            // Resultados Masculinos
            if (allSheetData.masculino.length > 0) {
                pdf.setFont("helvetica", "bold");
                pdf.setFontSize(12);
                pdf.setTextColor(11, 16, 57);
                pdf.text("CLASIFICACIÓN GENERAL MASCULINA", 20, yPosition);
                yPosition += 12;
                
                const tableData = allSheetData.masculino.map((row, index) => {
                    // Mapear columnas A-I: A=Pos, B=Atleta, C=Equipo, D=Edad, E=Categoría, F=Pts Totales, G=Pts 200m, H=Pts 50m, I=Pts 100m
                    const [pos, athlete, team, age, category, totalPoints, points200m, points50m, points100m] = row;
                    return {
                        position: pos || (index + 1).toString(),
                        athlete: athlete || '',
                        team: team || '',
                        age: age || '',
                        category: category || '',
                        totalPoints: totalPoints || '',
                        points200m: points200m || '',
                        points50m: points50m || '',
                        points100m: points100m || '',
                        genderType: 'masculino' // Marcador para identificación
                    };
                });
                
                yPosition = drawProfessionalTable(pdf, tableData, yPosition, 'gender');
                yPosition += 15;
            }
            
            // Espacio entre secciones masculina y femenina
            yPosition += 10;
            
            // Nueva página para femeninos solo si realmente es necesario
            if (yPosition > 200) {
                pdf.addPage();
                addCompetitionLogo(pdf);
                yPosition = 30;
            }
            
            // Resultados Femeninos
            console.log('📊 DEBUG PDF - allSheetData completo:', allSheetData);
            console.log('📊 DEBUG PDF - allSheetData.femenino existe?:', !!allSheetData.femenino);
            console.log('📊 DEBUG PDF - Datos femeninos disponibles:', allSheetData.femenino ? allSheetData.femenino.length : 'UNDEFINED/NULL');
            if (allSheetData.femenino && allSheetData.femenino.length > 0) {
                pdf.setFont("helvetica", "bold");
                pdf.setFontSize(12);
                pdf.setTextColor(11, 16, 57);
                pdf.text("CLASIFICACIÓN GENERAL FEMENINA", 20, yPosition);
                yPosition += 12;
                
                console.log('📊 PDF: Procesando datos femeninos, primera fila:', allSheetData.femenino[0]);
                console.log('📊 PDF: Verificando tipo de datos femeninos:', {
                    totalRows: allSheetData.femenino.length,
                    firstAthlete: allSheetData.femenino[0] ? allSheetData.femenino[0][1] : 'N/A',
                    columnCount: allSheetData.femenino[0] ? allSheetData.femenino[0].length : 0
                });
                // VALIDACIÓN: Verificar si los datos son realmente de atletas femeninos o si son datos de equipos
                if (allSheetData.femenino[0] && allSheetData.femenino[0].length <= 5) {
                    console.error('⚠️ ERROR: Los datos femeninos parecen ser datos de equipos (pocas columnas)');
                    console.log('📊 Datos sospechosos:', allSheetData.femenino.slice(0, 3));
                }
                
                const tableData = allSheetData.femenino.map((row, index) => {
                    // Mapear columnas A-I: A=Pos, B=Atleta, C=Equipo, D=Edad, E=Categoría, F=Pts Totales, G=Pts 200m, H=Pts 50m, I=Pts 100m
                    const [pos, athlete, team, age, category, totalPoints, points200m, points50m, points100m] = row;
                    return {
                        position: pos || (index + 1).toString(),
                        athlete: athlete || '',
                        team: team || '',
                        age: age || '',
                        category: category || '',
                        totalPoints: totalPoints || '',
                        points200m: points200m || '',
                        points50m: points50m || '',
                        points100m: points100m || '',
                        genderType: 'femenino' // Marcador para identificación
                    };
                });
                
                yPosition = drawProfessionalTable(pdf, tableData, yPosition, 'gender');
            } else {
                console.warn('⚠️ PDF: No hay datos femeninos para mostrar');
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(10);
                pdf.setTextColor(128, 128, 128);
                pdf.text("No se encontraron datos de clasificación femenina", 20, yPosition);
                yPosition += 20;
            }
            
            return yPosition;
        }
        */

        // FUNCIÓN ANTIGUA - DEPRECADA - Usar addEquiposResultsToPDF en su lugar
        /*
        async function addTeamResultsBoxesToPDF(pdf, startY, allSheetData) {
            let yPosition = startY;
            
            // Título de sección
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(16);
            pdf.setTextColor(11, 16, 57);
            pdf.text("CLASIFICACIÓN GENERAL POR EQUIPOS", 20, yPosition);
            yPosition += 20;
            
            console.log('📊 DEBUG PDF - Datos de equipos disponibles:', allSheetData.equipos.length);
            if (allSheetData.equipos.length > 0) {
                // Crear tabla con todos los equipos - Columnas A-E
                console.log('📊 PDF: Procesando datos de equipos, primera fila:', allSheetData.equipos[0]);
                console.log('📊 PDF: Verificando tipo de datos de equipos:', {
                    totalRows: allSheetData.equipos.length,
                    firstTeam: allSheetData.equipos[0] ? allSheetData.equipos[0][1] : 'N/A',
                    columnCount: allSheetData.equipos[0] ? allSheetData.equipos[0].length : 0
                });
                
                // VALIDACIÓN: Verificar si los datos son realmente de equipos o si son datos de atletas
                if (allSheetData.equipos[0] && allSheetData.equipos[0].length > 7) {
                    console.error('⚠️ ERROR: Los datos de equipos parecen ser datos de atletas (muchas columnas)');
                    console.log('📊 Datos sospechosos:', allSheetData.equipos.slice(0, 3));
                }
                const tableData = allSheetData.equipos.map((row, index) => {
                    // Mapear columnas A-E: A=Pos, B=Equipo, C=Pts Totales, D=Pts Femeninos, E=Pts Masculinos
                    const [pos, team, totalPoints, femalePoints, malePoints] = row;
                    return {
                        position: pos || (index + 1).toString(),
                        team: team || '',
                        totalPoints: totalPoints || '',
                        femalePoints: femalePoints || '',
                        malePoints: malePoints || ''
                    };
                });
                
                yPosition = drawProfessionalTable(pdf, tableData, yPosition, 'team');
            } else {
                console.warn('⚠️ PDF: No hay datos de equipos para mostrar');
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(10);
                pdf.setTextColor(128, 128, 128);
                pdf.text("No se encontraron datos de equipos", 20, yPosition);
                yPosition += 20;
            }
            
            return yPosition;
        }
        */

        // Función independiente para agregar resultados masculinos al PDF
        async function addMasculinoResultsToPDF(pdf, startY, allSheetData) {
            let yPosition = startY;
            
            // Título de sección
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(16);
            pdf.setTextColor(11, 16, 57);
            pdf.text("CLASIFICACIÓN GENERAL MASCULINA", 20, yPosition);
            yPosition += 20;
            
            console.log('📊 DEBUG PDF - Datos masculinos disponibles:', allSheetData.masculino.length);
            console.log('📊 DEBUG PDF - Primera fila masculina:', allSheetData.masculino[0]);
            console.log('📊 DEBUG PDF - Datos femeninos también disponibles:', allSheetData.femenino ? allSheetData.femenino.length : 'NO');
            if (allSheetData.masculino.length > 0) {
                console.log('📊 PDF: Procesando datos masculinos, primera fila:', allSheetData.masculino[0]);
                const tableData = allSheetData.masculino.map((row, index) => {
                    // Mapear columnas A-I: A=Pos, B=Atleta, C=Equipo, D=Edad, E=Categoría, F=Pts Totales, G=Pts 200m, H=Pts 50m, I=Pts 100m
                    const [pos, athlete, team, age, category, totalPoints, points200m, points50m, points100m] = row;
                    return {
                        position: pos || (index + 1).toString(),
                        athlete: athlete || '',
                        team: team || '',
                        age: age || '',
                        category: category || '',
                        totalPoints: totalPoints || '',
                        points200m: points200m || '',
                        points50m: points50m || '',
                        points100m: points100m || '',
                        genderType: 'masculino'
                    };
                });
                
                yPosition = drawProfessionalTable(pdf, tableData, yPosition, 'gender');
            } else {
                console.warn('⚠️ PDF: No hay datos masculinos para mostrar');
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(10);
                pdf.setTextColor(128, 128, 128);
                pdf.text("No se encontraron datos de clasificación masculina", 20, yPosition);
                yPosition += 20;
            }
            
            return yPosition;
        }

        // Función independiente para agregar resultados femeninos al PDF (SIMPLIFICADA COMO MASCULINO)
        async function addFemeninoResultsToPDF(pdf, startY, allSheetData) {
            let yPosition = startY;
            
            // Título de sección
            console.log('🚀 INICIO addFemeninoResultsToPDF - Estado de datos:');
            console.log('📊 allSheetData:', allSheetData ? 'existe' : 'null/undefined');
            console.log('📊 allSheetData.femenino:', allSheetData?.femenino ? allSheetData.femenino.length + ' registros' : 'vacío/undefined');
            console.log('📊 allSheetData.masculino:', allSheetData?.masculino ? allSheetData.masculino.length + ' registros' : 'vacío/undefined');
            console.log('📊 allSheetData.equipos:', allSheetData?.equipos ? allSheetData.equipos.length + ' registros' : 'vacío/undefined');
            console.log('📊 Global allData.femenino:', typeof allData !== 'undefined' && allData?.femenino ? allData.femenino.length + ' registros' : 'no disponible');
            
            // NUEVO: Intentar usar allData global si allSheetData no tiene datos femeninos
            if ((!allSheetData?.femenino || allSheetData.femenino.length === 0) && typeof allData !== 'undefined' && allData?.femenino && allData.femenino.length > 0) {
                console.log('🔄 USANDO allData GLOBAL: Transfiriendo datos femeninos de allData global');
                allSheetData = allSheetData || {};
                allSheetData.femenino = allData.femenino;
                console.log('✅ Datos femeninos transferidos:', allSheetData.femenino.length + ' registros');
            }
            
            // Título de sección
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(16);
            pdf.setTextColor(11, 16, 57);
            pdf.text("CLASIFICACIÓN GENERAL FEMENINA", 20, yPosition);
            yPosition += 20;
            
            console.log('📊 DEBUG PDF FEMENINO - Estado inicial:', {
                datosFemeniniosDisponibles: allSheetData.femenino ? allSheetData.femenino.length : 0,
                intercambioYaCorregido: !!allSheetData._intercambioCorregido,
                primeraFilaFemenino: allSheetData.femenino && allSheetData.femenino.length > 0 ? allSheetData.femenino[0] : 'SIN DATOS'
            });
            
            if (allSheetData.femenino && allSheetData.femenino.length > 0) {
                console.log('📊 PDF: Procesando datos femeninos, primera fila:', allSheetData.femenino[0]);
                console.log('📊 PDF: Verificando tipo de datos femeninos:', {
                    totalRows: allSheetData.femenino.length,
                    firstAthlete: allSheetData.femenino[0] ? allSheetData.femenino[0][1] : 'N/A',
                    columnCount: allSheetData.femenino[0] ? allSheetData.femenino[0].length : 0
                });
                
                // VALIDACIÓN CRÍTICA: Verificar si los datos son realmente de atletas femeninos
                console.log('🔍 VALIDACIÓN FEMENINO:', {
                    intercambioYaCorregido: !!allSheetData._intercambioCorregido,
                    tieneDataFemenino: !!(allSheetData.femenino && allSheetData.femenino[0]),
                    columnasFemenino: allSheetData.femenino && allSheetData.femenino[0] ? allSheetData.femenino[0].length : 'N/A',
                    esMenorOIgualA5: allSheetData.femenino && allSheetData.femenino[0] ? allSheetData.femenino[0].length <= 5 : false
                });
                
                if (!allSheetData._intercambioCorregido && allSheetData.femenino[0] && allSheetData.femenino[0].length <= 5) {
                    console.warn('⚠️ POSIBLE PROBLEMA: Los datos femeninos parecen ser datos de equipos');
                    console.log('📊 Datos recibidos:', allSheetData.femenino.slice(0, 3));
                    
                    // DESHABILITADO: No hacer intercambio automático en función individual
                    console.log('ℹ️ INTERCAMBIO DESHABILITADO: Usando datos como vienen del servidor');
                    /*
                    // CORRECCIÓN AUTOMÁTICA DESHABILITADA: Intentar intercambiar con equipos
                    if (allSheetData.equipos && allSheetData.equipos.length > 0) {
                        console.log('🔄 CORRECCIÓN: Intercambiando datos femeninos y equipos automáticamente');
                        console.log('📊 Antes del intercambio:', {
                            femenino: 'Datos de equipos (' + allSheetData.femenino[0].length + ' columnas)',
                            equipos: 'Datos de atletas (' + (allSheetData.equipos[0] ? allSheetData.equipos[0].length : 0) + ' columnas)'
                        });
                        
                        const temp = allSheetData.femenino;
                        allSheetData.femenino = allSheetData.equipos;
                        allSheetData.equipos = temp;
                        
                        console.log('✅ Intercambio realizado:', {
                            femenino: 'Ahora datos correctos (' + allSheetData.femenino[0].length + ' columnas)',
                            equipos: 'Ahora datos correctos (' + allSheetData.equipos[0].length + ' columnas)'
                        });
                        console.log('📊 Nuevos datos femeninos (primeras filas):', allSheetData.femenino.slice(0, 2));
                    } else {
                        console.error('❌ No hay datos de equipos para intercambiar.');
                        pdf.setFont("helvetica", "normal");
                        pdf.setFontSize(10);
                        pdf.setTextColor(255, 0, 0);
                        pdf.text("ERROR: Los datos femeninos están intercambiados pero no se pueden corregir", 20, yPosition);
                        return yPosition + 20;
                    }
                    */
                }
                
                const tableData = allSheetData.femenino.map((row, index) => {
                    // Mapear columnas A-I: A=Pos, B=Atleta, C=Equipo, D=Edad, E=Categoría, F=Pts Totales, G=Pts 200m, H=Pts 50m, I=Pts 100m
                    const [pos, athlete, team, age, category, totalPoints, points200m, points50m, points100m] = row;
                    return {
                        position: pos || (index + 1).toString(),
                        athlete: athlete || '',
                        team: team || '',
                        age: age || '',
                        category: category || '',
                        totalPoints: totalPoints || '',
                        points200m: points200m || '',
                        points50m: points50m || '',
                        points100m: points100m || '',
                        genderType: 'femenino'
                    };
                });
                
                yPosition = drawProfessionalTable(pdf, tableData, yPosition, 'gender');
            } else {
                console.error('❌ PDF FEMENINO: No hay datos femeninos disponibles');
                
                // VERIFICACIÓN ESPECIAL: Si equipos ya corrigió, tal vez los datos están intercambiados
                if (allSheetData._intercambioCorregido) {
                    console.log('🔍 VERIFICACIÓN POST-CORRECCIÓN: Revisando todas las variables para encontrar datos femeninos');
                    console.log('🔍 Estado actual de todas las variables:', {
                        masculino: allSheetData.masculino ? allSheetData.masculino.length + ' filas' : 'sin datos',
                        femenino: allSheetData.femenino ? allSheetData.femenino.length + ' filas' : 'sin datos',
                        equipos: allSheetData.equipos ? allSheetData.equipos.length + ' filas' : 'sin datos'
                    });
                    
                    // Buscar datos de atletas en cualquier variable (deberían ser femeninos)
                    let datosAtletasEncontrados = null;
                    if (allSheetData.equipos && allSheetData.equipos.length > 0 && allSheetData.equipos[0] && allSheetData.equipos[0].length > 7) {
                        datosAtletasEncontrados = allSheetData.equipos;
                        console.log('🔍 Datos de atletas encontrados en variable equipos');
                    } else if (allSheetData.masculino && allSheetData.masculino.length > 0 && allSheetData.masculino[0] && allSheetData.masculino[0].length > 7) {
                        // Verificar si masculino tiene datos diferentes (podrían ser femeninos)
                        console.log('🔍 Verificando si masculino contiene datos femeninos...');
                    }
                    
                    if (datosAtletasEncontrados) {
                        console.log('🔄 RECUPERACIÓN FEMENINO: Usando datos encontrados para femenino');
                        allSheetData.femenino = datosAtletasEncontrados;
                        allSheetData.equipos = []; // Limpiar equipos para evitar duplicados
                        
                        const tableData = allSheetData.femenino.map((row, index) => {
                            const [pos, athlete, team, age, category, totalPoints, points200m, points50m, points100m] = row;
                            return {
                                position: pos || (index + 1).toString(),
                                athlete: athlete || '',
                                team: team || '',
                                age: age || '',
                                category: category || '',
                                totalPoints: totalPoints || '',
                                points200m: points200m || '',
                                points50m: points50m || '',
                                points100m: points100m || '',
                                genderType: 'femenino'
                            };
                        });
                        
                        yPosition = drawProfessionalTable(pdf, tableData, yPosition, 'gender');
                        return yPosition;
                    }
                }
                
                // ÚLTIMO RECURSO: Intentar cargar desde la tabla HTML
                console.log('🆘 ÚLTIMO RECURSO: Intentando cargar datos femeninos desde tabla HTML');
                console.log('📊 Estado actual de allData.femenino antes del fallback:', allData.femenino ? allData.femenino.length : 'undefined');
                console.log('📊 Estado actual de allData.masculino:', allData.masculino ? allData.masculino.length : 'undefined');
                console.log('📊 Estado actual de allData.equipos:', allData.equipos ? allData.equipos.length : 'undefined');
                
                const tablaFemeninaHTML = document.getElementById('resultsTableFemeninoGeneral');
                
                if (tablaFemeninaHTML) {
                    const filas = tablaFemeninaHTML.querySelectorAll('tbody tr:not(.loading-row):not(.category-header)');
                    console.log('🔍 Filas encontradas en tabla HTML femenina:', filas.length);
                    console.log('🔍 Contenido de la primera fila:', filas[0] ? filas[0].innerHTML : 'No hay filas');
                    console.log('🔍 Contenido del tbody completo:', tablaFemeninaHTML.querySelector('tbody') ? tablaFemeninaHTML.querySelector('tbody').innerHTML.substring(0, 500) + '...' : 'No tbody');
                    
                    if (filas.length > 0) {
                        const datosDeHTML = [];
                        filas.forEach((fila, index) => {
                            const celdas = fila.querySelectorAll('td');
                            console.log(`🔍 Fila ${index}: ${celdas.length} celdas`, celdas.length > 0 ? Array.from(celdas).map(c => c.textContent.trim().substring(0, 20)) : 'sin celdas');
                            if (celdas.length >= 6) {
                                datosDeHTML.push([
                                    celdas[0].textContent.trim() || (index + 1).toString(), // Pos
                                    celdas[1].textContent.trim() || '', // Atleta
                                    celdas[2].textContent.trim() || '', // Equipo
                                    celdas[3].textContent.trim() || '', // Edad
                                    celdas[4].textContent.trim() || '', // Categoría
                                    celdas[5].textContent.trim() || '', // Puntos Totales
                                    celdas[6] ? celdas[6].textContent.trim() : '', // P. 200m Libre
                                    celdas[7] ? celdas[7].textContent.trim() : '', // P. 50m Libre
                                    celdas[8] ? celdas[8].textContent.trim() : ''  // P. 100m Libre
                                ]);
                            }
                        });
                        
                        if (datosDeHTML.length > 0) {
                            console.log('✅ DATOS RECUPERADOS DE HTML:', datosDeHTML.length + ' atletas femeninas');
                            console.log('📊 Primera atleta:', datosDeHTML[0]);
                            
                            const tableData = datosDeHTML.map((row, index) => {
                                const [pos, athlete, team, age, category, totalPoints, points200m, points50m, points100m] = row;
                                return {
                                    position: pos || (index + 1).toString(),
                                    athlete: athlete || '',
                                    team: team || '',
                                    age: age || '',
                                    category: category || '',
                                    totalPoints: totalPoints || '',
                                    points200m: points200m || '',
                                    points50m: points50m || '',
                                    points100m: points100m || '',
                                    genderType: 'femenino'
                                };
                            });
                            
                            yPosition = drawProfessionalTable(pdf, tableData, yPosition, 'gender');
                            return yPosition;
                        }
                    }
                }
                
                console.error('❌ CRÍTICO: No se encontraron datos femeninos en ningún lugar');
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(10);
                pdf.setTextColor(255, 0, 0);
                pdf.text("ERROR: No se encontraron datos de clasificación femenina", 20, yPosition);
                yPosition += 20;
            }
            
            return yPosition;
        }

        // Función independiente para agregar resultados de equipos al PDF
        async function addEquiposResultsToPDF(pdf, startY, allSheetData) {
            let yPosition = startY;
            
            // Título de sección
            pdf.setFont("helvetica", "bold");
            pdf.setFontSize(16);
            pdf.setTextColor(11, 16, 57);
            pdf.text("EQUIPOS", 20, yPosition);
            yPosition += 20;
            
            console.log('📊 DEBUG PDF - Datos de equipos disponibles:', allSheetData.equipos.length);
            if (allSheetData.equipos.length > 0) {
                console.log('📊 PDF: Procesando datos de equipos, primera fila:', allSheetData.equipos[0]);
                console.log('📊 PDF: Verificando tipo de datos de equipos:', {
                    totalRows: allSheetData.equipos.length,
                    firstTeam: allSheetData.equipos[0] ? allSheetData.equipos[0][1] : 'N/A',
                    columnCount: allSheetData.equipos[0] ? allSheetData.equipos[0].length : 0
                });
                
                // VALIDACIÓN CRÍTICA: Verificar si los datos son realmente de equipos
                console.log('🔍 VALIDACIÓN EQUIPOS:', {
                    intercambioYaCorregido: !!allSheetData._intercambioCorregido,
                    tieneDataEquipos: !!(allSheetData.equipos && allSheetData.equipos[0]),
                    columnasEquipos: allSheetData.equipos && allSheetData.equipos[0] ? allSheetData.equipos[0].length : 'N/A',
                    esMayorA7: allSheetData.equipos && allSheetData.equipos[0] ? allSheetData.equipos[0].length > 7 : false
                });
                
                if (!allSheetData._intercambioCorregido && allSheetData.equipos[0] && allSheetData.equipos[0].length > 7) {
                    console.error('❌ DATOS INCORRECTOS: Los datos de equipos son datos de atletas!');
                    console.log('📊 Datos incorrectos recibidos:', allSheetData.equipos.slice(0, 3));
                    
                    // DESHABILITADO: No hacer intercambio automático
                    console.log('ℹ️ INTERCAMBIO DESHABILITADO: Usando datos como vienen del servidor');
                    console.log('📊 Antes del intercambio:', {
                        equipos: 'Datos incorrectos (' + allSheetData.equipos[0].length + ' columnas): ' + JSON.stringify(allSheetData.equipos[0]),
                        femenino: allSheetData.femenino && allSheetData.femenino[0] ? 
                            'Datos disponibles (' + allSheetData.femenino[0].length + ' columnas): ' + JSON.stringify(allSheetData.femenino[0]) : 
                            'Sin datos femeninos'
                    });
                    
                    // DESHABILITADO: No hacer intercambio
                    /*
                    if (allSheetData.femenino && allSheetData.femenino.length > 0) {
                        const temp = allSheetData.equipos;
                        allSheetData.equipos = allSheetData.femenino;
                        allSheetData.femenino = temp;
                        
                        console.log('✅ INTERCAMBIO FORZADO COMPLETADO:', {
                            equipos: 'Nuevos datos (' + allSheetData.equipos[0].length + ' columnas): ' + JSON.stringify(allSheetData.equipos[0]),
                            femenino: 'Nuevos datos (' + allSheetData.femenino[0].length + ' columnas): ' + JSON.stringify(allSheetData.femenino[0])
                        });
                        
                        // Marcar corrección para evitar bucles
                        allSheetData._intercambioCorregido = true;
                        
                        // Continuar con los datos corregidos
                        console.log('🔄 Reintentando procesamiento con datos corregidos...');
                    } else {
                        console.error('❌ CRÍTICO: No hay datos femeninos disponibles para intercambiar');
                        // Crear datos de equipos vacíos para evitar error
                        allSheetData.equipos = [];
                        console.log('🔄 Configurando datos equipos como vacíos para evitar crash');
                    }
                    */
                }
                
                const tableData = allSheetData.equipos.map((row, index) => {
                    // Mapear columnas A-E: A=Pos, B=Equipo, C=Pts Totales, D=Pts Femeninos, E=Pts Masculinos
                    const [pos, team, totalPoints, femalePoints, malePoints] = row;
                    return {
                        position: pos || (index + 1).toString(),
                        team: team || '',
                        totalPoints: totalPoints || '',
                        femalePoints: femalePoints || '',
                        malePoints: malePoints || ''
                    };
                });
                
                yPosition = drawProfessionalTable(pdf, tableData, yPosition, 'team');
            } else {
                console.warn('⚠️ PDF: No hay datos de equipos para mostrar');
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(10);
                pdf.setTextColor(128, 128, 128);
                pdf.text("No se encontraron datos de equipos", 20, yPosition);
                yPosition += 20;
            }
            
            return yPosition;
        }
        
        
        
        
        // Función de respaldo para generar un PDF simple
        async function downloadSimplePDF() {
            const statusDiv = document.getElementById('pdfStatus');
            const downloadBtn = document.getElementById('downloadPdfBtn');
            
            try {
                await loadjsPDF();
                
                const pdf = new window.jsPDF();
                
                // Título simple
                pdf.setFont("helvetica", "bold");
                pdf.setFontSize(16);
                pdf.text("IV CHAMPIONSHIP MASTER AQUATEN - RESULTADOS", 20, 30);
                
                pdf.setFontSize(12);
                pdf.text("Reporte generado el " + new Date().toLocaleDateString('es-ES'), 20, 45);
                
                // Mensaje simple
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(10);
                pdf.text("Para obtener los resultados completos, visita:", 20, 70);
                pdf.text("https://ivchampionship.netlify.app", 20, 80);
                
                // Información básica de eventos
                pdf.setFont("helvetica", "bold");
                pdf.text("EVENTOS DEL CAMPEONATO:", 20, 100);
                
                pdf.setFont("helvetica", "normal");
                const events = [
                    "• 50m Libre",
                    "• 100m Libre", 
                    "• 200m Libre",
                    "• 4x50m Relevo L.Mixto"
                ];
                
                events.forEach((event, index) => {
                    pdf.text(event, 25, 115 + (index * 10));
                });
                
                pdf.save("Resultados_IV_Championship_Simple.pdf");
                statusDiv.style.display = 'none';
                
            } catch (error) {
                console.error('Error en PDF simple:', error);
                statusDiv.innerHTML = '<p class="status-error-text">❌ Error generando PDF. Problema con la librería.</p>';
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            } finally {
                downloadBtn.disabled = false;
                downloadBtn.style.opacity = '1';
            }
        }

        // Agregar event listener al botón
        document.addEventListener('DOMContentLoaded', function() {
            const downloadBtn = document.getElementById('downloadPdfBtn');
            if (downloadBtn) {
                // Solo usar el PDF completo
                downloadBtn.addEventListener('click', async function() {
                    await downloadResultsPDF();
                });
            }
        });

        // Función para descargar términos y condiciones
        function downloadTermsAndConditions() {
            // Mostrar mensaje de preparación
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            
            button.innerHTML = '<span class="button-loading-text">⏳</span>Preparando descarga...';
            button.disabled = true;
            
            try {
                // Crear un enlace de descarga (placeholder - aquí deberías poner la URL real del documento)
                // Por ahora usaremos un PDF de ejemplo generado dinámicamente
                generateTermsPDF();
                
                // Restaurar el botón después de un momento
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('Error al descargar términos:', error);
                button.innerHTML = '<span class="button-error-text">❌</span>Error al descargar';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 3000);
            }
        }

        // Función para generar PDF de términos y condiciones
        async function generateTermsPDF() {
            try {
                // Cargar jsPDF si no está disponible
                await loadjsPDF();
                
                const pdf = new window.jsPDF();
                
                // Configurar el documento
                pdf.setFont("helvetica", "bold");
                pdf.setFontSize(18);
                pdf.setTextColor(11, 16, 57);
                
                // Título
                pdf.text("TÉRMINOS Y CONDICIONES", 105, 30, { align: "center" });
                pdf.text("IV Championship Master Swimming", 105, 45, { align: "center" });
                
                // Línea decorativa
                pdf.setDrawColor(11, 16, 57);
                pdf.setLineWidth(2);
                pdf.line(20, 55, 190, 55);
                
                // Contenido
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(12);
                pdf.setTextColor(0, 0, 0);
                
                let yPos = 75;
                const lineHeight = 8;
                const maxWidth = 170;
                
                const sections = [
                    {
                        title: "1. INFORMACIÓN GENERAL",
                        content: [
                            "• Evento: IV Championship Master Swimming 2025",
                            "• Fecha: 23 de Agosto de 2025",
                            "• Organizado por: AquaTEN y ELYANASNATACION",
                            "• Modalidad: Competencia de natación "
                        ]
                    },
                    {
                        title: "2. PRUEBAS Y CATEGORÍAS",
                        content: [
                            "• 200m Libre (Femenino y Masculino)",
                            "• 50m Libre (Femenino y Masculino)", 
                            "• 100m Libre (Femenino y Masculino)",
                            "• 4x50m Libre (Mixto)",
                            "• Clasificación general por género y equipos"
                        ]
                    },
                    {
                        title: "3. REQUISITOS DE PARTICIPACIÓN",
                        content: [
                            "• Clasificación por categorías según la edad",
                            "• Inscripción completa y pago realizado",
                            "• Aceptación de términos y condiciones"
                        ]
                    },
                    {
                        title: "4. NORMAS Y REGLAMENTOS",
                        content: [
                            "• Uso obligatorio de gorro y gafas",
                            "• Presentarse 30 minutos antes de la prueba",
                            "• Respeto a decisiones de jueces y cronometristas"
                        ]
                    },
                    {
                        title: "5. RESPONSABILIDADES",
                        content: [
                            "• Cada participante es responsable de su seguridad",
                            "• Uso de imagen para promoción del evento"
                        ]
                    }
                ];

                sections.forEach(section => {
                    // Verificar espacio en la página
                    if (yPos > 250) {
                        pdf.addPage();
                        yPos = 30;
                    }

                    // Título de sección
                    pdf.setFont("helvetica", "bold");
                    pdf.setFontSize(14);
                    pdf.setTextColor(11, 16, 57);
                    pdf.text(section.title, 20, yPos);
                    yPos += 15;

                    // Contenido de sección
                    pdf.setFont("helvetica", "normal");
                    pdf.setFontSize(11);
                    pdf.setTextColor(0, 0, 0);
                    
                    section.content.forEach(item => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 30;
                        }
                        pdf.text(item, 25, yPos);
                        yPos += lineHeight;
                    });
                    
                    yPos += 10; // Espacio entre secciones
                });

                // Pie de página
                if (yPos > 240) {
                    pdf.addPage();
                    yPos = 30;
                }
                
                yPos = 280;
                pdf.setFont("helvetica", "italic");
                pdf.setFontSize(9);
                pdf.setTextColor(128, 128, 128);
                pdf.text("Documento generado el " + new Date().toLocaleDateString('es-ES'), 105, yPos, { align: "center" });
                pdf.text("IV Championship Master Swimming - AquaTEN © 2025", 105, yPos + 10, { align: "center" });

                // Descargar el PDF
                pdf.save("Terminos_y_Condiciones_IV_Championship_2025.pdf");
                
                console.log("✅ Términos y condiciones descargados exitosamente");
                
            } catch (error) {
                console.error("❌ Error generando términos y condiciones:", error);
                throw error;
            }
        }

        // Función para descargar documento local
        function downloadLocalDocument() {
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            
            // Cambiar el texto del botón
            button.innerHTML = '<span class="button-loading-text">⏳</span>Descargando...';
            button.disabled = true;
            
            try {
                // Crear un enlace de descarga para el documento local
                // El archivo debe estar en la carpeta 'documentos' del proyecto
                const link = document.createElement('a');
                link.href = 'documentos/Terminos_y_Condiciones_IV_Championship_2025.pdf';
                link.download = 'Terminos_y_Condiciones_IV_Championship_2025.pdf';
                link.target = '_blank';
                
                // Verificar si el archivo existe antes de intentar descargarlo
                fetch(link.href, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            // El archivo existe, proceder with la descarga
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            // Mensaje de éxito
                            button.innerHTML = '<span class="button-success-text">✅</span>Descargado';
                            setTimeout(() => {
                                button.innerHTML = originalText;
                                button.disabled = false;
                            }, 2000);
                        } else {
                            throw new Error('Archivo no encontrado');
                        }
                    })
                    .catch(error => {
                        console.error('Error al verificar el archivo:', error);
                        
                        // Mostrar mensaje de archivo no encontrado
                        button.innerHTML = '<span class="button-not-available-text">📁</span>Archivo no disponible';
                        
                        // Mostrar notificación al usuario
                        showDocumentNotAvailableMessage();
                        
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.disabled = false;
                        }, 3000);
                    });
                
            } catch (error) {
                console.error('Error al descargar documento local:', error);
                button.innerHTML = '<span class="button-error-text">❌</span>Error';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 3000);
            }
        }

        // Función para mostrar mensaje cuando el documento no está disponible
        function showDocumentNotAvailableMessage() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 2px solid #0b1039;
                border-radius: var(--border-radius);
                padding: 30px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                max-width: 400px;
                text-align: center;
            `;
            
            notification.innerHTML = `
                <div class="unavailable-doc-icon">📄</div>
                <h3 class="unavailable-doc-title">Documento no disponible</h3>
                <p class="unavailable-doc-text">
                    El documento oficial aún no ha sido cargado. 
                    <br>Puedes generar una versión temporal usando el botón "Generar PDF".
                </p>
                <button onclick="this.parentElement.remove()" class="modal-remove-btn">Entendido</button>
            `;
            
            // Agregar overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 9999;
            `;
            overlay.onclick = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(notification);
            };
            
            document.body.appendChild(overlay);
            document.body.appendChild(notification);
            
            // Auto-cerrar después de 5 segundos
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(overlay);
                    document.body.removeChild(notification);
                }
            }, 5000);
        }

        // Función para descargar política de privacidad
        function downloadPrivacyPolicy() {
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            
            // Cambiar el texto del botón
            button.innerHTML = '<span class="button-privacy-icon">⏳</span>Descargando...';
            button.disabled = true;
            
            try {
                // Crear un enlace de descarga para el documento local
                // El archivo debe estar en la carpeta 'documentos' del proyecto
                const link = document.createElement('a');
                link.href = 'documentos/Politica_de_Tratamiento_de_Datos_Personales.pdf';
                link.download = 'Politica_de_Tratamiento_de_Datos_Personales.pdf';
                link.target = '_blank';
                
                // Verificar si el archivo existe antes de intentar descargarlo
                fetch(link.href, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            // El archivo existe, proceder con la descarga
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            // Mensaje de éxito
                            button.innerHTML = '<span class="button-privacy-icon">✅</span>Descargado';
                            setTimeout(() => {
                                button.innerHTML = originalText;
                                button.disabled = false;
                            }, 2000);
                        } else {
                            throw new Error('Archivo no encontrado');
                        }
                    })
                    .catch(error => {
                        console.error('Error al verificar la política de privacidad:', error);
                        
                        // Mostrar mensaje de archivo no encontrado
                        button.innerHTML = '<span class="button-privacy-icon">📁</span>No disponible';
                        
                        // Mostrar notificación al usuario
                        showPrivacyPolicyNotAvailableMessage();
                        
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.disabled = false;
                        }, 3000);
                    });
                
            } catch (error) {
                console.error('Error al descargar política de privacidad:', error);
                button.innerHTML = '<span class="button-privacy-icon">❌</span>Error';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 3000);
            }
        }

        // Función para mostrar mensaje cuando la política de privacidad no está disponible
        function showPrivacyPolicyNotAvailableMessage() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 2px solid #6c757d;
                border-radius: var(--border-radius);
                padding: 25px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                max-width: 380px;
                text-align: center;
            `;
            
            notification.innerHTML = `
                <div class="privacy-unavailable-icon">🔒</div>
                <h3 class="privacy-unavailable-title">Política no disponible</h3>
                <p class="privacy-unavailable-text">
                    La Política de Tratamiento de Datos Personales aún no ha sido cargada.
                    <br><br>Por favor, contacta al equipo organizador para obtener este documento.
                </p>
                <button onclick="this.parentElement.remove()" class="modal-remove-btn">Entendido</button>
            `;
            
            // Agregar overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 9999;
            `;
            overlay.onclick = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(notification);
            };
            
            document.body.appendChild(overlay);
            document.body.appendChild(notification);
            
            // Auto-cerrar después de 5 segundos
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(overlay);
                    document.body.removeChild(notification);
                }
            }, 5000);
        }

        // Función para animar las estadísticas del evento (opcional)
        function animateEventStats() {
            const stats = [
                { id: 'swimmerCount', target: 50, suffix: '+', duration: 2000 },
                { id: 'clubCount', target: 4, suffix: '+', duration: 1800 },
                { id: 'sponsorCount', target: 4, suffix: '+', duration: 1600 }
            ];

            stats.forEach(stat => {
                const element = document.getElementById(stat.id);
                if (!element) return;

                let current = 0;
                const increment = stat.target / (stat.duration / 50);
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= stat.target) {
                        current = stat.target;
                        clearInterval(timer);
                    }
                    element.textContent = Math.floor(current) + stat.suffix;
                }, 50);
            });
        }

        // Intersection Observer para animar cuando sea visible (optimizado para móvil)
        document.addEventListener('DOMContentLoaded', function() {
            // Detectar si es dispositivo móvil
            const isMobile = window.innerWidth <= 768;
            
            // Configurar threshold según el tipo de dispositivo
            const observerOptions = {
                threshold: isMobile ? 0.1 : 0.5, // 10% para móvil, 50% para desktop
                rootMargin: isMobile ? '50px 0px -50px 0px' : '0px' // Margen adicional para móviles
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Pequeño delay para asegurar que la sección es visible
                        setTimeout(() => {
                            animateEventStats();
                        }, isMobile ? 100 : 0);
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            const statsSection = document.querySelector('.event-stats-section');
            if (statsSection) {
                observer.observe(statsSection);
            }
        });

        // Función para compartir mensaje de agradecimiento a patrocinadores
        function shareThankYouMessage(platform) {
            const thankYouMessage = `🙏 ¡Gracias infinitas a nuestros increíbles patrocinadores y organizadores del IV Championship Master Swimming 2025! 🏊‍♂️🏊‍♀️
🤝 Nuestros patrocinadores:
@techfucol
@quiropediaemma  
@bambinotiendadelujo__89
@konkretescol
@hypersatellite
#criaderomichanchito

Organizadores:
@aquaten.cd
@elyanasnatacion

#Natación #AquaTEN #Elyanasnatacion #Championship2025 #Swimming #MasterSwimming

¡Gracias por creer en la natación cordobesa! 💙🏆`;

            if (platform === 'whatsapp') {
                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(thankYouMessage)}`;
                window.open(whatsappUrl, '_blank');
            } else if (platform === 'instagram') {
                // Copiar al portapapeles para Instagram
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(thankYouMessage).then(() => {
                        showInstagramThankYouInstructions();
                    }).catch(() => {
                        fallbackCopyToClipboard(thankYouMessage);
                        showInstagramThankYouInstructions();
                    });
                } else {
                    fallbackCopyToClipboard(thankYouMessage);
                    showInstagramThankYouInstructions();
                }
            }
        }

        // Mostrar instrucciones específicas para compartir mensaje de agradecimiento en Instagram
        function showInstagramThankYouInstructions() {
            const instructionModal = document.createElement('div');
            instructionModal.className = 'share-modal';
            instructionModal.innerHTML = `
                <div class="share-modal-content share-modal-content-center">
                    <div class="share-modal-header">
                        <h3 class="instagram-title">📱 Instagram - Mensaje de Agradecimiento</h3>
                        <button class="close-modal" onclick="closeInstagramThankYouInstructions()">&times;</button>
                    </div>
                    <div class="share-content-padding">
                        <div class="share-icon-large">📋✅</div>
                        <h4 class="share-icon-title">¡Mensaje copiado exitosamente!</h4>
                        <div class="share-instructions-text">
                            <p><strong>Paso 1:</strong> Abre Instagram en tu dispositivo</p>
                            <p><strong>Paso 2:</strong> Ve a tu perfil o stories</p>
                            <p><strong>Paso 3:</strong> Pega el mensaje copiado</p>
                            <p><strong>Paso 4:</strong> ¡Comparte tu agradecimiento!</p>
                        </div>
                        <div class="share-modal-footer">
                            <button class="modal-btn modal-btn-primary" onclick="closeInstagramThankYouInstructions()">¡Entendido!</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(instructionModal);
            instructionModal.style.display = 'flex';
        }

        // Cerrar modal de instrucciones de Instagram
        function closeInstagramThankYouInstructions() {
            const modal = document.querySelector('.share-modal');
            if (modal) {
                modal.remove();
            }
        }
    </script>
</body>
</html>
