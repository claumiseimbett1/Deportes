<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IV Championship Master - AquaTEN</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #ffffff;
            color: #0b1039;
            line-height: 1.6;
        }

        /* Animaciones */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .loading {
            animation: pulse 2s infinite;
        }

        /* Header */
        .header {
            background-color: #ffffff;
            box-shadow: 0 2px 15px rgba(11, 16, 57, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-box {
            height: 60px;
            display: flex;
            align-items: center;
        }

        .logo-box img {
            height: 100%;
            width: auto;
        }

        /* Status indicator */
        .status-indicator {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 9999;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .status-loading {
            background: #ffa726;
            color: white;
        }

        .status-success {
            background: #4caf50;
            color: white;
        }

        .status-error {
            background: #f44336;
            color: white;
        }

        /* Video Hero Section */
        .video-hero {
            margin-top: 90px;
            position: relative;
            width: 100%;
            height: 70vh;
            min-height: 500px;
            overflow: hidden;
            background-color: #0b1039;
        }

        .video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: none;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(11, 16, 57, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-content {
            text-align: center;
            z-index: 1;
            padding: 0 20px;
        }

        .hero-content h1 {
            font-size: 4em;
            color: #ffffff;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .hero-content .subtitle {
            font-size: 1.5em;
            color: #f0f6ff;
            font-weight: 300;
        }

        /* Results Section */
        .results-section {
            padding: 100px 20px;
            background: #f0f6ff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            font-size: 2.8em;
            color: #0b1039;
            margin-bottom: 60px;
            font-weight: 700;
        }

        .results-container {
            background: #ffffff;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 10px 40px rgba(11, 16, 57, 0.1);
            border: 2px solid #f0f6ff;
        }

        /* Indicador de √∫ltima actualizaci√≥n */
        .last-update {
            text-align: center;
            margin-bottom: 20px;
            color: #a5a5a5;
            font-size: 0.9em;
        }

        .last-update .time {
            color: #00ADEF;
            font-weight: 600;
        }

        /* Tabla de Resultados */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #ffffff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 25px rgba(11, 16, 57, 0.08);
        }

        .results-table th, .results-table td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #f0f6ff;
        }

        .results-table th {
            background-color: #0b1039;
            color: #ffffff;
            font-weight: 600;
            font-size: 1em;
        }

        .results-table tr:nth-child(even) td {
            background-color: #fafcff;
        }

        .results-table tr:hover td {
            background-color: #f0f6ff;
            transition: background-color 0.3s ease;
        }

        /* Footer */
        .footer {
            background-color: #0b1039;
            color: #ffffff;
            padding: 50px 20px;
            text-align: center;
        }

        .footer p {
            margin-bottom: 10px;
            color: #f0f6ff;
        }

        /* Debug panel */
        .debug-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #0f0;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 10000;
        }

        .debug-log {
            margin: 2px 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-content h1 {
                font-size: 2.5em;
            }

            .results-table th, .results-table td {
                padding: 10px 12px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <div class="logo-box">
                <img src="img/LogoChampion2025.png" alt="Logo IV Championship Master">
            </div>
            <div class="logo-box">
                <img src="img/LogoClubes.png" alt="Logo Clubes">
            </div>
        </nav>
    </header>

    <!-- Status Indicator -->
    <div id="statusIndicator" class="status-indicator status-loading">
        üîÑ Cargando resultados...
    </div>

    <!-- Video Hero Section -->
    <section class="video-hero">
        <div class="video-container">
            <video autoplay muted loop playsinline src="video/promocional.mp4">
                Tu navegador no soporta la etiqueta de video.
            </video>
        </div>
        <div class="video-overlay">
            <div class="hero-content">
                <h1>IV Championship Master</h1>
                <p class="subtitle">Competencia de Nataci√≥n Master</p>
            </div>
        </div>
    </section>

    <!-- Results Section -->
    <section class="results-section">
        <div class="container">
            <h2 class="section-title">Resultados en Tiempo Real</h2>
            <div class="results-container">
                <div class="last-update">
                    √öltima actualizaci√≥n: <span class="time" id="lastUpdateTime">Cargando...</span>
                </div>
                
                <h3>üèä‚Äç‚ôÄÔ∏è Resultados desde Google Sheets</h3>
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>Columna 1</th>
                            <th>Columna 2</th>
                            <th>Columna 3</th>
                            <th>Columna 4</th>
                            <th>Columna 5</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #a5a5a5;">
                                üîÑ Cargando datos desde Google Sheets...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 AquaTEN - Club Deportivo</p>
            <p>IV Championship Master - Todos los derechos reservados</p>
        </div>
    </footer>

    <!-- Debug Panel -->
    <div id="debugPanel" class="debug-panel" style="display: none;">
        <div style="font-weight: bold; color: #fff; margin-bottom: 10px;">üîç Debug Console</div>
        <div id="debugLogs"></div>
    </div>

    <script>
        // Configuraci√≥n
        const CONFIG = {
            API_KEY: 'AIzaSyDcUEGyS6grOV_p8Z6d9WofiFNMYQBblIk',
            SHEET_ID: '1AKzRm64pn_1JaL4n0Tx3xupfDdkU91Oc-nN2kf7z4PE',
            SHEET_NAME: 'RECORD MASTER',
            USE_API_KEY: true,
            DEBUG_MODE: true
        };

        // Variables globales
        let debugLogs = [];

        // Funci√≥n de debug
        function debug(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            console.log(logMessage, data || '');
            
            if (CONFIG.DEBUG_MODE) {
                debugLogs.push(logMessage);
                if (debugLogs.length > 50) debugLogs.shift();
                updateDebugPanel();
            }
        }

        // Actualizar panel de debug
        function updateDebugPanel() {
            const panel = document.getElementById('debugPanel');
            const logsDiv = document.getElementById('debugLogs');
            
            if (CONFIG.DEBUG_MODE && panel) {
                panel.style.display = 'block';
                logsDiv.innerHTML = debugLogs.map(log => 
                    `<div class="debug-log">${log}</div>`
                ).join('');
                logsDiv.scrollTop = logsDiv.scrollHeight;
            }
        }

        // Actualizar indicador de estado
        function updateStatus(type, message) {
            const statusIndicator = document.getElementById('statusIndicator');
            statusIndicator.className = `status-indicator status-${type}`;
            statusIndicator.textContent = message;
            debug(`Status: ${type} - ${message}`);
        }

        // Actualizar tiempo
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-CO');
            document.getElementById('lastUpdateTime').textContent = timeString;
        }

        // Parser CSV simple
        function parseCSV(csvText) {
            const rows = [];
            const lines = csvText.split('\n');
            
            for (let line of lines) {
                if (!line.trim()) continue;
                const cols = line.split(',').map(col => col.trim().replace(/^"|"$/g, ''));
                rows.push(cols);
            }
            
            return rows;
        }

        // Cargar datos con API Key
        async function loadWithAPIKey() {
            debug('üîë Intentando cargar con API Key...');
            
            const ranges = [
                `${CONFIG.SHEET_NAME}!A:Z`,
                `${CONFIG.SHEET_NAME}!A1:Z1000`,
                'A:Z'
            ];
            
            for (const range of ranges) {
                try {
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${range}?key=${CONFIG.API_KEY}`;
                    debug(`üì° Probando rango: ${range}`);
                    
                    const response = await fetch(url);
                    debug(`üìä Respuesta: ${response.status} ${response.statusText}`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.values && data.values.length > 0) {
                            debug(`‚úÖ Datos encontrados: ${data.values.length} filas`);
                            return data.values;
                        }
                    } else {
                        const error = await response.json();
                        debug(`‚ùå Error API: ${JSON.stringify(error)}`);
                    }
                } catch (error) {
                    debug(`‚ùå Error de conexi√≥n: ${error.message}`);
                }
            }
            
            return null;
        }

        // Cargar datos con CSV
        async function loadWithCSV() {
            debug('üìÑ Intentando cargar con CSV...');
            
            const csvUrls = [
                `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/export?format=csv&gid=0`,
                `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/export?format=csv`
            ];
            
            for (const url of csvUrls) {
                try {
                    debug(`üì° Probando URL CSV...`);
                    const response = await fetch(url);
                    
                    if (response.ok) {
                        const text = await response.text();
                        if (text && !text.includes('<!DOCTYPE')) {
                            const rows = parseCSV(text);
                            debug(`‚úÖ CSV parseado: ${rows.length} filas`);
                            return rows;
                        }
                    }
                } catch (error) {
                    debug(`‚ùå Error CSV: ${error.message}`);
                }
            }
            
            return null;
        }

        // Funci√≥n principal para cargar datos
        async function loadSheetData() {
            updateStatus('loading', 'üîÑ Cargando datos...');
            
            let data = null;
            
            // Intentar con API Key primero
            if (CONFIG.USE_API_KEY) {
                data = await loadWithAPIKey();
            }
            
            // Si falla, intentar con CSV
            if (!data) {
                data = await loadWithCSV();
            }
            
            // Actualizar tabla con los datos
            if (data && data.length > 0) {
                updateTable(data);
                updateStatus('success', '‚úÖ Datos cargados');
                updateLastUpdateTime();
            } else {
                updateStatus('error', '‚ùå No se pudieron cargar los datos');
                showError();
            }
        }

        // Actualizar tabla con datos
        function updateTable(data) {
            const tbody = document.querySelector('#resultsTable tbody');
            
            // Limpiar tabla
            tbody.innerHTML = '';
            
            // Procesar filas
            data.forEach((row, index) => {
                if (index === 0 && row.some(cell => cell.toLowerCase().includes('column'))) {
                    // Actualizar headers si la primera fila contiene headers
                    updateHeaders(row);
                    return;
                }
                
                const tr = document.createElement('tr');
                
                // Asegurar que tenemos al menos 5 columnas
                for (let i = 0; i < 5; i++) {
                    const td = document.createElement('td');
                    td.textContent = row[i] || '-';
                    tr.appendChild(td);
                }
                
                tbody.appendChild(tr);
            });
            
            debug(`‚úÖ Tabla actualizada con ${data.length} filas`);
        }

        // Actualizar headers de la tabla
        function updateHeaders(headers) {
            const thead = document.querySelector('#resultsTable thead tr');
            thead.innerHTML = '';
            
            // Tomar solo las primeras 5 columnas
            for (let i = 0; i < Math.min(5, headers.length); i++) {
                const th = document.createElement('th');
                th.textContent = headers[i] || `Columna ${i + 1}`;
                thead.appendChild(th);
            }
        }

        // Mostrar error
        function showError() {
            const tbody = document.querySelector('#resultsTable tbody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center; padding: 40px; color: #f44336;">
                        ‚ùå No se pudieron cargar los datos<br>
                        <small style="color: #666; margin-top: 10px; display: block;">
                            Verifica que el Google Sheet sea p√∫blico
                        </small>
                        <button onclick="loadSheetData()" style="margin-top: 15px; padding: 10px 20px; background: #00ADEF; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            üîÑ Reintentar
                        </button>
                    </td>
                </tr>`;
        }

        // Funci√≥n de prueba
        async function testConnection() {
            debug('üß™ === INICIANDO PRUEBA DE CONEXI√ìN ===');
            debug(`üìä Sheet ID: ${CONFIG.SHEET_ID}`);
            debug(`üîë API Key: ${CONFIG.API_KEY.substring(0, 10)}...`);
            
            // Probar API Key
            const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/A1:Z1?key=${CONFIG.API_KEY}`;
            try {
                const response = await fetch(apiUrl);
                debug(`API Response: ${response.status}`);
                if (response.ok) {
                    const data = await response.json();
                    debug('‚úÖ API Key funciona correctamente');
                    debug(`Datos obtenidos: ${JSON.stringify(data.values?.[0]?.slice(0, 3))}`);
                } else {
                    const error = await response.json();
                    debug(`‚ùå Error API: ${error.error?.message}`);
                }
            } catch (error) {
                debug(`‚ùå Error de conexi√≥n: ${error.message}`);
            }
            
            // Probar CSV
            const csvUrl = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/export?format=csv`;
            try {
                const response = await fetch(csvUrl);
                debug(`CSV Response: ${response.status}`);
                if (response.ok) {
                    const text = await response.text();
                    debug(`‚úÖ CSV accesible, longitud: ${text.length} caracteres`);
                }
            } catch (error) {
                debug(`‚ùå Error CSV: ${error.message}`);
            }
        }

        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            debug('üöÄ P√°gina cargada, iniciando...');
            
            // Cargar datos inicialmente
            loadSheetData();
            
            // Recargar cada 30 segundos
            setInterval(loadSheetData, 30000);
            
            // Hacer funciones disponibles globalmente para debugging
            window.testConnection = testConnection;
            window.loadSheetData = loadSheetData;
            
            debug('üí° Comandos disponibles en consola:');
            debug('   testConnection() - Probar conexi√≥n');
            debug('   loadSheetData() - Recargar datos');
        });
    </script>
</body>
</html>